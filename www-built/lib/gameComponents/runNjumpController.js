define(["controller","box2dCore"],function(e,t){var n=function(n,r){var i=n.physics,r=r||{},s=r.speed||4,o=r.jumpSpeed||4,u=r.jumpSpeed||1.5,a=0,f=!1,l=this;if(n.details.type!=="kinematic")throw new Error("RunNjumpController: The body type must be kinematic.");var c=!1,h=!1,p=.01,d=p,v=p;n.body.SetLinearVelocity(new t.b2Vec2(d,v)),this.controller=new e(r);var m=function(e){if(e===undefined)return s;s=e},g=function(){d=-s,_.isUndefined(r.actionCallback)||r.actionCallback("left")},y=function(){d=s,_.isUndefined(r.actionCallback)||r.actionCallback("right")},b=function(){return n.body.GetPosition().y<=a-u?!0:!1},w=function(){c||(a=n.body.GetPosition().y,v=-o,c=!0)},E=function(e){if(e==="end")return n.body.GetPosition().y>=a?!0:!1;if(e==="start")return!0},S=function(){v=p,h=!1,c=!1;var e=n.body.GetPosition();n.body.SetPosition(new t.b2Vec2(e.x,a))},x=function(){l.controller.isLeftKey()&&(_.isUndefined(r.runCallback)?g():r.runCallback("left")&&g()),l.controller.isRightKey()&&(_.isUndefined(r.runCallback)?y():r.runCallback("right")&&y()),!l.controller.isLeftKey()&&!l.controller.isRightKey()&&(d=p,!c&&!h?r.actionCallback("idle"):r.actionCallback("jumping")),l.controller.isUpKey()?(!f&&!c&&(!_.isUndefined(r.jumpCallback)&&r.jumpCallback("start")?w():E("start")&&w()),f=!0):f=!1};$(window).on("step",function(){!h&&c&&b()&&(v*=-1,h=!0),h&&(_.isUndefined(r.jumpCallback)?E("end")&&S():r.jumpCallback("end")&&S()),x(),n.body.SetLinearVelocity(new t.b2Vec2(d,v))})};return n});
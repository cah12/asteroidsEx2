define(["jquery","services","gameRegister","gameLogin","gameProfile","box2dCore","howler","faye"],function(e,t){var n=function(n){var r=this;this.details=n=n||{};var i=n.FPS=n.FPS||60,s=n.collision=n.collision||!0,o=n.bounded=n.bounded||!0,u=n.physicsEnabled=n.physicsEnabled||!0,a=null;this.soundEnabled=!0,this.smallScreen=screen.width<900||!1;var f=0,l=e("#gameCanvas");this.gameboardHeightMeters=n.boardHeightMeters=n.boardHeightMeters||25,this.gameboardWidthMeters=0,l[0].width=e("#gameDiv").width(),l[0].height=e("#gameDiv").width(),e(window).resize(function(){l[0].width=e("#gameDiv").width(),l[0].height=e("#gameDiv").width()}),e("#fireButtonDiv").css("top",.2*l[0].height),e("#arrowsDiv").css("top",.5*l[0].height),this.stageRect=function(){return{x:0,y:0,width:l[0].width,height:l[0].height}},this.smallScreen||e("#controls").hide();if(u){var c=l[0].height/this.gameboardHeightMeters;this.gameboardWidthMeters=l[0].width/c,a=new Physics(l[0],c),a.running=!1,s&&a.collision(),o&&a.screenBoundaries(n.boundary)}this.debug=function(){a.debug()},this.pause=function(t,n){if(!a)return;a.running=!t,_.isUndefined(n)||n(t),e(window).trigger("gamePause")},this.end=function(t){if(!a)return;a.running=!1,_.isUndefined(t)||t(),e(window).trigger("gameEnd")},this.start=function(t){if(!a)return;a.running=!0,_.isUndefined(t)||t(),e(window).trigger("gameStart")},this.trigger=function(t,n){e(window).trigger(t,n)},this.catch=function(t,n){e(window).on(t,n)},this.destroyBody=function(e){a.destroyBody(e)},this.gamePhysics=function(){return a},a.animate();var h={},p=function(e){if(e.id===undefined||e.src===undefined)throw"ImageLoader: invalid arguments to preload function";var t=new Image;t.src=e.src;if(h[e.id]!==undefined)throw"ImageLoader: duplicte id";h[e.id]=t};this.preload=function(e){_.isArray(e)?_.each(e,p):p(e)},this.image=function(e){if(_.isUndefined(e))throw"Game: expected an argument fo image().";return h[e]},this.hideCanvas=function(e){_.isUndefined(e)||e?l.hide():l.show()},e("#soundlink").on("click",function(){var t=e("#soundlinkicon");r.soundEnabled?(t.removeClass("glyphicon-volume-up"),t.addClass("glyphicon-volume-off"),r.soundEnabled=!1):(t.removeClass("glyphicon-volume-off"),t.addClass("glyphicon-volume-up"),r.soundEnabled=!0)}),e("#gameEndDiv").hide(),e("#authenticatedSpan").hide(),e(window).on("loggedIn",function(t,n){e("#authenticatedSpan").show(),e("#notAuthenticatedSpan").hide(),e("#username").text(n),e("#username").text()!==e("#name").text()&&(e("#name_href").show(),e("#name").hide())}),this.initLeader=function(n){function s(t){e("#score").text(t.score),e("#level").text(t.level),e("#name").text(t.name),e("#name_href").text(t.name),e("#username").text()===""||e("#username").text()===t.name?(e("#name_href").hide(),e("#name").show()):(e("#name_href").show(),e("#name").hide())}function o(){i||t.level(f,function(e,t){s(e),i=!0,a()})}function a(){setTimeout(function(){console.log(44),i=!1,o()},5e3)}var i=!1;i=!1,o(),e(window).on("gameLevelChanged",function(e,t){f=t,i=!1,o()});var u=!1;e(window).on("gameStart",function(){u=!1,e("#gameEndDiv").hide()}),e(window).on("gameEnd",function(){r.gameEndMessage&&e("#gameEndDiv").text(r.gameEndMessage),e("#gameEndDiv").show(),e("#score").text()<n()&&!u&&(u=!0,i=!1,t.score(f,n(),function(e,t){console.log("score status: ",t),console.log("score data: ",e)}))})}};return n});
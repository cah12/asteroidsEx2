(function(){var e=typeof require=="function"?require(".."):window._,t;QUnit.module("Utility",{setup:function(){t=e.clone(e.templateSettings)},teardown:function(){e.templateSettings=t}}),test("#750 - Return _ instance.",2,function(){var t=e([]);ok(e(t)===t),ok(new e(t)===t)}),test("identity",function(){var t={name:"moe"};equal(e.identity(t),t,"stooge is the same as his identity")}),test("constant",function(){var t={name:"moe"};equal(e.constant(t)(),t,"should create a function that returns stooge")}),test("noop",function(){strictEqual(e.noop("curly","larry","moe"),undefined,"should always return undefined")}),test("property",function(){var t={name:"moe"};equal(e.property("name")(t),"moe","should return the property with the given name"),equal(e.property("name")(null),undefined,"should return undefined for null values"),equal(e.property("name")(undefined),undefined,"should return undefined for undefined values")}),test("propertyOf",function(){function n(){this.shemp=87}var t=e.propertyOf({curly:2,moe:1,larry:3});equal(t("curly"),2,"should return the property with the given name"),equal(t(null),undefined,"should return undefined for null values"),equal(t(undefined),undefined,"should return undefined for undefined values"),n.prototype={curly:2,moe:1,larry:3};var r=e.propertyOf(new n);equal(r("curly"),2,"should return properties from further up the prototype chain");var i=e.propertyOf(null);equal(i("curly"),undefined,"should return undefined when obj is null");var s=e.propertyOf(undefined);equal(s("curly"),undefined,"should return undefined when obj is undefined")}),test("random",function(){var t=e.range(1e3),n=Math.pow(2,31),r=Math.pow(2,62);ok(e.every(t,function(){return e.random(n,r)>=n}),"should produce a random number greater than or equal to the minimum number"),ok(e.some(t,function(){return e.random(Number.MAX_VALUE)>0}),"should produce a random number when passed `Number.MAX_VALUE`")}),test("now",function(){var t=e.now()-(new Date).getTime();ok(t<=0&&t>-5,"Produces the correct time in milliseconds")}),test("uniqueId",function(){var t=[],n=0;while(n++<100)t.push(e.uniqueId());equal(e.uniq(t).length,t.length,"can generate a globally-unique stream of ids")}),test("times",function(){var t=[];e.times(3,function(e){t.push(e)}),deepEqual(t,[0,1,2],"is 0 indexed"),t=[],e(3).times(function(e){t.push(e)}),deepEqual(t,[0,1,2],"works as a wrapper"),deepEqual([0,1,2],e.times(3,function(e){return e}),"collects return values"),deepEqual(e.times(0,e.identity),[]),deepEqual(e.times(-1,e.identity),[]),deepEqual(e.times(parseFloat("-Infinity"),e.identity),[])}),test("mixin",function(){e.mixin({myReverse:function(e){return e.split("").reverse().join("")}}),equal(e.myReverse("panacea"),"aecanap","mixed in a function to _"),equal(e("champ").myReverse(),"pmahc","mixed in a function to the OOP wrapper")}),test("_.escape",function(){equal(e.escape(null),"")}),test("_.unescape",function(){var t="Curly & Moe";equal(e.unescape(null),""),equal(e.unescape(e.escape(t)),t),equal(e.unescape(t),t,"don't unescape unnecessarily")}),test("_.escape & unescape",function(){var t=["<",">",'"',"'","`"];e.each(t,function(t){var n="a "+t+" string escaped",r=e.escape(n);notEqual(n,r,t+" is escaped"),equal(n,e.unescape(r),t+" can be unescaped"),n="a "+t+t+t+"some more string"+t,r=e.escape(n),equal(r.indexOf(t),-1,"can escape multiple occurances of "+t),equal(e.unescape(r),n,"multiple occurrences of "+t+" can be unescaped")});var n=" other stuff ",r=t.join(n);r+=r,ok(e.every(t,function(e){return r.indexOf(e)!==-1}),"handles multiple characters"),ok(r.indexOf(n)>=0,"can escape multiple escape characters at the same time");var i="some string & another string & yet another",s=e.escape(i);ok(s.indexOf("&")!==-1,"handles & aka &amp;"),equal(e.unescape(i),i,"can unescape &amp;")}),test("template",function(){var t=e.template("<%= thing %> is gettin' on my noives!"),n=t({thing:"This"});equal(n,"This is gettin' on my noives!","can do basic attribute interpolation");var r=e.template("A <% this %> B");equal(r(),"A  B");var i=e.template("<%= thing %> is \\ridanculous");equal(i({thing:"This"}),"This is \\ridanculous");var s=e.template('<%= a ? "checked=\\"checked\\"" : "" %>');equal(s({a:!0}),'checked="checked"',"can handle slash escapes in interpolations.");var o=e.template("<ul><%   for (var key in people) { %><li><%= people[key] %></li><% } %></ul>");n=o({people:{moe:"Moe",larry:"Larry",curly:"Curly"}}),equal(n,"<ul><li>Moe</li><li>Larry</li><li>Curly</li></ul>","can run arbitrary javascript in templates");var u=e.template('<ul><% _.each(numbers.split("\\n"), function(item) { %><li><%= item %></li><% }) %></ul>');n=u({numbers:"one\ntwo\nthree\nfour"}),equal(n,"<ul><li>one</li><li>two</li><li>three</li><li>four</li></ul>","Can use escaped characters (e.g. \\n) in JavaScript");var a=e.template('<%= pageCount %> <%= thumbnails[pageCount] %> <% _.each(thumbnails, function(p) { %><div class="thumbnail" rel="<%= p %>"></div><% }); %>');n=a({pageCount:3,thumbnails:{1:"p1-thumbnail.gif",2:"p2-thumbnail.gif",3:"p3-thumbnail.gif"}}),equal(n,'3 p3-thumbnail.gif <div class="thumbnail" rel="p1-thumbnail.gif"></div><div class="thumbnail" rel="p2-thumbnail.gif"></div><div class="thumbnail" rel="p3-thumbnail.gif"></div>');var f=e.template("<div><p>Just some text. Hey, I know this is silly but it aids consistency.</p></div>");n=f(),equal(n,"<div><p>Just some text. Hey, I know this is silly but it aids consistency.</p></div>");var l=e.template("It's its, not it's");equal(l({}),"It's its, not it's");var c=e.template("<%   if(foo == 'bar'){ %>Statement quotes and 'quotes'.<% } %>");equal(c({foo:"bar"}),"Statement quotes and 'quotes'.");var h=e.template("This\n		is: <%= x %>.\n	ok.\nend.");equal(h({x:"that"}),"This\n		is: that.\n	ok.\nend.");var p=e.template("<i><%- value %></i>");n=p({value:"<script>"}),equal(n,"<i>&lt;script&gt;</i>");var d={name:"Moe",template:e.template("I'm <%= this.name %>")};equal(d.template(),"I'm Moe"),p=e.template("\n   <%\n   // a comment\n   if (data) { data += 12345; }; %>\n   <li><%= data %></li>\n "),equal(p({data:12345}).replace(/\s/g,""),"<li>24690</li>"),e.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g};var v=e.template("<ul>{{ for (var key in people) { }}<li>{{= people[key] }}</li>{{ } }}</ul>");n=v({people:{moe:"Moe",larry:"Larry",curly:"Curly"}}),equal(n,"<ul><li>Moe</li><li>Larry</li><li>Curly</li></ul>","can run arbitrary javascript in templates");var m=e.template("It's its, not it's");equal(m({}),"It's its, not it's"),c=e.template("{{ if(foo == 'bar'){ }}Statement quotes and 'quotes'.{{ } }}"),equal(c({foo:"bar"}),"Statement quotes and 'quotes'."),e.templateSettings={evaluate:/<\?([\s\S]+?)\?>/g,interpolate:/<\?=([\s\S]+?)\?>/g};var g=e.template("<ul><? for (var key in people) { ?><li><?= people[key] ?></li><? } ?></ul>");n=g({people:{moe:"Moe",larry:"Larry",curly:"Curly"}}),equal(n,"<ul><li>Moe</li><li>Larry</li><li>Curly</li></ul>","can run arbitrary javascript in templates");var y=e.template("It's its, not it's");equal(y({}),"It's its, not it's"),c=e.template("<? if(foo == 'bar'){ ?>Statement quotes and 'quotes'.<? } ?>"),equal(c({foo:"bar"}),"Statement quotes and 'quotes'."),e.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var b=e.template("Hello {{planet}}!");equal(b({planet:"World"}),"Hello World!","can mimic mustache.js");var w=e.template("a null undefined {{planet}}");equal(w({planet:"world"}),"a null undefined world","can handle missing escape and evaluate settings")}),test("_.template provides the generated function source, when a SyntaxError occurs",function(){try{e.template("<b><%= if x %></b>")}catch(t){var n=t.source}ok(/__p/.test(n))}),test("_.template handles \\u2028 & \\u2029",function(){var t=e.template('<p>\u2028<%= "\\u2028\\u2029" %>\u2029</p>');strictEqual(t(),"<p>\u2028\u2028\u2029\u2029</p>")}),test("result calls functions and returns primitives",function(){var t={w:"",x:"x",y:function(){return this.x}};strictEqual(e.result(t,"w"),""),strictEqual(e.result(t,"x"),"x"),strictEqual(e.result(t,"y"),"x"),strictEqual(e.result(t,"z"),undefined),strictEqual(e.result(null,"x"),undefined)}),test("result returns a default value if object is null or undefined",function(){strictEqual(e.result(null,"b","default"),"default"),strictEqual(e.result(undefined,"c","default"),"default"),strictEqual(e.result("".match("missing"),1,"default"),"default")}),test("result returns a default value if property of object is missing",function(){strictEqual(e.result({d:null},"d","default"),null),strictEqual(e.result({e:!1},"e","default"),!1)}),test("result only returns the default value if the object does not have the property or is undefined",function(){strictEqual(e.result({},"b","default"),"default"),strictEqual(e.result({d:undefined},"d","default"),"default")}),test("result does not return the default if the property of an object is found in the prototype",function(){var t=function(){};t.prototype.bar=1,strictEqual(e.result(new t,"bar",2),1)}),test("result does use the fallback when the result of invoking the property is undefined",function(){var t={a:function(){}};strictEqual(e.result(t,"a","failed"),undefined)}),test("result fallback can use a function",function(){var t={a:[1,2,3]};strictEqual(e.result(t,"b",e.constant(5)),5),strictEqual(e.result(t,"b",function(){return this.a}),t.a,"called with context")}),test("_.templateSettings.variable",function(){var t="<%=data.x%>",n={x:"x"},r=e.template(t,{variable:"data"});strictEqual(r(n),"x"),e.templateSettings.variable="data",strictEqual(e.template(t)(n),"x")}),test("#547 - _.templateSettings is unchanged by custom settings.",function(){ok(!e.templateSettings.variable),e.template("",{},{variable:"x"}),ok(!e.templateSettings.variable)}),test("#556 - undefined template variables.",function(){var t=e.template("<%=x%>");strictEqual(t({x:null}),""),strictEqual(t({x:undefined}),"");var n=e.template("<%-x%>");strictEqual(n({x:null}),""),strictEqual(n({x:undefined}),"");var r=e.template("<%=x.foo%>");strictEqual(r({x:{}}),""),strictEqual(r({x:{}}),"");var i=e.template("<%-x.foo%>");strictEqual(i({x:{}}),""),strictEqual(i({x:{}}),"")}),test("interpolate evaluates code only once.",2,function(){var t=0,n=e.template("<%= f() %>");n({f:function(){ok(!(t++))}});var r=0,i=e.template("<%- f() %>");i({f:function(){ok(!(r++))}})}),test("#746 - _.template settings are not modified.",1,function(){var t={};e.template("",null,t),deepEqual(t,{})}),test("#779 - delimeters are applied to unescaped text.",1,function(){var t=e.template("<<\nx\n>>",null,{evaluate:/<<(.*?)>>/g});strictEqual(t(),"<<\nx\n>>")})})();
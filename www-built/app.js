/*!
 * jQuery JavaScript Library v2.1.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-04-28T16:01Z
 */

/*!
 * Sizzle CSS Selector Engine v2.2.0-pre
 * http://sizzlejs.com/
 *
 * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-16
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*!
 *  howler.js v1.1.29
 *  howlerjs.com
 *
 *  (c) 2013-2016, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */

/*!
 * Bootstrap v3.3.6 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under the MIT license
 */

(function(e,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)})(typeof window!="undefined"?window:this,function(window,noGlobal){function isArraylike(e){var t="length"in e&&e.length,n=jQuery.type(e);return n==="function"||jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||t===0||typeof t=="number"&&t>0&&t-1 in e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(risSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return indexOf.call(t,e)>=0!==n})}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(rnotwhite)||[],function(e,n){t[n]=!0}),t}function completed(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Data.uid++}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?jQuery.parseJSON(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=0,r=e.length;for(;n<r;n++)data_priv.set(e[n],"globalEval",!t||data_priv.get(t[n],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function actualDisplay(e,t){var n,r=jQuery(t.createElement(e)).appendTo(t.body),i=window.getDefaultComputedStyle&&(n=window.getDefaultComputedStyle(r[0]))?n.display:jQuery.css(r[0],"display");return r.detach(),i}function defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=iframe[0].contentDocument,t.write(),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function curCSS(e,t,n){var r,i,s,o,u=e.style;return n=n||getStyles(e),n&&(o=n.getPropertyValue(t)||n[t]),n&&(o===""&&!jQuery.contains(e.ownerDocument,e)&&(o=jQuery.style(e,t)),rnumnonpx.test(o)&&rmargin.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),o!==undefined?o+"":o}function addGetHookIf(e,t){return{get:function(){if(e()){delete this.get;return}return(this.get=t).apply(this,arguments)}}}function vendorPropName(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(support.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",defaultDisplay(r.nodeName)))):(i=isHidden(r),(n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function genFx(e,t){var n,r=0,i={height:e};t=t?1:0;for(;r<4;r+=2-t)n=cssExpand[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f,l,c=this,h={},p=e.style,d=e.nodeType&&isHidden(e),v=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,c.always(function(){c.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],f=jQuery.css(e,"display"),l=f==="none"?data_priv.get(e,"olddisplay")||defaultDisplay(e.nodeName):f,l==="inline"&&jQuery.css(e,"float")==="none"&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",c.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(d?"hide":"show")){if(i!=="show"||!v||v[r]===undefined)continue;d=!0}h[r]=v&&v[r]||jQuery.style(e,r)}else f=undefined}if(!jQuery.isEmptyObject(h)){v?"hidden"in v&&(d=v.hidden):v=data_priv.access(e,"fxshow",{}),s&&(v.hidden=!d),d?jQuery(e).show():c.done(function(){jQuery(e).hide()}),c.done(function(){var t;data_priv.remove(e,"fxshow");for(t in h)jQuery.style(e,t,h[t])});for(r in h)o=createTween(d?v[r]:0,r,c),r in v||(v[r]=o.start,d&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}else(f==="none"?defaultDisplay(e.nodeName):f)==="inline"&&(p.display=f)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var arr=[],slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},document=window.document,version="2.1.4",jQuery=function(e,t){return new jQuery.fn.init(e,t)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:slice.call(this)},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[u]||{},u++),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!jQuery.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e)?!1:e.constructor&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return e==null?e+"":typeof e=="object"||typeof e=="function"?class2type[toString.call(e)]||"object":typeof e},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":(e+"").replace(rtrim,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:indexOf.call(t,e,n)},merge:function(e,t){var n=+t.length,r=0,i=e.length;for(;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length,u=!n;for(;s<o;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&u.push(r);else for(i in e)r=t(e[i],i,n),r!=null&&u.push(r);return concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},now:Date.now,support:support}),jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()});var Sizzle=function(e){function ot(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;(t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],l=t.nodeType;if(typeof e!="string"||!e||l!==1&&l!==9&&l!==11)return r;if(!i&&v){if(l!==11&&(s=Z.exec(e)))if(f=s[1]){if(l===9){u=t.getElementById(f);if(!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return D.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName)return D.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){y=g=w,S=t,x=l!==1&&e;if(l===1&&t.nodeName.toLowerCase()!=="object"){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+gt(d[c]);S=et.test(e)&&vt(t.parentNode)||t,x=d.join(",")}if(x)try{return D.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ut(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function at(e){return e[w]=!0,e}function ft(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function ct(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||L)-(~e.sourceIndex||L);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function dt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(e){return e&&typeof e.getElementsByTagName!="undefined"&&e}function mt(){}function gt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function yt(e,t,n){var r=t.dir,i=n&&r==="parentNode",s=x++;return t.first?function(t,n,s){while(t=t[r])if(t.nodeType===1||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if(t.nodeType===1||i)if(e(t,n,o))return!0}else while(t=t[r])if(t.nodeType===1||i){a=t[w]||(t[w]={});if((u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];a[r]=f;if(f[2]=e(t,n,o))return!0}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ot(e,t[r],n);return n}function Et(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function St(e,t,n,r,i,s){return r&&!r[w]&&(r=St(r)),i&&!i[w]&&(i=St(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?Et(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=Et(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?H(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=Et(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):D.apply(o,g)})}function xt(e){var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return H(t,e)>-1},u,!0),h=[function(e,n,r){var i=!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r));return t=null,i}];for(;a<s;a++)if(n=r.relative[e[a].type])h=[yt(bt(h),n)];else{n=r.filter[e[a].type].apply(null,e[a].matches);if(n[w]){i=++a;for(;i<s;i++)if(r.relative[e[i].type])break;return St(a>1&&bt(h),a>1&&gt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<i&&xt(e.slice(a,i)),i<s&&xt(e=e.slice(i)),i<s&&gt(e))}h.push(n)}return bt(h)}function Tt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=b==null?1:Math.random()||.1,x=w.length;l&&(f=o!==p&&o);for(;m!==x&&(c=w[m])!=null;m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}v+=m;if(n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)!g[m]&&!y[m]&&(y[m]=M.call(a));y=Et(y)}D.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&ot.uniqueSort(a)}return l&&(S=E,f=b),g};return n?at(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+1*new Date,E=e.document,S=0,x=0,T=ut(),N=ut(),C=ut(),k=function(e,t){return e===t&&(c=!0),0},L=1<<31,A={}.hasOwnProperty,O=[],M=O.pop,_=O.push,D=O.push,P=O.slice,H=function(e,t){var n=0,r=e.length;for(;n<r;n++)if(e[n]===t)return n;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",I=F.replace("w","w#"),q="\\["+j+"*("+F+")(?:"+j+"*([*^$|!~]?=)"+j+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+j+"*\\]",R=":("+F+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|"+".*"+")\\)|)",U=new RegExp(j+"+","g"),z=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),W=new RegExp("^"+j+"*,"+j+"*"),X=new RegExp("^"+j+"*([>+~]|"+j+")"+j+"*"),V=new RegExp("="+j+"*([^\\]'\"]*?)"+j+"*\\]","g"),$=new RegExp(R),J=new RegExp("^"+I+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),bool:new RegExp("^(?:"+B+")$","i"),needsContext:new RegExp("^"+j+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+j+"*((?:-\\d)?\\d*)"+j+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+j+"?|("+j+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)},it=function(){h()};try{D.apply(O=P.call(E.childNodes),E.childNodes),O[E.childNodes.length].nodeType}catch(st){D={apply:O.length?function(e,t){_.apply(e,P.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=ot.support={},s=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},h=ot.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:E;if(o===p||o.nodeType!==9||!o.documentElement)return p;p=o,d=o.documentElement,i=o.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",it,!1):i.attachEvent&&i.attachEvent("onunload",it)),v=!s(o),n.attributes=ft(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ft(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(o.getElementsByClassName),n.getById=ft(function(e){return d.appendChild(e).id=w,!o.getElementsByName||!o.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!="undefined"&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e);if(n.qsa)return t.querySelectorAll(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(v)return t.getElementsByClassName(e)},g=[],m=[];if(n.qsa=Y.test(o.querySelectorAll))ft(function(e){d.appendChild(e).innerHTML="<a id='"+w+"'></a>"+"<select id='"+w+"-\f]' msallowcapture=''>"+"<option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+j+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+j+"*(?:value|"+B+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]")}),ft(function(e){var t=o.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+j+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")});return(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ft(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",R)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,r&1||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===o||e.ownerDocument===E&&b(E,e)?-1:t===o||t.ownerDocument===E&&b(E,t)?1:l?H(l,e)-H(l,t):0:r&4?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,u=[e],a=[t];if(!i||!s)return e===o?-1:t===o?1:i?-1:s?1:l?H(l,e)-H(l,t):0;if(i===s)return ct(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?ct(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},o},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){(e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']");if(n.matchesSelector&&v&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&e.document.nodeType!==11)return r}catch(i){}return ot(t,p,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},ot.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&A.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):undefined;return s!==undefined?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ot.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,r=[],i=0,s=0;c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k);if(c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=ot.getText=function(e){var t,n="",r=0,s=e.nodeType;if(!s)while(t=e[r++])n+=i(t);else if(s===1||s===9||s===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(s===3||s===4)return e.nodeValue;return n},r=ot.selectors={cacheLength:50,createPseudo:at,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+j+")"+e+"("+j+"|$)"))&&T(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!="undefined"&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i.replace(U," ")+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[w]||(c[w]={}))[e]=[S,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=H(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:at(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return e=e.replace(nt,rt),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:at(function(e){return J.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[n<0?n+t:n]}),even:dt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:dt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ht(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pt(t);return mt.prototype=r.filters=r.pseudos,r.setFilters=new mt,o=ot.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){if(!n||(i=W.exec(u)))i&&(u=u.slice(i[0].length)||u),a.push(s=[]);n=!1;if(i=X.exec(u))n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length);for(o in r.filter)(i=K[o].exec(u))&&(!f[o]||(i=f[o](i)))&&(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ot.error(e):N(e,a).slice(0)},u=ot.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=xt(t[n]),s[w]?r.push(s):i.push(s);s=C(e,Tt(i,r)),s.selector=e}return s},a=ot.select=function(e,t,i,s){var a,f,l,c,h,p=typeof e=="function"&&e,d=!s&&o(e=p.selector||e);i=i||[];if(d.length===1){f=d[0]=d[0].slice(0);if(f.length>2&&(l=f[0]).type==="ID"&&n.getById&&t.nodeType===9&&v&&r.relative[f[1].type]){t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0];if(!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){l=f[a];if(r.relative[c=l.type])break;if(h=r.find[c])if(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&vt(t.parentNode)||t)){f.splice(a,1),e=s.length&&gt(f);if(!e)return D.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&vt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=ft(function(e){return e.compareDocumentPosition(p.createElement("div"))&1}),ft(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||lt("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!n.attributes||!ft(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&lt("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),ft(function(e){return e.getAttribute("disabled")==null})||lt(B,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),ot}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;jQuery.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},jQuery.fn.extend({find:function(e){var t,n=this.length,r=[],i=this;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<n;t++)if(jQuery.contains(i[t],this))return!0}));for(t=0;t<n;t++)jQuery.find(e,i[t],r);return r=this.pushStack(n>1?jQuery.unique(r):r),r.selector=this.selector?this.selector+" "+e:e,r},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},not:function(e){return this.pushStack(winnow(this,e||[],!0))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(e,t){var n,r;if(!e)return this;if(typeof e=="string"){e[0]==="<"&&e[e.length-1]===">"&&e.length>=3?n=[null,e,null]:n=rquickExpr.exec(e);if(n&&(n[1]||!t)){if(n[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(n[1])&&jQuery.isPlainObject(t))for(n in t)jQuery.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return r=document.getElementById(n[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=document,this.selector=e,this}return!t||t.jquery?(t||rootjQuery).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?typeof rootjQuery.ready!="undefined"?rootjQuery.ready(e):e(jQuery):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))};init.prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.extend({dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}}),jQuery.fn.extend({has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?indexOf.call(jQuery(e),this[0]):indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}});var rnotwhite=/\S+/g,optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return u&&(!n||a)&&(t=t||[],t=[e,t.slice?t.slice():t],r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}});var readyList;jQuery.fn.ready=function(e){return jQuery.ready.promise().done(e),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready"))}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.ready.promise();var access=jQuery.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s};jQuery.acceptData=function(e){return e.nodeType===1||e.nodeType===9||!+e.nodeType},Data.uid=1,Data.accepts=jQuery.acceptData,Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&typeof t=="string"&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,jQuery.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var data_priv=new Data,data_user=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(e===undefined){if(this.length){i=data_user.get(s);if(s.nodeType===1&&!data_priv.get(s,"hasDataAttrs")){n=o.length;while(n--)o[n]&&(r=o[n].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(s,r,i[r])));data_priv.set(s,"hasDataAttrs",!0)}}return i}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):access(this,function(t){var n,r=jQuery.camelCase(e);if(s&&t===undefined){n=data_user.get(s,e);if(n!==undefined)return n;n=data_user.get(s,r);if(n!==undefined)return n;n=dataAttr(s,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,cssExpand=["Top","Right","Bottom","Left"],isHidden=function(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)},rcheckableType=/^(?:checkbox|radio)$/i;(function(){var e=document.createDocumentFragment(),t=e.appendChild(document.createElement("div")),n=document.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),support.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(t){return typeof jQuery!==strundefined&&jQuery.event.triggered!==t.type?jQuery.event.dispatch.apply(e,arguments):undefined}),t=(t||"").match(rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=hasOwn.call(e,"type")?e.type:e,p=hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&f.apply&&jQuery.acceptData(s)&&(e.result=f.apply(s,t),e.result===!1&&e.preventDefault());return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&e.returnValue===!1?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=data_priv.access(r,t);i||r.addEventListener(e,n,!0),data_priv.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=data_priv.access(r,t)-1;i?data_priv.access(r,t,i):(r.removeEventListener(e,n,!0),data_priv.remove(r,t))}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=t.createDocumentFragment(),c=[],h=0,p=e.length;for(;h<p;h++){i=e[h];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(c,i.nodeType?[i]:i);else if(!rhtml.test(i))c.push(t.createTextNode(i));else{s=s||l.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.lastChild;jQuery.merge(c,s.childNodes),s=l.firstChild,s.textContent=""}}l.textContent="",h=0;while(i=c[h++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(l.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return l},cleanData:function(e){var t,n,r,i,s=jQuery.event.special,o=0;for(;(n=e[o])!==undefined;o++){if(jQuery.acceptData(n)){i=n[data_priv.expando];if(i&&(t=data_priv.cache[i])){if(t.events)for(r in t.events)s[r]?jQuery.event.remove(n,r):jQuery.removeEvent(n,r,t.handle);data_priv.cache[i]&&delete data_priv.cache[i]}}delete data_user.cache[n[data_user.expando]]}}}),jQuery.fn.extend({text:function(e){return access(this,function(e){return e===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9)this.textContent=e})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,jQuery.cleanData(getAll(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=concat.apply([],e);var n,r,i,s,o,u,a=0,f=this.length,l=this,c=f-1,h=e[0],p=jQuery.isFunction(h);if(p||f>1&&typeof h=="string"&&!support.checkClone&&rchecked.test(h))return this.each(function(n){var r=l.eq(n);p&&(e[0]=h.call(this,n,r.html())),r.domManip(e,t)});if(f){n=jQuery.buildFragment(e,this[0].ownerDocument,!1,this),r=n.firstChild,n.childNodes.length===1&&(n=r);if(r){i=jQuery.map(getAll(n,"script"),disableScript),s=i.length;for(;a<f;a++)o=n,a!==c&&(o=jQuery.clone(o,!0,!0),s&&jQuery.merge(i,getAll(o,"script"))),t.call(this[a],o,a);if(s){u=i[i.length-1].ownerDocument,jQuery.map(i,restoreScript);for(a=0;a<s;a++)o=i[a],rscriptType.test(o.type||"")&&!data_priv.access(o,"globalEval")&&jQuery.contains(u,o)&&(o.src?jQuery._evalUrl&&jQuery._evalUrl(o.src):jQuery.globalEval(o.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),push.apply(r,n.get());return this.pushStack(r)}});var iframe,elemdisplay={},rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):window.getComputedStyle(e,null)};(function(){function s(){i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",i.innerHTML="",n.appendChild(r);var s=window.getComputedStyle(i,null);e=s.top!=="1%",t=s.width==="4px",n.removeChild(r)}var e,t,n=document.documentElement,r=document.createElement("div"),i=document.createElement("div");if(!i.style)return;i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle=i.style.backgroundClip==="content-box",r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",r.appendChild(i),window.getComputedStyle&&jQuery.extend(support,{pixelPosition:function(){return s(),e},boxSizingReliable:function(){return t==null&&s(),t},reliableMarginRight:function(){var e,t=i.appendChild(document.createElement("div"));return t.style.cssText=i.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",i.style.width="1px",n.appendChild(r),e=!parseFloat(window.getComputedStyle(t,null).marginRight),n.removeChild(r),i.removeChild(t),e}})})(),jQuery.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||n!==n)return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return rdisplayswap.test(jQuery.css(e,"display"))&&e.offsetWidth===0?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)}),jQuery.fn.extend({css:function(e,t){return access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.timers=[],jQuery.fx.tick=function(){var e,t=0,n=jQuery.timers;fxNow=jQuery.now();for(;t<n.length;t++)e=n[t],!e()&&n[t]===e&&n.splice(t--,1);n.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){jQuery.timers.push(e),e()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=document.createElement("input"),t=document.createElement("select"),n=t.appendChild(document.createElement("option"));e.type="checkbox",support.checkOn=e.value!=="",support.optSelected=n.selected,t.disabled=!0,support.optDisabled=!n.disabled,e=document.createElement("input"),e.value="t",e.type="radio",support.radioValue=e.value==="t"}();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(e,t){return access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})}}),jQuery.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=attrHandle[t]||jQuery.find.attr;attrHandle[t]=function(e,t,r){var i,s;return r||(s=attrHandle[t],attrHandle[t]=i,i=n(e,t,r)!=null?t.toLowerCase():null,attrHandle[t]=s),i}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(e,t){return access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})}}),jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=typeof e=="string"&&e,a=0,f=this.length;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(u){t=(e||"").match(rnotwhite)||[];for(;a<f;a++){n=this[a],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=jQuery.trim(r),n.className!==o&&(n.className=o)}}}return this},removeClass:function(e){var t,n,r,i,s,o,u=arguments.length===0||typeof e=="string"&&e,a=0,f=this.length;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(u){t=(e||"").match(rnotwhite)||[];for(;a<f;a++){n=this[a],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?jQuery.trim(r):"",n.className!==o&&(n.className=o)}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=jQuery(this),s=e.match(rnotwhite)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=jQuery.find.attr(e,"value");return t!=null?t:jQuery.trim(jQuery.text(e))}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(r.value,s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var nonce=jQuery.now(),rquery=/\?/;jQuery.parseJSON=function(e){return JSON.parse(e+"")},jQuery.parseXML=function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=window.location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=jQuery.event&&l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+nonce++):r+(rquery.test(r)?"&":"?")+"_="+nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery._evalUrl=function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();window.attachEvent&&window.attachEvent("onunload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]()}),support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s=e.xhr(),o=++xhrId;s.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[o],t=s.onload=s.onerror=null,e==="abort"?s.abort():e==="error"?r(s.status,s.statusText):r(xhrSuccessStatus[s.status]||s.status,s.statusText,typeof s.responseText=="string"?{text:s.responseText}:undefined,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=xhrCallbacks[o]=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.parseHTML=function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&i.length&&jQuery(i).remove(),jQuery.merge([],r.childNodes))};var _load=jQuery.fn.load;jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=jQuery.trim(e.slice(u)),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length};var docElem=window.document.documentElement;jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({offset:function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]=addGetHookIf(support.pixelPosition,function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n})}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},typeof noGlobal===strundefined&&(window.jQuery=window.$=jQuery),jQuery}),define("services",["jquery"],function(e){function n(e){e.setRequestHeader("Authorization",t.token)}function r(e,t){console.log(t,e)}var t;e.ajaxPrefilter(function(e,t,n){e.url="https://game-service.herokuapp.com"+t.url});var i=function(t,n){e.ajax({method:"POST",url:"/level",data:{levelIndex:t},success:n||r})},s=function(n,i,s){e.ajax({method:"POST",url:"/login",data:{username:n,password:i},success:function(i,o,u){s=s||r,i.success&&(t=i,e(window).trigger("loggedIn",n)),s(i,o)}})},o=function(n,i,s){e.ajax({method:"POST",url:"/register",data:{username:n,password:i},success:function(i,o,u){s=s||r,i.success&&(t=i,e(window).trigger("loggedIn",n)),s(i,o)}})},u=function(t){e.ajax({method:"GET",beforeSend:n,url:"/leaderProfile",success:t||r})},a=function(t){e.ajax({method:"POST",beforeSend:n,url:"/profile",success:t||r})},f=function(t,i,s){e.ajax({method:"POST",beforeSend:n,url:"/score",data:{levelIndex:t,score:i},success:s||r})},l=function(t,i){e.ajax({method:"POST",beforeSend:n,url:"/editProfile",data:t,success:i||r})},c=function(t,i){e.ajax({method:"POST",beforeSend:n,url:"/changePassword",data:t,success:i||r})},h=function(i){e.ajax({method:"GET",beforeSend:n,url:"/logout",success:function(e,n,s){i=i||r,e.success&&(t=undefined),i(e,n)}})};return{level:i,login:s,register:o,leaderProfile:u,profile:a,editProfile:l,changePassword:c,logout:h,score:f,getLoginData:function(){return t}}}),define("gameRegister",["jquery","services"],function(e,t){function r(t){t?(e("#gameViewDiv").hide(),n.show(),e("input[type=text], textarea").val(""),e("input[type=password], textarea").val(""),e(window).trigger("gameView",!1)):(e("#gameViewDiv").show(),n.hide(),e(window).trigger("gameView",!0))}var n=e('<div class="row"><div class="col-md-6 col-md-offset-3"><h2 class="text-center">Please Sign Up</h2><div class="well"><form><div class="form-group has-feedback"><label class="control-label" for="username">Real Name</label><input type="text" class="form-control" name="name" placeholder="Enter a name"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="username">Username</label><input id="registerUsernameField" type="text" class="form-control" name="username" placeholder="Enter a username"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="password">Password</label><input id="registerPasswordField" type="password" class="form-control" name="password" placeholder="Enter a password"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><input id="registerViewButton" type="button" value="Sign up" class="btn btn-lg btn-primary"><input id="registerCancel" type="reset" value="Cancel" class="btn btn-lg btn-primary"></form></div></div></div>');e("#maincontainer").append(n),n.hide(),e("#register").click(function(){r(!0)}),e("#registerViewButton").click(function(){t.register(e("#registerUsernameField").val(),e("#registerPasswordField").val(),function(e,t){console.log("data: ",e),e.success?r(!1):alert("Username already taken")})}),e("#registerCancel").click(function(){r(!1)})}),define("gameLogin",["jquery","services"],function(e,t){function r(t){t?(e("#loginMsg").hide(),e("#gameViewDiv").hide(),n.show(),e(window).trigger("gameView",!1)):(e("#gameViewDiv").show(),n.hide(),e(window).trigger("gameView",!0))}var n=e('<div class="row"><div class="col-md-6 col-md-offset-3"><h2 class="text-center">Please login</h2><div class="well"><form><div class="form-group has-feedback"><label class="control-label" for="username">Username</label><input id="loginUsernameField" type="text" class="form-control" name="username" placeholder="Enter a username"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="password">Password</label><input id="loginPasswordField" type="password" class="form-control" name="password" placeholder="Enter a password"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><input id="loginViewButton" type="button" value="Login" class="btn btn-lg btn-primary"><input id="loginCancel" type="button" value="Cancel" class="btn btn-lg btn-primary"><span id="loginMsg" style="color: red; font-size: 100%"> Ooops... invalid entry!</span></form></div></div> </div>');e("#maincontainer").append(n),n.hide(),e("#login").click(function(){r(!0)}),e("#loginViewButton").click(function(){t.login(e("#loginUsernameField").val(),e("#loginPasswordField").val(),function(t,n){t.success?r(!1):e("#loginMsg").show()})}),e("#loginCancel").click(function(){r(!1)})}),define("gameProfile",["jquery","services"],function(e,t){function o(t){t?(e("#gameViewDiv").hide(),n.show(),e(window).trigger("gameView",!1)):(e("#gameViewDiv").show(),n.hide(),e(window).trigger("gameView",!0))}function u(t){e("#profileRealName").text(t.meta.firstname+" "+t.meta.lastname),e("#profileUsername").text(t.username),e("#profileEmail").attr("href","mailto:"+t.meta.email),t.meta.last_visitor?(e("#lastVisitorName").text(t.meta.last_visitor.name),e("#lastVisitorEmail").prop("href","mailto:"+t.meta.last_visitor.email),e("#lastVisitorEmail").text("("+t.meta.last_visitor.email+")"),e("#lastVisitorDate").text(new Date(t.meta.last_visitor.date))):(e("#lastVisitorName").text(""),e("#lastVisitorEmail").text(""),e("#lastVisitorDate").text("")),e("#profileHobby").text(t.meta.hobby),e("#profileCountry").text(t.meta.country),e("#profileOccupation").text(t.meta.occupation),e("#profileLastUpdate").text(new Date(t.updated_at)),e("#profileCreatedAt").text(new Date(t.created_at))}function a(t){t?(e("#gameViewDiv").hide(),s.show(),e(window).trigger("gameView",!1)):(e("#gameViewDiv").show(),s.hide(),e(window).trigger("gameView",!0))}function f(e){e?(s.hide(),r.show()):(s.show(),r.hide())}function l(t){t?(e("#changePasswordMsg").hide(),s.hide(),i.show()):(s.show(),i.hide())}var n=e('<div class="page-header text-center"><h1><span class="fa fa-anchor"></span> Leader Profile</h1><a href="#" id="leaderProfileBackToGame" class="btn btn-default btn-sm">Back to game</a></div><div class="row"><div class="col-xs-12"><div class="well"><h3><span class="fa fa-user"></span> Local</h3><p><strong>Real name</strong>: <span id="leaderProfileRealName"></span><br><strong>username</strong>: <span id="leaderProfileUsername"></span><br><strong>email</strong>: <a id="leaderProfileEmail"></a><br><strong>Occupation</strong>: <span id="leaderProfileOccupation"></span><br><strong>Hobby</strong>: <span id="leaderProfileHobby"></span><br><strong>Country</strong>: <span id="leaderProfileCountry"></span><br><strong>Created at</strong>: <span id="leaderProfileCreatedAt"></span><br><strong>Last update</strong>: <span id="leaderProfileLastUpdate"></span></p></div></div></div>');e("#maincontainer").append(n),n.hide();var r=e('<div class="row"><div class="col-md-6 col-md-offset-3"><h2 class="text-center">Edit your profile</h2><div class="well"><form action="" method="post"><div class="form-group has-feedback"><label class="control-label" for="firstname">Firstname</label><input id="editProfileFirstName" type="text" class="form-control" name="firstname"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="lastname">Lastname</label><input id="editProfileLastName" type="text" class="form-control" name="lastname"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="email">email</label><input id="editProfileEmail" type="email" class="form-control" name="email"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="occupation">Occupation</label><input id="editProfileOccupation" type="text" class="form-control" name="occupation"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="hobby">Hobby</label><input id="editProfileHobby" type="text" class="form-control" name="hobby"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="country">Country</label><input id="editProfileCountry" type="text" class="form-control" name="country"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><input id="editProfileSave" type="button" value="Save" class="btn btn-lg btn-primary"><input id="editProfileCancel" type="reset" value="Cancel" class="btn btn-lg btn-primary"></form></div></div></div>');e("#maincontainer").append(r),r.hide();var i=e('<div class="row"><div class="col-md-6 col-md-offset-3"><h2 class="text-center">Change password</h2><div class="well"><form><div class="form-group has-feedback"><label class="control-label" for="oldPassword">Old password</label><input id="oldPassword" type="password" class="form-control" name="oldPassword"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="newPassword">New password</label><input id="newPassword" type="password" class="form-control" name="newPassword"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><div class="form-group has-feedback"><label class="control-label" for="confirmPassword">Confirm password</label><input id="confirmPassword" type="password" class="form-control" name="confirmPassword"><span class="glyphicon glyphicon-remove form-control-feedback hide"></span></div><input id="changePasswordChange" type="button" value="Change" class="btn btn-lg btn-primary"><input id="changePasswordCancel" type="reset" value="Cancel" class="btn btn-lg btn-primary"><span id="changePasswordMsg" style="color: red; font-size: 100%"> Ooops... invalid entry!</span></form></div></div></div>');e("#maincontainer").append(i),i.hide();var s=e('<div class="page-header text-center"><h1><span class="fa fa-anchor"></span> User Profile</h1><a href="#" id="logout" class="btn btn-default btn-sm">Logout</a><a href="#" id="editProfile" class="btn btn-default btn-sm">Edit profile</a><a href="#" id="changePassword" class="btn btn-default btn-sm">Change password</a><a href="#" id="backToGame" class="btn btn-default btn-sm">Back to game</a></div><div class="row"><div class="col-xs-12"><div class="well"><h3><span class="fa fa-user"></span> Local</h3><p><strong>Real name</strong>: <span id="profileRealName"></span><br><strong>username</strong>: <span id="profileUsername"></span><br><strong>Occupation</strong>: <span id="profileOccupation"></span><br><strong>Hobby</strong>: <span id="profileHobby"></span><br><strong>Country</strong>: <span id="profileCountry"></span><br><strong>Created at</strong>: <span id="profileCreatedAt"></span><br><strong>Last update</strong>: <span id="profileLastUpdate"></span><br><br><strong>Last visitor</strong>: <span id="lastVisitorName"></span><a id="lastVisitorEmail"></a><br><strong>Time of visit</strong>: <span id="lastVisitorDate"></span><br></p></div></div></div>');e("#maincontainer").append(s),s.hide(),e("#name_href").click(function(){t.leaderProfile(function(t,n){e("#leaderProfileRealName").text(t.meta.firstname+" "+t.meta.lastname),e("#leaderProfileUsername").text(t.username),e("#leaderProfileEmail").attr("href","mailto:"+t.meta.email),e("#leaderProfileEmail").text(t.meta.email),e("#leaderProfileHobby").text(t.meta.hobby),e("#leaderProfileCountry").text(t.meta.country),e("#leaderProfileOccupation").text(t.meta.occupation),e("#leaderProfileLastUpdate").text(new Date(t.updated_at)),e("#leaderProfileCreatedAt").text(new Date(t.created_at)),o(!0)})}),e("#leaderProfileBackToGame").click(function(){o(!1)}),e("#profile").click(function(){t.profile(function(e,t){u(e),a(!0)})}),e("#backToGame").click(function(){a(!1)}),e("#logout").click(function(){t.logout(function(t,n){e("#authenticatedSpan").hide(),e("#notAuthenticatedSpan").show(),e("#name_href").hide(),e("#name").show(),a(!1)})}),e("#editProfile").click(function(){t.profile(function(t,n){e("#editProfileFirstName").val(t.meta.firstname),e("#editProfileLastName").val(t.meta.lastname),e("#editProfileHobby").val(t.meta.hobby),e("#editProfileOccupation").val(t.meta.occupation),e("#editProfileCountry").val(t.meta.country),e("#editProfileEmail").val(t.meta.email),f(!0)})}),e("#editProfileSave").click(function(){t.editProfile({firstname:e("#editProfileFirstName").val(),lastname:e("#editProfileLastName").val(),hobby:e("#editProfileHobby").val(),occupation:e("#editProfileOccupation").val(),country:e("#editProfileCountry").val(),email:e("#editProfileEmail").val(),updated_at:new Date},function(e,n){t.profile(function(e){u(e),f(!1)})})}),e("#editProfileCancel").click(function(){f(!1)}),e("#changePassword").click(function(){l(!0)}),e("#changePasswordChange").click(function(){t.changePassword({oldPassword:e("#oldPassword").val(),newPassword:e("#newPassword").val(),confirmPassword:e("#confirmPassword").val()},function(t,n){t.id!==undefined?l(!1):e("#changePasswordMsg").show(),e("input[type=password], textarea").val("")})}),e("#changePasswordCancel").click(function(){l(!1)}),f(!1),l(!1),a(!1),o(!1)}),function(){function e(e){function t(t,n,r,i,s,o){for(;s>=0&&o>s;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=b(r,s,4);var o=!C(n)&&y.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function t(e){return function(t,n,r){n=w(n,r);for(var i=N(t),s=e>0?0:i-1;s>=0&&i>s;s+=e)if(n(t[s],s,t))return s;return-1}}function n(e,t,n){return function(r,i,s){var o=0,u=N(r);if("number"==typeof s)e>0?o=s>=0?s:Math.max(s+u,o):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(l.call(r,o,u),y.isNaN),s>=0?s+o:-1;for(s=e>0?o:u-1;s>=0&&u>s;s+=e)if(r[s]===i)return s;return-1}}function r(e,t){var n=M.length,r=e.constructor,i=y.isFunction(r)&&r.prototype||u,s="constructor";for(y.has(e,s)&&!y.contains(t,s)&&t.push(s);n--;)s=M[n],s in e&&e[s]!==i[s]&&!y.contains(t,s)&&t.push(s)}var i=this,s=i._,o=Array.prototype,u=Object.prototype,a=Function.prototype,f=o.push,l=o.slice,c=u.toString,h=u.hasOwnProperty,p=Array.isArray,d=Object.keys,v=a.bind,m=Object.create,g=function(){},y=function(e){return e instanceof y?e:this instanceof y?void (this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):i._=y,y.VERSION="1.8.3";var b=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},w=function(e,t,n){return null==e?y.identity:y.isFunction(e)?b(e,t,n):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return w(e,t,1/0)};var E=function(e,t){return function(n){var r=arguments.length;if(2>r||null==n)return n;for(var i=1;r>i;i++)for(var s=arguments[i],o=e(s),u=o.length,a=0;u>a;a++){var f=o[a];t&&n[f]!==void 0||(n[f]=s[f])}return n}},S=function(e){if(!y.isObject(e))return{};if(m)return m(e);g.prototype=e;var t=new g;return g.prototype=null,t},x=function(e){return function(t){return null==t?void 0:t[e]}},T=Math.pow(2,53)-1,N=x("length"),C=function(e){var t=N(e);return"number"==typeof t&&t>=0&&T>=t};y.each=y.forEach=function(e,t,n){t=b(t,n);var r,i;if(C(e))for(r=0,i=e.length;i>r;r++)t(e[r],r,e);else{var s=y.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},y.map=y.collect=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=Array(i),o=0;i>o;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},y.reduce=y.foldl=y.inject=e(1),y.reduceRight=y.foldr=e(-1),y.find=y.detect=function(e,t,n){var r;return r=C(e)?y.findIndex(e,t,n):y.findKey(e,t,n),r!==void 0&&r!==-1?e[r]:void 0},y.filter=y.select=function(e,t,n){var r=[];return t=w(t,n),y.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},y.reject=function(e,t,n){return y.filter(e,y.negate(w(t)),n)},y.every=y.all=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},y.some=y.any=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,n,r){return C(e)||(e=y.values(e)),("number"!=typeof n||r)&&(n=0),y.indexOf(e,t,n)>=0},y.invoke=function(e,t){var n=l.call(arguments,2),r=y.isFunction(t);return y.map(e,function(e){var i=r?t:e[t];return null==i?i:i.apply(e,n)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=C(e)?e:y.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=w(t,n),y.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},y.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=C(e)?e:y.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=w(t,n),y.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},y.shuffle=function(e){for(var t,n=C(e)?e:y.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=y.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},y.sample=function(e,t,n){return null==t||n?(C(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,n){return t=w(t,n),y.pluck(y.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var k=function(e){return function(t,n,r){var i={};return n=w(n,r),y.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};y.groupBy=k(function(e,t,n){y.has(e,n)?e[n].push(t):e[n]=[t]}),y.indexBy=k(function(e,t,n){e[n]=t}),y.countBy=k(function(e,t,n){y.has(e,n)?e[n]++:e[n]=1}),y.toArray=function(e){return e?y.isArray(e)?l.call(e):C(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:C(e)?e.length:y.keys(e).length},y.partition=function(e,t,n){t=w(t,n);var r=[],i=[];return y.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},y.first=y.head=y.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:y.initial(e,e.length-t)},y.initial=function(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},y.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:y.rest(e,Math.max(0,e.length-t))},y.rest=y.tail=y.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var L=function(e,t,n,r){for(var i=[],s=0,o=r||0,u=N(e);u>o;o++){var a=e[o];if(C(a)&&(y.isArray(a)||y.isArguments(a))){t||(a=L(a,t,n));var f=0,l=a.length;for(i.length+=l;l>f;)i[s++]=a[f++]}else n||(i[s++]=a)}return i};y.flatten=function(e,t){return L(e,t,!1)},y.without=function(e){return y.difference(e,l.call(arguments,1))},y.uniq=y.unique=function(e,t,n,r){y.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=w(n,r));for(var i=[],s=[],o=0,u=N(e);u>o;o++){var a=e[o],f=n?n(a,o,e):a;t?(o&&s===f||i.push(a),s=f):n?y.contains(s,f)||(s.push(f),i.push(a)):y.contains(i,a)||i.push(a)}return i},y.union=function(){return y.uniq(L(arguments,!0,!0))},y.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=N(e);i>r;r++){var s=e[r];if(!y.contains(t,s)){for(var o=1;n>o&&y.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},y.difference=function(e){var t=L(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,N).length||0,n=Array(t),r=0;t>r;r++)n[r]=y.pluck(e,r);return n},y.object=function(e,t){for(var n={},r=0,i=N(e);i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},y.findIndex=t(1),y.findLastIndex=t(-1),y.sortedIndex=function(e,t,n,r){n=w(n,r,1);for(var i=n(t),s=0,o=N(e);o>s;){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},y.indexOf=n(1,y.findIndex,y.sortedIndex),y.lastIndexOf=n(-1,y.findLastIndex),y.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var A=function(e,t,n,r,i){if(r instanceof t){var s=S(e.prototype),o=e.apply(s,i);return y.isObject(o)?o:s}return e.apply(n,i)};y.bind=function(e,t){if(v&&e.bind===v)return v.apply(e,l.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var n=l.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(l.call(arguments)))};return r},y.partial=function(e){var t=l.call(arguments,1),n=function(){for(var r=0,i=t.length,s=Array(i),o=0;i>o;o++)s[o]=t[o]===y?arguments[r++]:t[o];for(;r<arguments.length;)s.push(arguments[r++]);return A(e,n,this,this,s)};return n},y.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=y.bind(e[n],e);return e},y.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return y.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},y.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:y.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=y.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},y.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=y.now()-o;t>f&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=y.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},y.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},y.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},y.once=y.partial(y.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(e){if(!y.isObject(e))return[];if(d)return d(e);var t=[];for(var n in e)y.has(e,n)&&t.push(n);return O&&r(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var n in e)t.push(n);return O&&r(e,t),t},y.values=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},y.mapObject=function(e,t,n){t=w(t,n);for(var r,i=y.keys(e),s=i.length,o={},u=0;s>u;u++)r=i[u],o[r]=t(e[r],r,e);return o},y.pairs=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},y.invert=function(e){for(var t={},n=y.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},y.functions=y.methods=function(e){var t=[];for(var n in e)y.isFunction(e[n])&&t.push(n);return t.sort()},y.extend=E(y.allKeys),y.extendOwn=y.assign=E(y.keys),y.findKey=function(e,t,n){t=w(t,n);for(var r,i=y.keys(e),s=0,o=i.length;o>s;s++)if(r=i[s],t(e[r],r,e))return r},y.pick=function(e,t,n){var r,i,s={},o=e;if(null==o)return s;y.isFunction(t)?(i=y.allKeys(o),r=b(t,n)):(i=L(arguments,!1,!1,1),r=function(e,t,n){return t in n},o=Object(o));for(var u=0,a=i.length;a>u;u++){var f=i[u],l=o[f];r(l,f,o)&&(s[f]=l)}return s},y.omit=function(e,t,n){if(y.isFunction(t))t=y.negate(t);else{var r=y.map(L(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(r,t)}}return y.pick(e,t,n)},y.defaults=E(y.allKeys,!0),y.create=function(e,t){var n=S(e);return t&&y.extendOwn(n,t),n},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var n=y.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),s=0;r>s;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var _=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var i=c.call(e);if(i!==c.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,u=t.constructor;if(o!==u&&!(y.isFunction(o)&&o instanceof o&&y.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var a=n.length;a--;)if(n[a]===e)return r[a]===t;if(n.push(e),r.push(t),s){if(a=e.length,a!==t.length)return!1;for(;a--;)if(!_(e[a],t[a],n,r))return!1}else{var f,l=y.keys(e);if(a=l.length,y.keys(t).length!==a)return!1;for(;a--;)if(f=l[a],!y.has(t,f)||!_(e[f],t[f],n,r))return!1}return n.pop(),r.pop(),!0};y.isEqual=function(e,t){return _(e,t)},y.isEmpty=function(e){return null==e?!0:C(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length},y.isElement=function(e){return!!e&&1===e.nodeType},y.isArray=p||function(e){return"[object Array]"===c.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"function"!=typeof /./&&"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===c.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return e===void 0},y.has=function(e,t){return null!=e&&h.call(e,t)},y.noConflict=function(){return i._=s,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=x,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,n){var r=Array(Math.max(0,e));t=b(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=y.invert(D),H=function(e){var t=function(t){return e[t]},n="(?:"+y.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};y.escape=H(D),y.unescape=H(P),y.result=function(e,t,n){var r=null==e?void 0:e[t];return r===void 0&&(r=n),y.isFunction(r)?r.call(e):r};var B=0;y.uniqueId=function(e){var t=++B+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+F[e]};y.template=function(e,t,n){!t&&n&&(t=n),t=y.defaults({},t,y.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(I,q),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,y)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},y.chain=function(e){var t=y(e);return t._chain=!0,t};var R=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return f.apply(e,arguments),R(this,n.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],R(this,n)}}),y.each(["concat","join","slice"],function(e){var t=o[e];y.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}.call(this);var Box2D={};(function(e,t){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},e.generateCallback=function(e,t){return function(){t.apply(e,arguments)}},e.NVector=function(e){e===t&&(e=0);for(var n=Array(e||0),r=0;r<e;++r)n[r]=0;return n},e.is=function(e,n){return e===null?!1:n instanceof Function&&e instanceof n?!0:e.constructor.__implements!=t&&e.constructor.__implements[n]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D=="undefined"&&(Box2D={}),typeof Box2D.Collision=="undefined"&&(Box2D.Collision={}),typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={}),typeof Box2D.Common=="undefined"&&(Box2D.Common={}),typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={}),typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={}),typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={}),typeof Box2D.Dynamics.Controllers=="undefined"&&(Box2D.Dynamics.Controllers={}),typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={}),function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments),this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function r(){r.b2Collision.apply(this,arguments)}function i(){i.b2ContactID.apply(this,arguments),this.constructor===i&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function o(){o.b2Distance.apply(this,arguments)}function u(){u.b2DistanceInput.apply(this,arguments)}function a(){a.b2DistanceOutput.apply(this,arguments)}function f(){f.b2DistanceProxy.apply(this,arguments)}function l(){l.b2DynamicTree.apply(this,arguments),this.constructor===l&&this.b2DynamicTree.apply(this,arguments)}function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}function h(){h.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function d(){d.b2Manifold.apply(this,arguments),this.constructor===d&&this.b2Manifold.apply(this,arguments)}function v(){v.b2ManifoldPoint.apply(this,arguments),this.constructor===v&&this.b2ManifoldPoint.apply(this,arguments)}function m(){m.b2Point.apply(this,arguments)}function g(){g.b2RayCastInput.apply(this,arguments),this.constructor===g&&this.b2RayCastInput.apply(this,arguments)}function y(){y.b2RayCastOutput.apply(this,arguments)}function b(){b.b2Segment.apply(this,arguments)}function w(){w.b2SeparationFunction.apply(this,arguments)}function E(){E.b2Simplex.apply(this,arguments),this.constructor===E&&this.b2Simplex.apply(this,arguments)}function S(){S.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function T(){T.b2TimeOfImpact.apply(this,arguments)}function N(){N.b2TOIInput.apply(this,arguments)}function C(){C.b2WorldManifold.apply(this,arguments),this.constructor===C&&this.b2WorldManifold.apply(this,arguments)}function k(){k.ClipVertex.apply(this,arguments)}function L(){L.Features.apply(this,arguments)}function A(){A.b2CircleShape.apply(this,arguments),this.constructor===A&&this.b2CircleShape.apply(this,arguments)}function O(){O.b2EdgeChainDef.apply(this,arguments),this.constructor===O&&this.b2EdgeChainDef.apply(this,arguments)}function M(){M.b2EdgeShape.apply(this,arguments),this.constructor===M&&this.b2EdgeShape.apply(this,arguments)}function _(){_.b2MassData.apply(this,arguments)}function D(){D.b2PolygonShape.apply(this,arguments),this.constructor===D&&this.b2PolygonShape.apply(this,arguments)}function P(){P.b2Shape.apply(this,arguments),this.constructor===P&&this.b2Shape.apply(this,arguments)}function H(){H.b2Color.apply(this,arguments),this.constructor===H&&this.b2Color.apply(this,arguments)}function B(){B.b2Settings.apply(this,arguments)}function j(){j.b2Mat22.apply(this,arguments),this.constructor===j&&this.b2Mat22.apply(this,arguments)}function F(){F.b2Mat33.apply(this,arguments),this.constructor===F&&this.b2Mat33.apply(this,arguments)}function I(){I.b2Math.apply(this,arguments)}function q(){q.b2Sweep.apply(this,arguments)}function R(){R.b2Transform.apply(this,arguments),this.constructor===R&&this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments),this.constructor===U&&this.b2Vec2.apply(this,arguments)}function z(){z.b2Vec3.apply(this,arguments),this.constructor===z&&this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments),this.constructor===W&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments),this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function V(){V.b2ContactFilter.apply(this,arguments)}function $(){$.b2ContactImpulse.apply(this,arguments)}function J(){J.b2ContactListener.apply(this,arguments)}function K(){K.b2ContactManager.apply(this,arguments),this.constructor===K&&this.b2ContactManager.apply(this,arguments)}function Q(){Q.b2DebugDraw.apply(this,arguments),this.constructor===Q&&this.b2DebugDraw.apply(this,arguments)}function G(){G.b2DestructionListener.apply(this,arguments)}function Y(){Y.b2FilterData.apply(this,arguments)}function Z(){Z.b2Fixture.apply(this,arguments),this.constructor===Z&&this.b2Fixture.apply(this,arguments)}function et(){et.b2FixtureDef.apply(this,arguments),this.constructor===et&&this.b2FixtureDef.apply(this,arguments)}function tt(){tt.b2Island.apply(this,arguments),this.constructor===tt&&this.b2Island.apply(this,arguments)}function nt(){nt.b2TimeStep.apply(this,arguments)}function rt(){rt.b2World.apply(this,arguments),this.constructor===rt&&this.b2World.apply(this,arguments)}function it(){it.b2CircleContact.apply(this,arguments)}function st(){st.b2Contact.apply(this,arguments),this.constructor===st&&this.b2Contact.apply(this,arguments)}function ot(){ot.b2ContactConstraint.apply(this,arguments),this.constructor===ot&&this.b2ContactConstraint.apply(this,arguments)}function ut(){ut.b2ContactConstraintPoint.apply(this,arguments)}function at(){at.b2ContactEdge.apply(this,arguments)}function ft(){ft.b2ContactFactory.apply(this,arguments),this.constructor===ft&&this.b2ContactFactory.apply(this,arguments)}function lt(){lt.b2ContactRegister.apply(this,arguments)}function ct(){ct.b2ContactResult.apply(this,arguments)}function ht(){ht.b2ContactSolver.apply(this,arguments),this.constructor===ht&&this.b2ContactSolver.apply(this,arguments)}function pt(){pt.b2EdgeAndCircleContact.apply(this,arguments)}function dt(){dt.b2NullContact.apply(this,arguments),this.constructor===dt&&this.b2NullContact.apply(this,arguments)}function vt(){vt.b2PolyAndCircleContact.apply(this,arguments)}function mt(){mt.b2PolyAndEdgeContact.apply(this,arguments)}function gt(){gt.b2PolygonContact.apply(this,arguments)}function yt(){yt.b2PositionSolverManifold.apply(this,arguments),this.constructor===yt&&this.b2PositionSolverManifold.apply(this,arguments)}function bt(){bt.b2BuoyancyController.apply(this,arguments)}function wt(){wt.b2ConstantAccelController.apply(this,arguments)}function Et(){Et.b2ConstantForceController.apply(this,arguments)}function St(){St.b2Controller.apply(this,arguments)}function xt(){xt.b2ControllerEdge.apply(this,arguments)}function Tt(){Tt.b2GravityController.apply(this,arguments)}function Nt(){Nt.b2TensorDampingController.apply(this,arguments)}function Ct(){Ct.b2DistanceJoint.apply(this,arguments),this.constructor===Ct&&this.b2DistanceJoint.apply(this,arguments)}function kt(){kt.b2DistanceJointDef.apply(this,arguments),this.constructor===kt&&this.b2DistanceJointDef.apply(this,arguments)}function Lt(){Lt.b2FrictionJoint.apply(this,arguments),this.constructor===Lt&&this.b2FrictionJoint.apply(this,arguments)}function At(){At.b2FrictionJointDef.apply(this,arguments),this.constructor===At&&this.b2FrictionJointDef.apply(this,arguments)}function Ot(){Ot.b2GearJoint.apply(this,arguments),this.constructor===Ot&&this.b2GearJoint.apply(this,arguments)}function Mt(){Mt.b2GearJointDef.apply(this,arguments),this.constructor===Mt&&this.b2GearJointDef.apply(this,arguments)}function _t(){_t.b2Jacobian.apply(this,arguments)}function Dt(){Dt.b2Joint.apply(this,arguments),this.constructor===Dt&&this.b2Joint.apply(this,arguments)}function Pt(){Pt.b2JointDef.apply(this,arguments),this.constructor===Pt&&this.b2JointDef.apply(this,arguments)}function Ht(){Ht.b2JointEdge.apply(this,arguments)}function Bt(){Bt.b2LineJoint.apply(this,arguments),this.constructor===Bt&&this.b2LineJoint.apply(this,arguments)}function jt(){jt.b2LineJointDef.apply(this,arguments),this.constructor===jt&&this.b2LineJointDef.apply(this,arguments)}function Ft(){Ft.b2MouseJoint.apply(this,arguments),this.constructor===Ft&&this.b2MouseJoint.apply(this,arguments)}function It(){It.b2MouseJointDef.apply(this,arguments),this.constructor===It&&this.b2MouseJointDef.apply(this,arguments)}function qt(){qt.b2PrismaticJoint.apply(this,arguments),this.constructor===qt&&this.b2PrismaticJoint.apply(this,arguments)}function Rt(){Rt.b2PrismaticJointDef.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJointDef.apply(this,arguments)}function Ut(){Ut.b2PulleyJoint.apply(this,arguments),this.constructor===Ut&&this.b2PulleyJoint.apply(this,arguments)}function zt(){zt.b2PulleyJointDef.apply(this,arguments),this.constructor===zt&&this.b2PulleyJointDef.apply(this,arguments)}function Wt(){Wt.b2RevoluteJoint.apply(this,arguments),this.constructor===Wt&&this.b2RevoluteJoint.apply(this,arguments)}function Xt(){Xt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Xt&&this.b2RevoluteJointDef.apply(this,arguments)}function Vt(){Vt.b2WeldJoint.apply(this,arguments),this.constructor===Vt&&this.b2WeldJoint.apply(this,arguments)}function $t(){$t.b2WeldJointDef.apply(this,arguments),this.constructor===$t&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=e,Box2D.Collision.b2Bound=t,Box2D.Collision.b2BoundValues=n,Box2D.Collision.b2Collision=r,Box2D.Collision.b2ContactID=i,Box2D.Collision.b2ContactPoint=s,Box2D.Collision.b2Distance=o,Box2D.Collision.b2DistanceInput=u,Box2D.Collision.b2DistanceOutput=a,Box2D.Collision.b2DistanceProxy=f,Box2D.Collision.b2DynamicTree=l,Box2D.Collision.b2DynamicTreeBroadPhase=c,Box2D.Collision.b2DynamicTreeNode=h,Box2D.Collision.b2DynamicTreePair=p,Box2D.Collision.b2Manifold=d,Box2D.Collision.b2ManifoldPoint=v,Box2D.Collision.b2Point=m,Box2D.Collision.b2RayCastInput=g,Box2D.Collision.b2RayCastOutput=y,Box2D.Collision.b2Segment=b,Box2D.Collision.b2SeparationFunction=w,Box2D.Collision.b2Simplex=E,Box2D.Collision.b2SimplexCache=S,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=T,Box2D.Collision.b2TOIInput=N,Box2D.Collision.b2WorldManifold=C,Box2D.Collision.ClipVertex=k,Box2D.Collision.Features=L,Box2D.Collision.Shapes.b2CircleShape=A,Box2D.Collision.Shapes.b2EdgeChainDef=O,Box2D.Collision.Shapes.b2EdgeShape=M,Box2D.Collision.Shapes.b2MassData=_,Box2D.Collision.Shapes.b2PolygonShape=D,Box2D.Collision.Shapes.b2Shape=P,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=H,Box2D.Common.b2Settings=B,Box2D.Common.Math.b2Mat22=j,Box2D.Common.Math.b2Mat33=F,Box2D.Common.Math.b2Math=I,Box2D.Common.Math.b2Sweep=q,Box2D.Common.Math.b2Transform=R,Box2D.Common.Math.b2Vec2=U,Box2D.Common.Math.b2Vec3=z,Box2D.Dynamics.b2Body=W,Box2D.Dynamics.b2BodyDef=X,Box2D.Dynamics.b2ContactFilter=V,Box2D.Dynamics.b2ContactImpulse=$,Box2D.Dynamics.b2ContactListener=J,Box2D.Dynamics.b2ContactManager=K,Box2D.Dynamics.b2DebugDraw=Q,Box2D.Dynamics.b2DestructionListener=G,Box2D.Dynamics.b2FilterData=Y,Box2D.Dynamics.b2Fixture=Z,Box2D.Dynamics.b2FixtureDef=et,Box2D.Dynamics.b2Island=tt,Box2D.Dynamics.b2TimeStep=nt,Box2D.Dynamics.b2World=rt,Box2D.Dynamics.Contacts.b2CircleContact=it,Box2D.Dynamics.Contacts.b2Contact=st,Box2D.Dynamics.Contacts.b2ContactConstraint=ot,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ut,Box2D.Dynamics.Contacts.b2ContactEdge=at,Box2D.Dynamics.Contacts.b2ContactFactory=ft,Box2D.Dynamics.Contacts.b2ContactRegister=lt,Box2D.Dynamics.Contacts.b2ContactResult=ct,Box2D.Dynamics.Contacts.b2ContactSolver=ht,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pt,Box2D.Dynamics.Contacts.b2NullContact=dt,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=vt,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=mt,Box2D.Dynamics.Contacts.b2PolygonContact=gt,Box2D.Dynamics.Contacts.b2PositionSolverManifold=yt,Box2D.Dynamics.Controllers.b2BuoyancyController=bt,Box2D.Dynamics.Controllers.b2ConstantAccelController=wt,Box2D.Dynamics.Controllers.b2ConstantForceController=Et,Box2D.Dynamics.Controllers.b2Controller=St,Box2D.Dynamics.Controllers.b2ControllerEdge=xt,Box2D.Dynamics.Controllers.b2GravityController=Tt,Box2D.Dynamics.Controllers.b2TensorDampingController=Nt,Box2D.Dynamics.Joints.b2DistanceJoint=Ct,Box2D.Dynamics.Joints.b2DistanceJointDef=kt,Box2D.Dynamics.Joints.b2FrictionJoint=Lt,Box2D.Dynamics.Joints.b2FrictionJointDef=At,Box2D.Dynamics.Joints.b2GearJoint=Ot,Box2D.Dynamics.Joints.b2GearJointDef=Mt,Box2D.Dynamics.Joints.b2Jacobian=_t,Box2D.Dynamics.Joints.b2Joint=Dt,Box2D.Dynamics.Joints.b2JointDef=Pt,Box2D.Dynamics.Joints.b2JointEdge=Ht,Box2D.Dynamics.Joints.b2LineJoint=Bt,Box2D.Dynamics.Joints.b2LineJointDef=jt,Box2D.Dynamics.Joints.b2MouseJoint=Ft,Box2D.Dynamics.Joints.b2MouseJointDef=It,Box2D.Dynamics.Joints.b2PrismaticJoint=qt,Box2D.Dynamics.Joints.b2PrismaticJointDef=Rt,Box2D.Dynamics.Joints.b2PulleyJoint=Ut,Box2D.Dynamics.Joints.b2PulleyJointDef=zt,Box2D.Dynamics.Joints.b2RevoluteJoint=Wt,Box2D.Dynamics.Joints.b2RevoluteJointDef=Xt,Box2D.Dynamics.Joints.b2WeldJoint=Vt,Box2D.Dynamics.Joints.b2WeldJointDef=$t}(),Box2D.postDefs=[],function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,r=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2,a=Box2D.Collision.b2AABB,f=Box2D.Collision.b2Bound,l=Box2D.Collision.b2BoundValues,c=Box2D.Collision.b2Collision,h=Box2D.Collision.b2ContactID,p=Box2D.Collision.b2ContactPoint,d=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,g=Box2D.Collision.b2DistanceProxy,y=Box2D.Collision.b2DynamicTree,b=Box2D.Collision.b2DynamicTreeBroadPhase,w=Box2D.Collision.b2DynamicTreeNode,E=Box2D.Collision.b2DynamicTreePair,S=Box2D.Collision.b2Manifold,x=Box2D.Collision.b2ManifoldPoint,T=Box2D.Collision.b2Point,N=Box2D.Collision.b2RayCastInput,C=Box2D.Collision.b2RayCastOutput,k=Box2D.Collision.b2Segment,L=Box2D.Collision.b2SeparationFunction,A=Box2D.Collision.b2Simplex,O=Box2D.Collision.b2SimplexCache,M=Box2D.Collision.b2SimplexVertex,_=Box2D.Collision.b2TimeOfImpact,D=Box2D.Collision.b2TOIInput,P=Box2D.Collision.b2WorldManifold,H=Box2D.Collision.ClipVertex,B=Box2D.Collision.Features,j=Box2D.Collision.IBroadPhase;a.b2AABB=function(){this.lowerBound=new u,this.upperBound=new u},a.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},a.prototype.GetCenter=function(){return new u((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},a.prototype.GetExtents=function(){return new u((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},a.prototype.Contains=function(e){var t=!0;return t=(t=(t=(t=t&&this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y},a.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(u),f=e.normal,l=0,c=0,h=l=0;h=0;if(Math.abs(o)<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{l=1/o,c=(this.lowerBound.x-i)*l,l=(this.upperBound.x-i)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.x=h,f.y=0,n=c),r=Math.min(r,l);if(n>r)return!1}if(a<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{l=1/u,c=(this.lowerBound.y-s)*l,l=(this.upperBound.y-s)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.y=h,f.x=0,n=c),r=Math.min(r,l);if(n>r)return!1}return e.fraction=n,!0},a.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-e.upperBound.y;return e.lowerBound.x-this.upperBound.x>0||t>0?!1:this.lowerBound.x-e.upperBound.x>0||n>0?!1:!0},a.Combine=function(e,t){var n=new a;return n.Combine(e,t),n},a.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},f.b2Bound=function(){},f.prototype.IsLower=function(){return(this.value&1)==0},f.prototype.IsUpper=function(){return(this.value&1)==1},f.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},l.b2BoundValues=function(){},l.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},c.b2Collision=function(){},c.ClipSegmentToLine=function(e,t,n,r){r===undefined&&(r=0);var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r;return i=n.x*u.x+n.y*u.y-r,a<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),a*i<0&&(n=a/(a-i),i=e[s],i=i.v,i.x=o.x+n*(u.x-o.x),i.y=o.y+n*(u.y-o.y),i=e[s],i.id=(a>0?t[0]:t[1]).id,++s),s},c.EdgeSeparation=function(e,t,n,r,i){n===undefined&&(n=0),parseInt(e.m_vertexCount);var s=e.m_vertices;e=e.m_normals;var o=parseInt(r.m_vertexCount),u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},c.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y),a=f*n.R.col1.x+l*n.R.col1.y,l=f*n.R.col2.x+l*n.R.col2.y,f=0;for(var h=-Number.MAX_VALUE,p=0;p<s;++p)u=o[p],u=u.x*a+u.y*l,u>h&&(h=u,f=p);o=c.EdgeSeparation(t,n,f,r,i),u=parseInt(f-1>=0?f-1:s-1),a=c.EdgeSeparation(t,n,u,r,i),l=parseInt(f+1<s?f+1:0),h=c.EdgeSeparation(t,n,l,r,i);var d=p=0,v=0;if(a>o&&a>h)v=-1,p=u,d=a;else{if(!(h>o))return e[0]=f,o;v=1,p=l,d=h}for(;;){f=v==-1?p-1>=0?p-1:s-1:p+1<s?p+1:0,o=c.EdgeSeparation(t,n,f,r,i);if(!(o>d))break;p=f,d=o}return e[0]=p,d},c.FindIncidentEdge=function(e,t,n,r,i,s){r===undefined&&(r=0),parseInt(t.m_vertexCount);var o=t.m_normals,u=parseInt(i.m_vertexCount);t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=parseInt(a),o=parseInt(i+1<u?i+1:0),u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},c.MakeClipPointVector=function(){var e=new Vector(2);return e[0]=new H,e[1]=new H,e},c.CollidePolygons=function(e,t,n,i,s){var o;e.m_pointCount=0;var u=t.m_radius+i.m_radius;o=0,c.s_edgeAO[0]=o;var a=c.FindMaxSeparation(c.s_edgeAO,t,n,i,s);o=c.s_edgeAO[0];if(!(a>u)){var f=0;c.s_edgeBO[0]=f;var l=c.FindMaxSeparation(c.s_edgeBO,i,s,t,n);f=c.s_edgeBO[0];if(!(l>u)){var h=0,p=0;l>.98*a+.001?(a=i,i=t,t=s,n=n,h=f,e.m_type=S.e_faceB,p=1):(a=t,i=i,t=n,n=s,h=o,e.m_type=S.e_faceA,p=0),o=c.s_incidentEdge,c.FindIncidentEdge(o,a,t,h,i,n),f=parseInt(a.m_vertexCount),s=a.m_vertices,a=s[h];var d;d=h+1<f?s[parseInt(h+1)]:s[0],h=c.s_localTangent,h.Set(d.x-a.x,d.y-a.y),h.Normalize(),s=c.s_localNormal,s.x=h.y,s.y=-h.x,i=c.s_planePoint,i.Set(.5*(a.x+d.x),.5*(a.y+d.y)),l=c.s_tangent,f=t.R,l.x=f.col1.x*h.x+f.col2.x*h.y,l.y=f.col1.y*h.x+f.col2.y*h.y;var v=c.s_tangent2;v.x=-l.x,v.y=-l.y,h=c.s_normal,h.x=l.y,h.y=-l.x;var m=c.s_v11,g=c.s_v12;m.x=t.position.x+(f.col1.x*a.x+f.col2.x*a.y),m.y=t.position.y+(f.col1.y*a.x+f.col2.y*a.y),g.x=t.position.x+(f.col1.x*d.x+f.col2.x*d.y),g.y=t.position.y+(f.col1.y*d.x+f.col2.y*d.y),t=h.x*m.x+h.y*m.y,f=l.x*g.x+l.y*g.y+u,d=c.s_clipPoints1,a=c.s_clipPoints2,g=0,g=c.ClipSegmentToLine(d,o,v,-l.x*m.x-l.y*m.y+u);if(!(g<2)){g=c.ClipSegmentToLine(a,d,l,f);if(!(g<2)){e.m_localPlaneNormal.SetV(s),e.m_localPoint.SetV(i);for(i=s=0;i<r.b2_maxManifoldPoints;++i)o=a[i],h.x*o.v.x+h.y*o.v.y-t<=u&&(l=e.m_points[s],f=n.R,v=o.v.x-n.position.x,m=o.v.y-n.position.y,l.m_localPoint.x=v*f.col1.x+m*f.col1.y,l.m_localPoint.y=v*f.col2.x+m*f.col2.y,l.m_id.Set(o.id),l.m_id.features.flip=p,++s);e.m_pointCount=s}}}}},c.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);n=n.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=i.R,o=r.m_p,u=i.position.x+(s.col1.x*o.x+s.col2.x*o.y)-u,i=i.position.y+(s.col1.y*o.x+s.col2.y*o.y)-n,s=t.m_radius+r.m_radius,u*u+i*i>s*s||(e.m_type=S.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0)},c.CollidePolygonAndCircle=function(e,t,n,r,i){var s=e.m_pointCount=0,o=0,u,a;a=i.R,u=r.m_p;var f=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);s=i.position.x+(a.col1.x*u.x+a.col2.x*u.y)-n.position.x,o=f-n.position.y,a=n.R,n=s*a.col1.x+o*a.col1.y,a=s*a.col2.x+o*a.col2.y;var l=0;f=-Number.MAX_VALUE,i=t.m_radius+r.m_radius;var c=parseInt(t.m_vertexCount),h=t.m_vertices;t=t.m_normals;for(var p=0;p<c;++p){u=h[p],s=n-u.x,o=a-u.y,u=t[p],s=u.x*s+u.y*o;if(s>i)return;s>f&&(f=s,l=p)}s=parseInt(l),o=parseInt(s+1<c?s+1:0),u=h[s],h=h[o];if(f<Number.MIN_VALUE)e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.SetV(t[l]),e.m_localPoint.x=.5*(u.x+h.x),e.m_localPoint.y=.5*(u.y+h.y);else{f=(n-h.x)*(u.x-h.x)+(a-h.y)*(u.y-h.y);if((n-u.x)*(h.x-u.x)+(a-u.y)*(h.y-u.y)<=0){if((n-u.x)*(n-u.x)+(a-u.y)*(a-u.y)>i*i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=n-u.x,e.m_localPlaneNormal.y=a-u.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(u)}else if(f<=0){if((n-h.x)*(n-h.x)+(a-h.y)*(a-h.y)>i*i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=n-h.x,e.m_localPlaneNormal.y=a-h.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(h)}else{l=.5*(u.x+h.x),u=.5*(u.y+h.y),f=(n-l)*t[s].x+(a-u)*t[s].y;if(f>i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=t[s].x,e.m_localPlaneNormal.y=t[s].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(l,u)}}e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},c.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.y-r.y;return i>0||s>0?!1:n.x-r.x>0||o>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new u,Box2D.Collision.b2Collision.s_localNormal=new u,Box2D.Collision.b2Collision.s_planePoint=new u,Box2D.Collision.b2Collision.s_normal=new u,Box2D.Collision.b2Collision.s_tangent=new u,Box2D.Collision.b2Collision.s_tangent2=new u,Box2D.Collision.b2Collision.s_v11=new u,Box2D.Collision.b2Collision.s_v12=new u,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new u,Box2D.Collision.b2Collision.b2_nullFeature=255}),h.b2ContactID=function(){this.features=new B},h.prototype.b2ContactID=function(){this.features._m_id=this},h.prototype.Set=function(e){this.key=e._key},h.prototype.Copy=function(){var e=new h;return e.key=this.key,e},Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),p.b2ContactPoint=function(){this.position=new u,this.velocity=new u,this.normal=new u,this.id=new h},d.b2Distance=function(){},d.Distance=function(e,t,n){++d.b2_gjkCalls;var s=n.proxyA,o=n.proxyB,a=n.transformA,f=n.transformB,l=d.s_simplex;l.ReadCache(t,s,a,o,f);var c=l.m_vertices,h=d.s_saveA,p=d.s_saveB,v=0;l.GetClosestPoint().LengthSquared();for(var m=0,g,y=0;y<20;){v=l.m_count;for(m=0;m<v;m++)h[m]=c[m].indexA,p[m]=c[m].indexB;switch(l.m_count){case 1:break;case 2:l.Solve2();break;case 3:l.Solve3();break;default:r.b2Assert(!1)}if(l.m_count==3)break;g=l.GetClosestPoint(),g.LengthSquared(),m=l.GetSearchDirection();if(m.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;g=c[l.m_count],g.indexA=s.GetSupport(i.MulTMV(a.R,m.GetNegative())),g.wA=i.MulX(a,s.GetVertex(g.indexA)),g.indexB=o.GetSupport(i.MulTMV(f.R,m)),g.wB=i.MulX(f,o.GetVertex(g.indexB)),g.w=i.SubtractVV(g.wB,g.wA),++y,++d.b2_gjkIters;var b=!1;for(m=0;m<v;m++)if(g.indexA==h[m]&&g.indexB==p[m]){b=!0;break}if(b)break;++l.m_count}d.b2_gjkMaxIters=i.Max(d.b2_gjkMaxIters,y),l.GetWitnessPoints(e.pointA,e.pointB),e.distance=i.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=y,l.WriteCache(t),n.useRadii&&(t=s.m_radius,o=o.m_radius,e.distance>t+o&&e.distance>Number.MIN_VALUE?(e.distance-=t+o,n=i.SubtractVV(e.pointB,e.pointA),n.Normalize(),e.pointA.x+=t*n.x,e.pointA.y+=t*n.y,e.pointB.x-=o*n.x,e.pointB.y-=o*n.y):(g=new u,g.x=.5*(e.pointA.x+e.pointB.x),g.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=g.x,e.pointA.y=e.pointB.y=g.y,e.distance=0))},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new A,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),v.b2DistanceInput=function(){},m.b2DistanceOutput=function(){this.pointA=new u,this.pointB=new u},g.b2DistanceProxy=function(){},g.prototype.Set=function(i){switch(i.GetType()){case n.e_circleShape:i=i instanceof e?i:null,this.m_vertices=new Vector(1,!0),this.m_vertices[0]=i.m_p,this.m_count=1,this.m_radius=i.m_radius;break;case n.e_polygonShape:i=i instanceof t?i:null,this.m_vertices=i.m_vertices,this.m_count=i.m_vertexCount,this.m_radius=i.m_radius;break;default:r.b2Assert(!1)}},g.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},g.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},g.prototype.GetVertexCount=function(){return this.m_count},g.prototype.GetVertex=function(e){return e===undefined&&(e=0),r.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},y.b2DynamicTree=function(){},y.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},y.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),i=r.b2_aabbExtension,s=r.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-i,n.aabb.lowerBound.y=e.lowerBound.y-s,n.aabb.upperBound.x=e.upperBound.x+i,n.aabb.upperBound.y=e.upperBound.y+s,n.userData=t,this.InsertLeaf(n),n},y.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},y.prototype.MoveProxy=function(e,t,n){r.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var i=r.b2_aabbExtension+r.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=r.b2_aabbExtension+r.b2_aabbMultiplier*(n.y>0?n.y:-n.y),e.aabb.lowerBound.x=t.lowerBound.x-i,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+i,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},y.prototype.Rebalance=function(e){e===undefined&&(e=0);if(this.m_root!=null)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;n.IsLeaf()==0;)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},y.prototype.GetFatAABB=function(e){return e.aabb},y.prototype.GetUserData=function(e){return e.userData},y.prototype.Query=function(e,t){if(this.m_root!=null){var n=new Vector,r=0;for(n[r++]=this.m_root;r>0;){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e(i))break}else n[r++]=i.child1,n[r++]=i.child2}}},y.prototype.RayCast=function(e,t){if(this.m_root!=null){var n=t.p1,r=t.p2,s=i.SubtractVV(n,r);s.Normalize(),s=i.CrossFV(1,s);var o=i.AbsV(s),u=t.maxFraction,f=new a,l=0,c=0;l=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,c),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,c);var h=new Vector,p=0;for(h[p++]=this.m_root;p>0;){u=h[--p];if(u.aabb.TestOverlap(f)!=0){l=u.aabb.GetCenter(),c=u.aabb.GetExtents();if(!(Math.abs(s.x*(n.x-l.x)+s.y*(n.y-l.y))-o.x*c.x-o.y*c.y>0))if(u.IsLeaf()){l=new N,l.p1=t.p1,l.p2=t.p2,l.maxFraction=t.maxFraction,u=e(l,u);if(u==0)break;u>0&&(l=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,c),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,c))}else h[p++]=u.child1,h[p++]=u.child2}}}},y.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new w},y.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},y.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null)this.m_root=e,this.m_root.parent=null;else{var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1;n=n.child2,n=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?r:n}while(n.IsLeaf()==0);t=n.parent,r=this.AllocateNode(),r.parent=t,r.userData=null,r.aabb.Combine(e.aabb,n.aabb);if(t){n.parent.child1==n?t.child1=r:t.child2=r,r.child1=n,r.child2=e,n.parent=r,e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb),r=t,t=t.parent}while(t)}else r.child1=n,r.child2=e,n.parent=r,this.m_root=e.parent=r}},y.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent;e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e,e.parent=n;for(this.FreeNode(t);n;){t=n.aabb,n.aabb=a.Combine(n.child1.aabb,n.child2.aabb);if(t.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(t)}},b.b2DynamicTreeBroadPhase=function(){this.m_tree=new y,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},b.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},b.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},b.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},b.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},b.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},b.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},b.prototype.GetProxyCount=function(){return this.m_proxyCount},b.prototype.UpdatePairs=function(e){var t=this,n=t.m_pairCount=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];var i=t.m_tree.GetFatAABB(r);t.m_tree.Query(function(e){if(e==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new E);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyA=e<r?e:r,n.proxyB=e>=r?e:r,++t.m_pairCount,!0},i)}for(n=t.m_moveBuffer.length=0;n<t.m_pairCount;){i=t.m_pairBuffer[n];var s=t.m_tree.GetUserData(i.proxyA),o=t.m_tree.GetUserData(i.proxyB);e(s,o);for(++n;n<t.m_pairCount;){s=t.m_pairBuffer[n];if(s.proxyA!=i.proxyA||s.proxyB!=i.proxyB)break;++n}}},b.prototype.Query=function(e,t){this.m_tree.Query(e,t)},b.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},b.prototype.Validate=function(){},b.prototype.Rebalance=function(e){e===undefined&&(e=0),this.m_tree.Rebalance(e)},b.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},b.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(e)),1)},b.prototype.ComparePairs=function(){return 0},b.__implements={},b.__implements[j]=!0,w.b2DynamicTreeNode=function(){this.aabb=new a},w.prototype.IsLeaf=function(){return this.child1==null},E.b2DynamicTreePair=function(){},S.b2Manifold=function(){this.m_pointCount=0},S.prototype.b2Manifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new x;this.m_localPlaneNormal=new u,this.m_localPoint=new u},S.prototype.Reset=function(){for(var e=0;e<r.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof x?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},S.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<r.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof x?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},S.prototype.Copy=function(){var e=new S;return e.Set(this),e},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),x.b2ManifoldPoint=function(){this.m_localPoint=new u,this.m_id=new h},x.prototype.b2ManifoldPoint=function(){this.Reset()},x.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},x.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},T.b2Point=function(){this.p=new u},T.prototype.Support=function(){return this.p},T.prototype.GetFirstVertex=function(){return this.p},N.b2RayCastInput=function(){this.p1=new u,this.p2=new u},N.prototype.b2RayCastInput=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=1),e&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=n},C.b2RayCastOutput=function(){this.normal=new u},k.b2Segment=function(){this.p1=new u,this.p2=new u},k.prototype.TestSegment=function(e,t,n,r){r===undefined&&(r=0);var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y;n=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y;i=l*n+c*u;if(0<=i&&i<=r*f){r=-s*c+o*l;if(-a*f<=r&&r<=f*(1+a))return i/=f,r=Math.sqrt(n*n+u*u),n/=r,u/=r,e[0]=i,t.Set(n,u),!0}}return!1},k.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},k.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},k.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},L.b2SeparationFunction=function(){this.m_localPoint=new u,this.m_axis=new u},L.prototype.Initialize=function(e,t,n,s,o){this.m_proxyA=t,this.m_proxyB=s;var a=parseInt(e.count);r.b2Assert(0<a&&a<3);var f,l,c,h,p=h=c=s=t=0,d=0;p=0,a==1?(this.m_type=L.e_points,f=this.m_proxyA.GetVertex(e.indexA[0]),l=this.m_proxyB.GetVertex(e.indexB[0]),a=f,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=l,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),this.m_axis.x=c-t,this.m_axis.y=h-s,this.m_axis.Normalize()):(e.indexB[0]==e.indexB[1]?(this.m_type=L.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),s=this.m_proxyA.GetVertex(e.indexA[1]),l=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+s.x),this.m_localPoint.y=.5*(t.y+s.y),this.m_axis=i.CrossVF(i.SubtractVV(s,t),1),this.m_axis.Normalize(),a=this.m_axis,e=n.R,p=e.col1.x*a.x+e.col2.x*a.y,d=e.col1.y*a.x+e.col2.y*a.y,a=this.m_localPoint,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=l,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),p=(c-t)*p+(h-s)*d):e.indexA[0]==e.indexA[0]?(this.m_type=L.e_faceB,c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),f=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(c.x+h.x),this.m_localPoint.y=.5*(c.y+h.y),this.m_axis=i.CrossVF(i.SubtractVV(h,c),1),this.m_axis.Normalize(),a=this.m_axis,e=o.R,p=e.col1.x*a.x+e.col2.x*a.y,d=e.col1.y*a.x+e.col2.y*a.y,a=this.m_localPoint,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=f,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),p=(t-c)*p+(s-h)*d):(t=this.m_proxyA.GetVertex(e.indexA[0]),s=this.m_proxyA.GetVertex(e.indexA[1]),c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),i.MulX(n,f),f=i.MulMV(n.R,i.SubtractVV(s,t)),i.MulX(o,l),p=i.MulMV(o.R,i.SubtractVV(h,c)),o=f.x*f.x+f.y*f.y,l=p.x*p.x+p.y*p.y,e=i.SubtractVV(p,f),n=f.x*e.x+f.y*e.y,e=p.x*e.x+p.y*e.y,f=f.x*p.x+f.y*p.y,d=o*l-f*f,p=0,d!=0&&(p=i.Clamp((f*e-n*l)/d,0,1)),(f*p+e)/l<0&&(p=i.Clamp((f-n)/o,0,1)),f=new u,f.x=t.x+p*(s.x-t.x),f.y=t.y+p*(s.y-t.y),l=new u,l.x=c.x+p*(h.x-c.x),l.y=c.y+p*(h.y-c.y),p==0||p==1?(this.m_type=L.e_faceB,this.m_axis=i.CrossVF(i.SubtractVV(h,c),1),this.m_axis.Normalize(),this.m_localPoint=l):(this.m_type=L.e_faceA,this.m_axis=i.CrossVF(i.SubtractVV(s,t),1),this.m_localPoint=f)),p<0&&this.m_axis.NegativeSelf())},L.prototype.Evaluate=function(e,t){var n,s,o=0;switch(this.m_type){case L.e_points:return n=i.MulTMV(e.R,this.m_axis),s=i.MulTMV(t.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),s=this.m_proxyB.GetSupportVertex(s),n=i.MulX(e,n),s=i.MulX(t,s),o=(s.x-n.x)*this.m_axis.x+(s.y-n.y)*this.m_axis.y;case L.e_faceA:return o=i.MulMV(e.R,this.m_axis),n=i.MulX(e,this.m_localPoint),s=i.MulTMV(t.R,o.GetNegative()),s=this.m_proxyB.GetSupportVertex(s),s=i.MulX(t,s),o=(s.x-n.x)*o.x+(s.y-n.y)*o.y;case L.e_faceB:return o=i.MulMV(t.R,this.m_axis),s=i.MulX(t,this.m_localPoint),n=i.MulTMV(e.R,o.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=i.MulX(e,n),o=(n.x-s.x)*o.x+(n.y-s.y)*o.y;default:return r.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),A.b2Simplex=function(){this.m_v1=new M,this.m_v2=new M,this.m_v3=new M,this.m_vertices=new Vector(3)},A.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},A.prototype.ReadCache=function(e,t,n,s,o){r.b2Assert(0<=e.count&&e.count<=3);var u,a;this.m_count=e.count;for(var f=this.m_vertices,l=0;l<this.m_count;l++){var c=f[l];c.indexA=e.indexA[l],c.indexB=e.indexB[l],u=t.GetVertex(c.indexA),a=s.GetVertex(c.indexB),c.wA=i.MulX(n,u),c.wB=i.MulX(o,a),c.w=i.SubtractVV(c.wB,c.wA),c.a=0}if(this.m_count>1){e=e.metric,u=this.GetMetric();if(u<.5*e||2*e<u||u<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(c=f[0],c.indexA=0,c.indexB=0,u=t.GetVertex(0),a=s.GetVertex(0),c.wA=i.MulX(n,u),c.wB=i.MulX(o,a),c.w=i.SubtractVV(c.wB,c.wA),this.m_count=1)},A.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=Box2D.parseUInt(this.m_count);for(var t=this.m_vertices,n=0;n<this.m_count;n++)e.indexA[n]=Box2D.parseUInt(t[n].indexA),e.indexB[n]=Box2D.parseUInt(t[n].indexB)},A.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=i.SubtractVV(this.m_v2.w,this.m_v1.w);return i.CrossVV(e,this.m_v1.w.GetNegative())>0?i.CrossFV(1,e):i.CrossVF(e,1);default:return r.b2Assert(!1),new u}},A.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return r.b2Assert(!1),new u;case 1:return this.m_v1.w;case 2:return new u(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return r.b2Assert(!1),new u}},A.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:r.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:r.b2Assert(!1)}},A.prototype.GetMetric=function(){switch(this.m_count){case 0:return r.b2Assert(!1),0;case 1:return 0;case 2:return i.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return i.CrossVV(i.SubtractVV(this.m_v2.w,this.m_v1.w),i.SubtractVV(this.m_v3.w,this.m_v1.w));default:return r.b2Assert(!1),0}},A.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=i.SubtractVV(t,e);e=-(e.x*n.x+e.y*n.y),e<=0?this.m_count=this.m_v1.a=1:(t=t.x*n.x+t.y*n.y,t<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},A.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=i.SubtractVV(t,e),s=i.Dot(e,r),o=i.Dot(t,r);s=-s;var u=i.SubtractVV(n,e),a=i.Dot(e,u),f=i.Dot(n,u);a=-a;var l=i.SubtractVV(n,t),c=i.Dot(t,l);l=i.Dot(n,l),c=-c,u=i.CrossVV(r,u),r=u*i.CrossVV(t,n),n=u*i.CrossVV(n,e),e=u*i.CrossVV(e,t),s<=0&&a<=0?this.m_count=this.m_v1.a=1:o>0&&s>0&&e<=0?(f=1/(o+s),this.m_v1.a=o*f,this.m_v2.a=s*f,this.m_count=2):f>0&&a>0&&n<=0?(o=1/(f+a),this.m_v1.a=f*o,this.m_v3.a=a*o,this.m_count=2,this.m_v2.Set(this.m_v3)):o<=0&&c<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):f<=0&&l<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):l>0&&c>0&&r<=0?(o=1/(l+c),this.m_v2.a=l*o,this.m_v3.a=c*o,this.m_count=2,this.m_v1.Set(this.m_v3)):(o=1/(r+n+e),this.m_v1.a=r*o,this.m_v2.a=n*o,this.m_v3.a=e*o,this.m_count=3)},O.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},M.b2SimplexVertex=function(){},M.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},_.b2TimeOfImpact=function(){},_.TimeOfImpact=function(e){++_.b2_toiCalls;var t=e.proxyA,n=e.proxyB,s=e.sweepA,o=e.sweepB;r.b2Assert(s.t0==o.t0),r.b2Assert(1-s.t0>Number.MIN_VALUE);var u=t.m_radius+n.m_radius;e=e.tolerance;var a=0,f=0,l=0;_.s_cache.count=0;for(_.s_distanceInput.useRadii=!1;;){s.GetTransform(_.s_xfA,a),o.GetTransform(_.s_xfB,a),_.s_distanceInput.proxyA=t,_.s_distanceInput.proxyB=n,_.s_distanceInput.transformA=_.s_xfA,_.s_distanceInput.transformB=_.s_xfB,d.Distance(_.s_distanceOutput,_.s_cache,_.s_distanceInput);if(_.s_distanceOutput.distance<=0){a=1;break}_.s_fcn.Initialize(_.s_cache,t,_.s_xfA,n,_.s_xfB);var c=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(c<=0){a=1;break}f==0&&(l=c>u?i.Max(u-e,.75*u):i.Max(c-e,.02*u));if(c-l<.5*e){if(f==0){a=1;break}break}var h=a,p=a,v=1;c=c,s.GetTransform(_.s_xfA,v),o.GetTransform(_.s_xfB,v);var m=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(m>=l){a=1;break}for(var g=0;;){var y=0;y=g&1?p+(l-c)*(v-p)/(m-c):.5*(p+v),s.GetTransform(_.s_xfA,y),o.GetTransform(_.s_xfB,y);var b=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(i.Abs(b-l)<.025*e){h=y;break}b>l?(p=y,c=b):(v=y,m=b),++g,++_.b2_toiRootIters;if(g==50)break}_.b2_toiMaxRootIters=i.Max(_.b2_toiMaxRootIters,g);if(h<(1+100*Number.MIN_VALUE)*a)break;a=h,f++,++_.b2_toiIters;if(f==1e3)break}return _.b2_toiMaxIters=i.Max(_.b2_toiMaxIters,f),a},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new O,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new v,Box2D.Collision.b2TimeOfImpact.s_xfA=new o,Box2D.Collision.b2TimeOfImpact.s_xfB=new o,Box2D.Collision.b2TimeOfImpact.s_fcn=new L,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new m}),D.b2TOIInput=function(){this.proxyA=new g,this.proxyB=new g,this.sweepA=new s,this.sweepB=new s},P.b2WorldManifold=function(){this.m_normal=new u},P.prototype.b2WorldManifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new u},P.prototype.Initialize=function(e,t,n,r,i){n===undefined&&(n=0),i===undefined&&(i=0);if(e.m_pointCount!=0){var s=0,o,u,a=0,f=0,l=0,c=0,h=0;o=0;switch(e.m_type){case S.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case S.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case S.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},H.ClipVertex=function(){this.v=new u,this.id=new h},H.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},B.Features=function(){},Object.defineProperty(B.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(B.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(B.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(B.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(B.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(B.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(B.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(B.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var e=Box2D.Common.b2Settings,t=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2EdgeChainDef,r=Box2D.Collision.Shapes.b2EdgeShape,i=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,u=Box2D.Common.Math.b2Mat22,a=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,c=Box2D.Collision.b2Distance,h=Box2D.Collision.b2DistanceInput,p=Box2D.Collision.b2DistanceOutput,d=Box2D.Collision.b2DistanceProxy,v=Box2D.Collision.b2SimplexCache;Box2D.inherit(t,Box2D.Collision.Shapes.b2Shape),t.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,t.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new l},t.prototype.Copy=function(){var e=new t;return e.Set(this),e},t.prototype.Set=function(e){this.__super.Set.call(this,e),Box2D.is(e,t)&&this.m_p.SetV((e instanceof t?e:null).m_p)},t.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.x-r,n=t.y-n,r*r+n*n<=this.m_radius*this.m_radius},t.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radius*this.m_radius);return a<0||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},t.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},t.prototype.ComputeMass=function(t,n){n===undefined&&(n=0),t.mass=n*e.b2_pi*this.m_radius*this.m_radius,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},t.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0),n=a.MulX(n,this.m_p);var i=-(a.Dot(e,n)-t);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;t=this.m_radius*this.m_radius;var s=i*i;return i=t*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(t-s),t=-2/3*Math.pow(t-s,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,i},t.prototype.GetLocalPosition=function(){return this.m_p},t.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},t.prototype.GetRadius=function(){return this.m_radius},t.prototype.SetRadius=function(e){e===undefined&&(e=0),this.m_radius=e},t.prototype.b2CircleShape=function(e){e===undefined&&(e=0),this.__super.b2Shape.call(this),this.m_type=o.e_circleShape,this.m_radius=e},n.b2EdgeChainDef=function(){},n.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new l,this.m_v1=new l,this.m_v2=new l,this.m_coreV1=new l,this.m_coreV2=new l,this.m_normal=new l,this.m_direction=new l,this.m_cornerDir1=new l,this.m_cornerDir2=new l},r.prototype.TestPoint=function(){return!1},r.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;n=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),r=100*Number.MIN_VALUE;var f=-(i*a+s*n);if(f>r){o=t.p1.x-o;var l=t.p1.y-u;u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f){t=-i*l+s*o;if(-r*f<=t&&t<=f*(1+r))return u/=f,e.fraction=u,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}}return!1},r.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},r.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},r.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=new l(e.x*t,e.y*t),s=a.MulX(n,this.m_v1);n=a.MulX(n,this.m_v2);var o=a.Dot(e,s)-t;e=a.Dot(e,n)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else e>0&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},r.prototype.GetLength=function(){return this.m_length},r.prototype.GetVertex1=function(){return this.m_v1},r.prototype.GetVertex2=function(){return this.m_v2},r.prototype.GetCoreVertex1=function(){return this.m_coreV1},r.prototype.GetCoreVertex2=function(){return this.m_coreV2},r.prototype.GetNormalVector=function(){return this.m_normal},r.prototype.GetDirectionVector=function(){return this.m_direction},r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},r.prototype.GetFirstVertex=function(e){var t=e.R;return new l(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},r.prototype.GetNextEdge=function(){return this.m_nextEdge},r.prototype.GetPrevEdge=function(){return this.m_prevEdge},r.prototype.Support=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);return e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y),i*t+s*n>o*t+e*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=e),this.s_supportVec},r.prototype.b2EdgeShape=function(t,n){this.__super.b2Shape.call(this),this.m_type=o.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=t,this.m_v2=n,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},r.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},r.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},i.b2MassData=function(){this.mass=0,this.center=new l(0,0),this.I=0},Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape),s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var e=new s;return e.Set(this),e},s.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,s)){e=e instanceof s?e:null,this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},s.prototype.SetAsArray=function(e,t){t===undefined&&(t=0);var n=new Vector,r=0,i;for(r=0;r<e.length;++r)i=e[r],n.push(i);this.SetAsVector(n,t)},s.AsArray=function(e,t){t===undefined&&(t=0);var n=new s;return n.SetAsArray(e,t),n},s.prototype.SetAsVector=function(t,n){n===undefined&&(n=0),n==0&&(n=t.length),e.b2Assert(2<=n),this.m_vertexCount=n,this.Reserve(n);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(t[r]);for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r),o=parseInt(r+1<this.m_vertexCount?r+1:0);i=a.SubtractVV(this.m_vertices[o],this.m_vertices[i]),e.b2Assert(i.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(a.CrossVF(i,1)),this.m_normals[r].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(e,t){t===undefined&&(t=0);var n=new s;return n.SetAsVector(e,t),n},s.prototype.SetAsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=new s;return n.SetAsBox(e,t),n},s.prototype.SetAsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new f,e.position=n,e.R.Set(r);for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=a.MulX(e,this.m_vertices[n]),this.m_normals[n]=a.MulMV(e.R,this.m_normals[n])},s.AsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0);var i=new s;return i.SetAsOrientedBox(e,t,n,r),i},s.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=a.CrossVF(a.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(e,t){var n=new s;return n.SetAsEdge(e,t),n},s.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u){n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u];if(n.x*r+n.y*i>0)return!1}return!0},s.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=parseInt(-1),h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(o==0){if(s<0)return!1}else o<0&&s<r*o?(r=s/o,c=h):o>0&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return c>=0?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},s.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},s.prototype.ComputeMass=function(e,t){t===undefined&&(t=0);if(this.m_vertexCount==2)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u){var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[parseInt(u+1)]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d;i+=v,n+=v*o*(0+a.x+f.x),r+=v*o*(0+a.y+f.y),a=l,c=c,h=h,p=p,s+=d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0))}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s}},s.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var s=a.MulTMV(n.R,e),o=t-a.Dot(e,n.position),u=new Vector_a2j_Number,f=0,c=parseInt(-1);t=parseInt(-1);var h=!1;for(e=e=0;e<this.m_vertexCount;++e){u[e]=a.Dot(s,this.m_vertices[e])-o;var p=u[e]<-Number.MIN_VALUE;e>0&&(p?h||(c=e-1,f++):h&&(t=e-1,f++)),h=p}switch(f){case 0:return h?(e=new i,this.ComputeMass(e,1),r.SetV(a.MulX(n,e.center)),e.mass):0;case 1:c==-1?c=this.m_vertexCount-1:t=this.m_vertexCount-1}e=parseInt((c+1)%this.m_vertexCount),s=parseInt((t+1)%this.m_vertexCount),o=(0-u[c])/(u[e]-u[c]),u=(0-u[t])/(u[s]-u[t]),c=new l(this.m_vertices[c].x*(1-o)+this.m_vertices[e].x*o,this.m_vertices[c].y*(1-o)+this.m_vertices[e].y*o),t=new l(this.m_vertices[t].x*(1-u)+this.m_vertices[s].x*u,this.m_vertices[t].y*(1-u)+this.m_vertices[s].y*u),u=0,o=new l,f=this.m_vertices[e];for(e=e;e!=s;)e=(e+1)%this.m_vertexCount,h=e==s?t:this.m_vertices[e],p=.5*((f.x-c.x)*(h.y-c.y)-(f.y-c.y)*(h.x-c.x)),u+=p,o.x+=p*(c.x+f.x+h.x)/3,o.y+=p*(c.y+f.y+h.y)/3,f=h;return o.Multiply(1/u),r.SetV(a.MulX(n,o)),u},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},s.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=o.e_polygonShape,this.m_centroid=new l,this.m_vertices=new Vector,this.m_normals=new Vector},s.prototype.Reserve=function(e){e===undefined&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new l,this.m_normals[t]=new l},s.ComputeCentroid=function(e,t){t===undefined&&(t=0);for(var n=new l,r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[parseInt(s+1)]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0));r+=a,n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},s.ComputeOBB=function(e,t,n){n===undefined&&(n=0);var r=0,i=new Vector(n+1);for(r=0;r<n;++r)i[r]=t[r];i[n]=i[0],t=Number.MAX_VALUE;for(r=1;r<=n;++r){var s=i[parseInt(r-1)],o=i[r].x-s.x,u=i[r].y-s.y,a=Math.sqrt(o*o+u*u);o/=a,u/=a;for(var f=-u,l=o,c=a=Number.MAX_VALUE,h=-Number.MAX_VALUE,p=-Number.MAX_VALUE,d=0;d<n;++d){var v=i[d].x-s.x,m=i[d].y-s.y,g=o*v+u*m;v=f*v+l*m,g<a&&(a=g),v<c&&(c=v),g>h&&(h=g),v>p&&(p=v)}d=(h-a)*(p-c),d<.95*t&&(t=d,e.R.col1.x=o,e.R.col1.y=u,e.R.col2.x=f,e.R.col2.y=l,o=.5*(a+h),u=.5*(c+p),f=e.R,e.center.x=s.x+(f.col1.x*o+f.col2.x*u),e.center.y=s.y+(f.col1.y*o+f.col2.y*u),e.extents.x=.5*(h-a),e.extents.y=.5*(p-c))}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new u}),o.b2Shape=function(){},o.prototype.Copy=function(){return null},o.prototype.Set=function(e){this.m_radius=e.m_radius},o.prototype.GetType=function(){return this.m_type},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(){return!1},o.prototype.ComputeAABB=function(){},o.prototype.ComputeMass=function(){},o.prototype.ComputeSubmergedArea=function(){return 0},o.TestOverlap=function(e,t,n,r){var i=new h;return i.proxyA=new d,i.proxyA.Set(e),i.proxyB=new d,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new v,e.count=0,t=new p,c.Distance(t,e,i),t.distance<10*Number.MIN_VALUE},o.prototype.b2Shape=function(){this.m_type=o.e_unknownShape,this.m_radius=e.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Math;e.b2Color=function(){this._b=this._g=this._r=0},e.prototype.b2Color=function(e,t,r){e===undefined&&(e=0),t===undefined&&(t=0),r===undefined&&(r=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(r,0,1))},e.prototype.Set=function(e,t,r){e===undefined&&(e=0),t===undefined&&(t=0),r===undefined&&(r=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(r,0,1))},Object.defineProperty(e.prototype,"r",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"g",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._g=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"b",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._b=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),t.b2Settings=function(){},t.b2MixFriction=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),Math.sqrt(e*t)},t.b2MixRestitution=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},t.b2Assert=function(e){if(!e)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi})}(),function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new s,this.col2=new s},e.prototype.b2Mat22=function(){this.SetIdentity()},e.FromAngle=function(t){t===undefined&&(t=0);var n=new e;return n.Set(t),n},e.FromVV=function(t,n){var r=new e;return r.SetVV(t,n),r},e.prototype.Set=function(e){e===undefined&&(e=0);var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},e.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},e.prototype.Copy=function(){var t=new e;return t.SetM(this),t},e.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},e.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},e.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},e.prototype.Solve=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},e.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},t.b2Mat33=function(){this.col1=new o,this.col2=new o,this.col3=new o},t.prototype.b2Mat33=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=null),!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},t.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)},t.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},t.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},t.prototype.Solve22=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},t.prototype.Solve33=function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0);var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},n.b2Math=function(){},n.IsValid=function(e){return e===undefined&&(e=0),isFinite(e)},n.Dot=function(e,t){return e.x*t.x+e.y*t.y},n.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},n.CrossVF=function(e,t){return t===undefined&&(t=0),new s(t*e.y,-t*e.x)},n.CrossFV=function(e,t){return e===undefined&&(e=0),new s(-e*t.y,e*t.x)},n.MulMV=function(e,t){return new s(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},n.MulTMV=function(e,t){return new s(n.Dot(t,e.col1),n.Dot(t,e.col2))},n.MulX=function(e,t){var r=n.MulMV(e.R,t);return r.x+=e.position.x,r.y+=e.position.y,r},n.MulXT=function(e,t){var r=n.SubtractVV(t,e.position),i=r.x*e.R.col1.x+r.y*e.R.col1.y;return r.y=r.x*e.R.col2.x+r.y*e.R.col2.y,r.x=i,r},n.AddVV=function(e,t){return new s(e.x+t.x,e.y+t.y)},n.SubtractVV=function(e,t){return new s(e.x-t.x,e.y-t.y)},n.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},n.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},n.MulFV=function(e,t){return e===undefined&&(e=0),new s(e*t.x,e*t.y)},n.AddMM=function(t,r){return e.FromVV(n.AddVV(t.col1,r.col1),n.AddVV(t.col2,r.col2))},n.MulMM=function(t,r){return e.FromVV(n.MulMV(t,r.col1),n.MulMV(t,r.col2))},n.MulTMM=function(t,r){var i=new s(n.Dot(t.col1,r.col1),n.Dot(t.col2,r.col1)),o=new s(n.Dot(t.col1,r.col2),n.Dot(t.col2,r.col2));return e.FromVV(i,o)},n.Abs=function(e){return e===undefined&&(e=0),e>0?e:-e},n.AbsV=function(e){return new s(n.Abs(e.x),n.Abs(e.y))},n.AbsM=function(t){return e.FromVV(n.AbsV(t.col1),n.AbsV(t.col2))},n.Min=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e<t?e:t},n.MinV=function(e,t){return new s(n.Min(e.x,t.x),n.Min(e.y,t.y))},n.Max=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},n.MaxV=function(e,t){return new s(n.Max(e.x,t.x),n.Max(e.y,t.y))},n.Clamp=function(e,t,n){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),e<t?t:e>n?n:e},n.ClampV=function(e,t,r){return n.MaxV(t,n.MinV(e,r))},n.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},n.Random=function(){return Math.random()*2-1},n.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e},n.NextPowerOfTwo=function(e){return e===undefined&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},n.IsPowerOfTwo=function(e){return e===undefined&&(e=0),e>0&&(e&e-1)==0},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new s(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new s(1,0),new s(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new i(n.b2Vec2_zero,n.b2Mat22_identity)}),r.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},r.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},r.prototype.Copy=function(){var e=new r;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},r.prototype.GetTransform=function(e,t){t===undefined&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},r.prototype.Advance=function(e){e===undefined&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},i.b2Transform=function(){this.position=new s,this.R=new e},i.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.position.SetV(e),this.R.SetM(t))},i.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},i.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},i.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},i.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},s.prototype.SetZero=function(){this.y=this.x=0},s.prototype.Set=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},s.prototype.SetV=function(e){this.x=e.x,this.y=e.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),new s(e,t)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},s.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},s.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e},s.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},s.prototype.MulTM=function(e){var t=n.Dot(this,e.col1);this.y=n.Dot(this,e.col2),this.x=t},s.prototype.CrossVF=function(e){e===undefined&&(e=0);var t=this.x;this.x=e*this.y,this.y=-e*t},s.prototype.CrossFV=function(e){e===undefined&&(e=0);var t=this.x;this.x=-e*this.y,this.y=e*t},s.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},s.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},s.prototype.IsValid=function(){return n.IsValid(this.x)&&n.IsValid(this.y)},o.b2Vec3=function(){},o.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},o.prototype.SetZero=function(){this.x=this.y=this.z=0},o.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},o.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},o.prototype.GetNegative=function(){return new o(-this.x,-this.y,-this.z)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},o.prototype.Copy=function(){return new o(this.x,this.y,this.z)},o.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},o.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},o.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e,this.z*=e}}(),function(){var e=Box2D.Common.Math.b2Math,t=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,r=Box2D.Common.Math.b2Vec2,i=Box2D.Common.b2Color,s=Box2D.Common.b2Settings,o=Box2D.Collision.b2AABB,u=Box2D.Collision.b2ContactPoint,a=Box2D.Collision.b2DynamicTreeBroadPhase,f=Box2D.Collision.b2RayCastInput,l=Box2D.Collision.b2RayCastOutput,c=Box2D.Collision.Shapes.b2CircleShape,h=Box2D.Collision.Shapes.b2EdgeShape,p=Box2D.Collision.Shapes.b2MassData,d=Box2D.Collision.Shapes.b2PolygonShape,v=Box2D.Collision.Shapes.b2Shape,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,y=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,w=Box2D.Dynamics.b2ContactListener,E=Box2D.Dynamics.b2ContactManager,S=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,T=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,C=Box2D.Dynamics.b2FixtureDef,k=Box2D.Dynamics.b2Island,L=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,O=Box2D.Dynamics.Contacts.b2Contact,M=Box2D.Dynamics.Contacts.b2ContactFactory,_=Box2D.Dynamics.Contacts.b2ContactSolver,D=Box2D.Dynamics.Joints.b2Joint,P=Box2D.Dynamics.Joints.b2PulleyJoint;m.b2Body=function(){this.m_xf=new n,this.m_sweep=new t,this.m_linearVelocity=new r,this.m_force=new r},m.prototype.connectEdges=function(t,n,r){r===undefined&&(r=0);var i=Math.atan2(n.GetDirectionVector().y,n.GetDirectionVector().x);r=e.MulFV(Math.tan((i-r)*.5),n.GetDirectionVector()),r=e.SubtractVV(r,n.GetNormalVector()),r=e.MulFV(s.b2_toiSlop,r),r=e.AddVV(r,n.GetVertex1());var o=e.AddVV(t.GetDirectionVector(),n.GetDirectionVector());o.Normalize();var u=e.Dot(t.GetDirectionVector(),n.GetNormalVector())>0;return t.SetNextEdge(n,r,o,u),n.SetPrevEdge(t,r,o,u),i},m.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new N;return t.Create(this,this.m_xf,e),this.m_flags&m.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=A.e_newFixture,t},m.prototype.CreateFixture2=function(e,t){t===undefined&&(t=0);var n=new C;return n.shape=e,n.density=t,this.CreateFixture(n)},m.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=1){for(var t=this.m_fixtureList,n=null;t!=null;){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next;break}n=t,t=t.m_next}for(t=this.m_contactList;t;){n=t.contact,t=t.next;var r=n.GetFixtureA(),i=n.GetFixtureB();(e==r||e==i)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&m.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},m.prototype.SetPositionAndAngle=function(e,t){t===undefined&&(t=0);var n;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(t),this.m_xf.position.SetV(e),n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},m.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},m.prototype.GetTransform=function(){return this.m_xf},m.prototype.GetPosition=function(){return this.m_xf.position},m.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},m.prototype.GetAngle=function(){return this.m_sweep.a},m.prototype.SetAngle=function(e){e===undefined&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},m.prototype.GetWorldCenter=function(){return this.m_sweep.c},m.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},m.prototype.SetLinearVelocity=function(e){this.m_type!=m.b2_staticBody&&this.m_linearVelocity.SetV(e)},m.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},m.prototype.SetAngularVelocity=function(e){e===undefined&&(e=0),this.m_type!=m.b2_staticBody&&(this.m_angularVelocity=e)},m.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},m.prototype.GetDefinition=function(){var e=new g;return e.type=this.GetType(),e.allowSleep=(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag,e.bullet=(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag,e.awake=(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},m.prototype.ApplyForce=function(e,t){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},m.prototype.ApplyTorque=function(e){e===undefined&&(e=0),this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e)},m.prototype.ApplyImpulse=function(e,t){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},m.prototype.Split=function(t){for(var n=this.GetLinearVelocity().Copy(),r=this.GetAngularVelocity(),i=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),o,u=this.m_fixtureList;u;)if(t(u)){var a=u.m_next;o?o.m_next=a:this.m_fixtureList=a,this.m_fixtureCount--,u.m_next=s.m_fixtureList,s.m_fixtureList=u,s.m_fixtureCount++,u.m_body=s,u=a}else o=u,u=u.m_next;return this.ResetMassData(),s.ResetMassData(),o=this.GetWorldCenter(),t=s.GetWorldCenter(),o=e.AddVV(n,e.CrossFV(r,e.SubtractVV(o,i))),n=e.AddVV(n,e.CrossFV(r,e.SubtractVV(t,i))),this.SetLinearVelocity(o),s.SetLinearVelocity(n),this.SetAngularVelocity(r),s.SetAngularVelocity(r),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},m.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e;r.GetWorldCenter(),i.GetWorldCenter(),r.GetLinearVelocity().Copy(),i.GetLinearVelocity().Copy(),r.GetAngularVelocity(),i.GetAngularVelocity(),r.ResetMassData(),this.SynchronizeFixtures()},m.prototype.GetMass=function(){return this.m_mass},m.prototype.GetInertia=function(){return this.m_I},m.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},m.prototype.SetMassData=function(t){s.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()!=1&&this.m_type==m.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&(this.m_flags&m.e_fixedRotationFlag)==0&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},m.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=m.b2_staticBody&&this.m_type!=m.b2_kinematicBody){for(var t=r.Make(0,0),n=this.m_fixtureList;n;n=n.m_next)if(n.m_density!=0){var i=n.GetMassData();this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&(this.m_flags&m.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,n=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},m.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;return e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},m.prototype.GetWorldVector=function(t){return e.MulMV(this.m_xf.R,t)},m.prototype.GetLocalPoint=function(t){return e.MulXT(this.m_xf,t)},m.prototype.GetLocalVector=function(t){return e.MulTMV(this.m_xf.R,t)},m.prototype.GetLinearVelocityFromWorldPoint=function(e){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},m.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;return e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},m.prototype.GetLinearDamping=function(){return this.m_linearDamping},m.prototype.SetLinearDamping=function(e){e===undefined&&(e=0),this.m_linearDamping=e},m.prototype.GetAngularDamping=function(){return this.m_angularDamping},m.prototype.SetAngularDamping=function(e){e===undefined&&(e=0),this.m_angularDamping=e},m.prototype.SetType=function(e){e===undefined&&(e=0);if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==m.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},m.prototype.GetType=function(){return this.m_type},m.prototype.SetBullet=function(e){e?this.m_flags|=m.e_bulletFlag:this.m_flags&=~m.e_bulletFlag},m.prototype.IsBullet=function(){return(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag},m.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=m.e_allowSleepFlag:(this.m_flags&=~m.e_allowSleepFlag,this.SetAwake(!0))},m.prototype.SetAwake=function(e){e?(this.m_flags|=m.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~m.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},m.prototype.IsAwake=function(){return(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag},m.prototype.SetFixedRotation=function(e){e?this.m_flags|=m.e_fixedRotationFlag:this.m_flags&=~m.e_fixedRotationFlag,this.ResetMassData()},m.prototype.IsFixedRotation=function(){return(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag},m.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=m.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~m.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;)t=e,e=e.next,this.m_world.m_contactManager.Destroy(t.contact);this.m_contactList=null}}},m.prototype.IsActive=function(){return(this.m_flags&m.e_activeFlag)==m.e_activeFlag},m.prototype.IsSleepingAllowed=function(){return(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag},m.prototype.GetFixtureList=function(){return this.m_fixtureList},m.prototype.GetJointList=function(){return this.m_jointList},m.prototype.GetControllerList=function(){return this.m_controllerList},m.prototype.GetContactList=function(){return this.m_contactList},m.prototype.GetNext=function(){return this.m_next},m.prototype.GetUserData=function(){return this.m_userData},m.prototype.SetUserData=function(e){this.m_userData=e},m.prototype.GetWorld=function(){return this.m_world},m.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=m.e_bulletFlag),e.fixedRotation&&(this.m_flags|=m.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=m.e_allowSleepFlag),e.awake&&(this.m_flags|=m.e_awakeFlag),e.active&&(this.m_flags|=m.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_type==m.b2_dynamicBody?this.m_invMass=this.m_mass=1:this.m_invMass=this.m_mass=0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},m.prototype.SynchronizeFixtures=function(){var e=m.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,e,this.m_xf)},m.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},m.prototype.ShouldCollide=function(e){if(this.m_type!=m.b2_dynamicBody&&e.m_type!=m.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},m.prototype.Advance=function(e){e===undefined&&(e=0),this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new n,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),g.b2BodyDef=function(){this.position=new r,this.linearVelocity=new r},g.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=m.b2_staticBody,this.active=!0,this.inertiaScale=1},y.b2ContactFilter=function(){},y.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&n.groupIndex!=0?n.groupIndex>0:(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0},y.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e instanceof N?e:null,t):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new y}),b.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)},w.b2ContactListener=function(){},w.prototype.BeginContact=function(){},w.prototype.EndContact=function(){},w.prototype.PreSolve=function(){},w.prototype.PostSolve=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new w}),E.b2ContactManager=function(){},E.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=y.b2_defaultFilter,this.m_contactListener=w.b2_defaultListener,this.m_contactFactory=new M(this.m_allocator),this.m_broadPhase=new a},E.prototype.AddPair=function(e,t){var n=e instanceof N?e:null,r=t instanceof N?t:null,i=n.GetBody(),s=r.GetBody();if(i!=s){for(var o=s.GetContactList();o;){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}s.ShouldCollide(i)!=0&&this.m_contactFilter.ShouldCollide(n,r)!=0&&(o=this.m_contactFactory.Create(n,r),n=o.GetFixtureA(),r=o.GetFixtureB(),i=n.m_body,s=r.m_body,o.m_prev=null,o.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=o),this.m_world.m_contactList=o,o.m_nodeA.contact=o,o.m_nodeA.other=s,o.m_nodeA.prev=null,o.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=o.m_nodeA),i.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=i,o.m_nodeB.prev=null,o.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=o.m_nodeB),s.m_contactList=o.m_nodeB,++this.m_world.m_contactCount)}},E.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},E.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB();t=t.GetBody(),n=n.GetBody(),e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},E.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0)e=e.GetNext();else{if(e.m_flags&O.e_filterFlag){if(i.ShouldCollide(r)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}e.m_flags&=~O.e_filterFlag}this.m_broadPhase.TestOverlap(t.m_proxy,n.m_proxy)==0?(t=e,e=t.GetNext(),this.Destroy(t)):(e.Update(this.m_contactListener),e=e.GetNext())}}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new u}),S.b2DebugDraw=function(){},S.prototype.b2DebugDraw=function(){},S.prototype.SetFlags=function(){},S.prototype.GetFlags=function(){},S.prototype.AppendFlags=function(){},S.prototype.ClearFlags=function(){},S.prototype.SetSprite=function(){},S.prototype.GetSprite=function(){},S.prototype.SetDrawScale=function(){},S.prototype.GetDrawScale=function(){},S.prototype.SetLineThickness=function(){},S.prototype.GetLineThickness=function(){},S.prototype.SetAlpha=function(){},S.prototype.GetAlpha=function(){},S.prototype.SetFillAlpha=function(){},S.prototype.GetFillAlpha=function(){},S.prototype.SetXFormScale=function(){},S.prototype.GetXFormScale=function(){},S.prototype.DrawPolygon=function(){},S.prototype.DrawSolidPolygon=function(){},S.prototype.DrawCircle=function(){},S.prototype.DrawSolidCircle=function(){},S.prototype.DrawSegment=function(){},S.prototype.DrawTransform=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),x.b2DestructionListener=function(){},x.prototype.SayGoodbyeJoint=function(){},x.prototype.SayGoodbyeFixture=function(){},T.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},T.prototype.Copy=function(){var e=new T;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},N.b2Fixture=function(){this.m_filter=new T},N.prototype.GetType=function(){return this.m_shape.GetType()},N.prototype.GetShape=function(){return this.m_shape},N.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.SetSensor(n.IsSensor()||r.IsSensor()),e=e.next}}},N.prototype.IsSensor=function(){return this.m_isSensor},N.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}},N.prototype.GetFilterData=function(){return this.m_filter.Copy()},N.prototype.GetBody=function(){return this.m_body},N.prototype.GetNext=function(){return this.m_next},N.prototype.GetUserData=function(){return this.m_userData},N.prototype.SetUserData=function(e){this.m_userData=e},N.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},N.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},N.prototype.GetMassData=function(e){return e===undefined&&(e=null),e==null&&(e=new p),this.m_shape.ComputeMass(e,this.m_density),e},N.prototype.SetDensity=function(e){e===undefined&&(e=0),this.m_density=e},N.prototype.GetDensity=function(){return this.m_density},N.prototype.GetFriction=function(){return this.m_friction},N.prototype.SetFriction=function(e){e===undefined&&(e=0),this.m_friction=e},N.prototype.GetRestitution=function(){return this.m_restitution},N.prototype.SetRestitution=function(e){e===undefined&&(e=0),this.m_restitution=e},N.prototype.GetAABB=function(){return this.m_aabb},N.prototype.b2Fixture=function(){this.m_aabb=new o,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},N.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},N.prototype.Destroy=function(){this.m_shape=null},N.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},N.prototype.DestroyProxy=function(e){this.m_proxy!=null&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},N.prototype.Synchronize=function(t,n,r){if(this.m_proxy){var i=new o,s=new o;this.m_shape.ComputeAABB(i,n),this.m_shape.ComputeAABB(s,r),this.m_aabb.Combine(i,s),n=e.SubtractVV(r.position,n.position),t.MoveProxy(this.m_proxy,this.m_aabb,n)}},C.b2FixtureDef=function(){this.filter=new T},C.prototype.b2FixtureDef=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},k.b2Island=function(){},k.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},k.prototype.Initialize=function(e,t,n,r,i,s){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0);var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},k.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},k.prototype.Solve=function(t,n,r){var i=0,o=0,u;for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.GetType()==m.b2_dynamicBody&&(o.m_linearVelocity.x+=t.dt*(n.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=t.dt*(n.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque,o.m_linearVelocity.Multiply(e.Clamp(1-t.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=e.Clamp(1-t.dt*o.m_angularDamping,0,1));this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator),n=this.m_contactSolver,n.InitVelocityConstraints(t);for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i){for(o=0;o<this.m_jointCount;++o)u=this.m_joints[o],u.SolveVelocityConstraints(t);n.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.FinalizeVelocityConstraints();n.FinalizeVelocityConstraints();for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()!=m.b2_staticBody){var a=t.dt*o.m_linearVelocity.x,f=t.dt*o.m_linearVelocity.y;a*a+f*f>s.b2_maxTranslationSquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt,o.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt),a=t.dt*o.m_angularVelocity,a*a>s.b2_maxRotationSquared&&(o.m_angularVelocity=o.m_angularVelocity<0?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt),o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y,o.m_sweep.a+=t.dt*o.m_angularVelocity,o.SynchronizeTransform()}}for(i=0;i<t.positionIterations;++i){a=n.SolvePositionConstraints(s.b2_contactBaumgarte),f=!0;for(o=0;o<this.m_jointCount;++o)u=this.m_joints[o],u=u.SolvePositionConstraints(s.b2_contactBaumgarte),f=f&&u;if(a&&f)break}this.Report(n.m_constraints);if(r){r=Number.MAX_VALUE,n=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,a=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.GetType()!=m.b2_staticBody&&((o.m_flags&m.e_allowSleepFlag)==0&&(r=o.m_sleepTime=0),(o.m_flags&m.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>a||e.Dot(o.m_linearVelocity,o.m_linearVelocity)>n?r=o.m_sleepTime=0:(o.m_sleepTime+=t.dt,r=e.Min(r,o.m_sleepTime)));if(r>=s.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.SetAwake(!1)}},k.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){n=this.m_bodies[t];if(n.GetType()!=m.b2_staticBody){var i=e.dt*n.m_linearVelocity.x,o=e.dt*n.m_linearVelocity.y;i*i+o*o>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*e.inv_dt:s.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),o=!0;for(n=0;n<this.m_jointCount;++n){var u=this.m_joints[n].SolvePositionConstraints(s.b2_contactBaumgarte);o=o&&u}if(i&&o)break}this.Report(r.m_constraints)},k.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var n=this.m_contacts[t],r=e[t],i=0;i<r.pointCount;++i)k.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,k.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,k.s_impulse)}},k.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},k.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},k.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new b}),L.b2TimeStep=function(){},L.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},A.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new E,this.m_contactSolver=new _,this.m_island=new k},A.prototype.b2World=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,A.m_warmStarting=!0,A.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new g)},A.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},A.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},A.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},A.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},A.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},A.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},A.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},A.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;e=new m(e,this),e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;return this.m_bodyList=e,++this.m_bodyCount,e},A.prototype.DestroyBody=function(e){if(this.IsLocked()!=1){for(var t=e.m_jointList;t;){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.m_controllerList;t;)n=t,t=t.nextController,n.controller.RemoveBody(e);for(t=e.m_contactList;t;)n=t,t=t.next,this.m_contactManager.Destroy(n.contact);e.m_contactList=null;for(t=e.m_fixtureList;t;)n=t,t=t.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},A.prototype.CreateJoint=function(e){var t=D.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next;return t},A.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,D.Destroy(e,null),--this.m_jointCount;if(t==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next},A.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},A.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},A.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},A.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},A.prototype.SetWarmStarting=function(e){A.m_warmStarting=e},A.prototype.SetContinuousPhysics=function(e){A.m_continuousPhysics=e},A.prototype.GetBodyCount=function(){return this.m_bodyCount},A.prototype.GetJointCount=function(){return this.m_jointCount},A.prototype.GetContactCount=function(){return this.m_contactCount},A.prototype.SetGravity=function(e){this.m_gravity=e},A.prototype.GetGravity=function(){return this.m_gravity},A.prototype.GetGroundBody=function(){return this.m_groundBody},A.prototype.Step=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.m_flags&A.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~A.e_newFixture),this.m_flags|=A.e_locked;var r=A.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=A.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),A.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~A.e_locked},A.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},A.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t,n,s;new r,new r,new r;var u;new o,new o,u=[new r,new r,new r,new r];var a=new i(0,0,0);if(e&S.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){u=t.m_xf;for(n=t.GetFixtureList();n;n=n.m_next)s=n.GetShape(),t.IsActive()==0?a.Set(.5,.5,.3):t.GetType()==m.b2_staticBody?a.Set(.5,.9,.5):t.GetType()==m.b2_kinematicBody?a.Set(.5,.5,.9):t.IsAwake()==0?a.Set(.6,.6,.6):a.Set(.9,.7,.7),this.DrawShape(s,u,a)}if(e&S.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&S.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&S.e_pairBit){a.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext())s=t.GetFixtureA(),n=t.GetFixtureB(),s=s.GetAABB().GetCenter(),n=n.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(s,n,a)}if(e&S.e_aabbBit){s=this.m_contactManager.m_broadPhase,u=[new r,new r,new r,new r];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(n=t.GetFixtureList();n;n=n.GetNext()){var f=s.GetFatAABB(n.m_proxy);u[0].Set(f.lowerBound.x,f.lowerBound.y),u[1].Set(f.upperBound.x,f.lowerBound.y),u[2].Set(f.upperBound.x,f.upperBound.y),u[3].Set(f.lowerBound.x,f.upperBound.y),this.m_debugDraw.DrawPolygon(u,4,a)}}if(e&S.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)u=A.s_xf,u.R=t.m_xf.R,u.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(u)}},A.prototype.QueryAABB=function(e,t){var n=this.m_contactManager.m_broadPhase;n.Query(function(t){return e(n.GetUserData(t))},t)},A.prototype.QueryShape=function(e,t,r){r===undefined&&(r=null),r==null&&(r=new n,r.SetIdentity());var i=this.m_contactManager.m_broadPhase,s=new o;t.ComputeAABB(s,r),i.Query(function(n){return n=i.GetUserData(n)instanceof N?i.GetUserData(n):null,v.TestOverlap(t,r,n.GetShape(),n.GetBody().GetTransform())?e(n):!0},s)},A.prototype.QueryPoint=function(e,t){var n=this.m_contactManager.m_broadPhase,r=new o;r.lowerBound.Set(t.x-s.b2_linearSlop,t.y-s.b2_linearSlop),r.upperBound.Set(t.x+s.b2_linearSlop,t.y+s.b2_linearSlop),n.Query(function(r){return r=n.GetUserData(r)instanceof N?n.GetUserData(r):null,r.TestPoint(t)?e(r):!0},r)},A.prototype.RayCast=function(e,t,n){var i=this.m_contactManager.m_broadPhase,s=new l,o=new f(t,n);i.RayCast(function(o,u){var a=i.GetUserData(u);a=a instanceof N?a:null;if(a.RayCast(s,o)){var f=s.fraction,l=new r((1-f)*t.x+f*n.x,(1-f)*t.y+f*n.y);return e(a,l,s.normal,f)}return o.maxFraction},o)},A.prototype.RayCastOne=function(e,t){var n;return this.RayCast(function(e,t,r,i){return i===undefined&&(i=0),n=e,i},e,t),n},A.prototype.RayCastAll=function(e,t){var n=new Vector;return this.RayCast(function(e){return n[n.length]=e,1},e,t),n},A.prototype.GetBodyList=function(){return this.m_bodyList},A.prototype.GetJointList=function(){return this.m_jointList},A.prototype.GetContactList=function(){return this.m_contactList},A.prototype.IsLocked=function(){return(this.m_flags&A.e_locked)>0},A.prototype.Solve=function(e){for(var t,n=this.m_controllerList;n;n=n.m_next)n.Step(e);n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~m.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~O.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;parseInt(this.m_bodyCount),r=this.s_stack;for(var i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&m.e_islandFlag)&&i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=m.b2_staticBody){n.Clear();var s=0;r[s++]=i;for(i.m_flags|=m.e_islandFlag;s>0;){t=r[--s],n.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=m.b2_staticBody){for(var o,u=t.m_contactList;u;u=u.next)u.contact.m_flags&O.e_islandFlag||u.contact.IsSensor()!=1&&u.contact.IsEnabled()!=0&&u.contact.IsTouching()!=0&&(n.AddContact(u.contact),u.contact.m_flags|=O.e_islandFlag,o=u.other,o.m_flags&m.e_islandFlag||(r[s++]=o,o.m_flags|=m.e_islandFlag));for(t=t.m_jointList;t;t=t.next)t.joint.m_islandFlag!=1&&(o=t.other,o.IsActive()!=0&&(n.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_flags&m.e_islandFlag||(r[s++]=o,o.m_flags|=m.e_islandFlag)))}}n.Solve(e,this.m_gravity,this.m_allowSleep);for(s=0;s<n.m_bodyCount;++s)t=n.m_bodies[s],t.GetType()==m.b2_staticBody&&(t.m_flags&=~m.e_islandFlag)}for(s=0;s<r.length;++s){if(!r[s])break;r[s]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==0||t.IsActive()==0||t.GetType()!=m.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},A.prototype.SolveTOI=function(e){var t,n,r,i=this.m_island;i.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var o=A.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~m.e_islandFlag,t.m_sweep.t0=0;for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(O.e_toiFlag|O.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){var u=null,a=1;for(r=this.m_contactList;r;r=r.m_next)if(r.IsSensor()!=1&&r.IsEnabled()!=0&&r.IsContinuous()!=0){t=1;if(r.m_flags&O.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA,n=r.m_fixtureB,t=t.m_body,n=n.m_body;if(!(t.GetType()==m.b2_dynamicBody&&t.IsAwake()!=0||n.GetType()==m.b2_dynamicBody&&n.IsAwake()!=0))continue;var f=t.m_sweep.t0;t.m_sweep.t0<n.m_sweep.t0?(f=n.m_sweep.t0,t.m_sweep.Advance(f)):n.m_sweep.t0<t.m_sweep.t0&&(f=t.m_sweep.t0,n.m_sweep.Advance(f)),t=r.ComputeTOI(t.m_sweep,n.m_sweep),s.b2Assert(0<=t&&t<=1),t>0&&t<1&&(t=(1-t)*f+t,t>1&&(t=1)),r.m_toi=t,r.m_flags|=O.e_toiFlag}Number.MIN_VALUE<t&&t<a&&(u=r,a=t)}if(u==null||1-100*Number.MIN_VALUE<a)break;t=u.m_fixtureA,n=u.m_fixtureB,t=t.m_body,n=n.m_body,A.s_backupA.Set(t.m_sweep),A.s_backupB.Set(n.m_sweep),t.Advance(a),n.Advance(a),u.Update(this.m_contactManager.m_contactListener),u.m_flags&=~O.e_toiFlag;if(u.IsSensor()==1||u.IsEnabled()==0)t.m_sweep.Set(A.s_backupA),n.m_sweep.Set(A.s_backupB),t.SynchronizeTransform(),n.SynchronizeTransform();else if(u.IsTouching()!=0){t=t,t.GetType()!=m.b2_dynamicBody&&(t=n),i.Clear(),u=r=0,o[r+u++]=t;for(t.m_flags|=m.e_islandFlag;u>0;){t=o[r++],--u,i.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==m.b2_dynamicBody){for(n=t.m_contactList;n;n=n.next){if(i.m_contactCount==i.m_contactCapacity)break;n.contact.m_flags&O.e_islandFlag||n.contact.IsSensor()!=1&&n.contact.IsEnabled()!=0&&n.contact.IsTouching()!=0&&(i.AddContact(n.contact),n.contact.m_flags|=O.e_islandFlag,f=n.other,f.m_flags&m.e_islandFlag||(f.GetType()!=m.b2_staticBody&&(f.Advance(a),f.SetAwake(!0)),o[r+u]=f,++u,f.m_flags|=m.e_islandFlag))}for(t=t.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&t.joint.m_islandFlag!=1&&(f=t.other,f.IsActive()!=0&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,f.m_flags&m.e_islandFlag||(f.GetType()!=m.b2_staticBody&&(f.Advance(a),f.SetAwake(!0)),o[r+u]=f,++u,f.m_flags|=m.e_islandFlag)))}}r=A.s_timestep,r.warmStarting=!1,r.dt=(1-a)*e.dt,r.inv_dt=1/r.dt,r.dtRatio=0,r.velocityIterations=e.velocityIterations,r.positionIterations=e.positionIterations,i.SolveTOI(r);for(a=a=0;a<i.m_bodyCount;++a){t=i.m_bodies[a],t.m_flags&=~m.e_islandFlag;if(t.IsAwake()!=0&&t.GetType()==m.b2_dynamicBody){t.SynchronizeFixtures();for(n=t.m_contactList;n;n=n.next)n.contact.m_flags&=~O.e_toiFlag}}for(a=0;a<i.m_contactCount;++a)r=i.m_contacts[a],r.m_flags&=~(O.e_toiFlag|O.e_islandFlag);for(a=0;a<i.m_jointCount;++a)r=i.m_joints[a],r.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},A.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf.position,i=n.m_xf.position,s=e.GetAnchorA(),o=e.GetAnchorB(),u=A.s_jointColor;switch(e.m_type){case D.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,u);break;case D.e_pulleyJoint:t=e instanceof P?e:null,e=t.GetGroundAnchorA(),t=t.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(e,s,u),this.m_debugDraw.DrawSegment(t,o,u),this.m_debugDraw.DrawSegment(e,t,u);break;case D.e_mouseJoint:this.m_debugDraw.DrawSegment(s,o,u);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,u),this.m_debugDraw.DrawSegment(s,o,u),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,u)}},A.prototype.DrawShape=function(t,n,r){switch(t.m_type){case v.e_circleShape:var i=t instanceof c?t:null;this.m_debugDraw.DrawSolidCircle(e.MulX(n,i.m_p),i.m_radius,n.R.col1,r);break;case v.e_polygonShape:i=0,i=t instanceof d?t:null,t=parseInt(i.GetVertexCount());var s=i.GetVertices(),o=new Vector(t);for(i=0;i<t;++i)o[i]=e.MulX(n,s[i]);this.m_debugDraw.DrawSolidPolygon(o,t,r);break;case v.e_edgeShape:i=t instanceof h?t:null,this.m_debugDraw.DrawSegment(e.MulX(n,i.GetVertex1()),e.MulX(n,i.GetVertex2()),r)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new L,Box2D.Dynamics.b2World.s_xf=new n,Box2D.Dynamics.b2World.s_backupA=new t,Box2D.Dynamics.b2World.s_backupB=new t,Box2D.Dynamics.b2World.s_timestep=new L,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new i(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,i=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,o=Box2D.Dynamics.Contacts.b2ContactConstraint,u=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,a=Box2D.Dynamics.Contacts.b2ContactEdge,f=Box2D.Dynamics.Contacts.b2ContactFactory,l=Box2D.Dynamics.Contacts.b2ContactRegister,c=Box2D.Dynamics.Contacts.b2ContactResult,h=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,d=Box2D.Dynamics.Contacts.b2NullContact,v=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,m=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,g=Box2D.Dynamics.Contacts.b2PolygonContact,y=Box2D.Dynamics.Contacts.b2PositionSolverManifold,b=Box2D.Dynamics.b2Body,w=Box2D.Dynamics.b2TimeStep,E=Box2D.Common.b2Settings,S=Box2D.Common.Math.b2Mat22,x=Box2D.Common.Math.b2Math,T=Box2D.Common.Math.b2Vec2,N=Box2D.Collision.b2Collision,C=Box2D.Collision.b2ContactID,k=Box2D.Collision.b2Manifold,L=Box2D.Collision.b2TimeOfImpact,A=Box2D.Collision.b2TOIInput,O=Box2D.Collision.b2WorldManifold;Box2D.inherit(i,Box2D.Dynamics.Contacts.b2Contact),i.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,i.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},i.Create=function(){return new i},i.Destroy=function(){},i.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},i.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();N.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},s.b2Contact=function(){this.m_nodeA=new a,this.m_nodeB=new a,this.m_manifold=new k,this.m_oldManifold=new k},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(e){e?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(e){e?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),this.m_flags=s.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=s.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=b.b2_dynamicBody||n.IsBullet()||r.GetType()!=b.b2_dynamicBody||r.IsBullet())this.m_flags|=s.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}},s.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=s.e_enabledFlag;var n=!1;t=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var i=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body,u=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag)u&&(n=this.m_fixtureA.GetShape(),u=this.m_fixtureB.GetShape(),i=i.GetTransform(),o=o.GetTransform(),n=r.TestOverlap(n,i,u,o)),this.m_manifold.m_pointCount=0;else{i.GetType()!=b.b2_dynamicBody||i.IsBullet()||o.GetType()!=b.b2_dynamicBody||o.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag;if(u){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(u=0;u<this.m_manifold.m_pointCount;++u){var a=this.m_manifold.m_points[u];a.m_normalImpulse=0,a.m_tangentImpulse=0;for(var f=a.m_id,l=0;l<this.m_oldManifold.m_pointCount;++l){var c=this.m_oldManifold.m_points[l];if(c.m_id.key==f.key){a.m_normalImpulse=c.m_normalImpulse,a.m_tangentImpulse=c.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=t&&(i.SetAwake(!0),o.SetAwake(!0))}n?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,t==0&&n==1&&e.BeginContact(this),t==1&&n==0&&e.EndContact(this),(this.m_flags&s.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(e,t){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=e,s.s_input.sweepB=t,s.s_input.tolerance=E.b2_linearSlop,L.TimeOfImpact(s.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new A}),o.b2ContactConstraint=function(){this.localPlaneNormal=new T,this.localPoint=new T,this.normal=new T,this.normalMass=new S,this.K=new S},o.prototype.b2ContactConstraint=function(){this.points=new Vector(E.b2_maxManifoldPoints);for(var e=0;e<E.b2_maxManifoldPoints;e++)this.points[e]=new u},u.b2ContactConstraintPoint=function(){this.localPoint=new T,this.rA=new T,this.rB=new T},a.b2ContactEdge=function(){},f.b2ContactFactory=function(){},f.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},f.prototype.AddType=function(e,t,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},f.prototype.InitializeRegisters=function(){this.m_registers=new Vector(r.e_shapeTypeCount);for(var e=0;e<r.e_shapeTypeCount;e++){this.m_registers[e]=new Vector(r.e_shapeTypeCount);for(var t=0;t<r.e_shapeTypeCount;t++)this.m_registers[e][t]=new l}this.AddType(i.Create,i.Destroy,r.e_circleShape,r.e_circleShape),this.AddType(v.Create,v.Destroy,r.e_polygonShape,r.e_circleShape),this.AddType(g.Create,g.Destroy,r.e_polygonShape,r.e_polygonShape),this.AddType(p.Create,p.Destroy,r.e_edgeShape,r.e_circleShape),this.AddType(m.Create,m.Destroy,r.e_polygonShape,r.e_edgeShape)},f.prototype.Create=function(e,t){var n=parseInt(e.GetType()),r=parseInt(t.GetType());return n=this.m_registers[n][r],n.pool?(r=n.pool,n.pool=r.m_next,n.poolCount--,r.Reset(e,t),r):(r=n.createFcn,r!=null?(n.primary?(r=r(this.m_allocator),r.Reset(e,t)):(r=r(this.m_allocator),r.Reset(t,e)),r):null)},f.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),n=parseInt(e.m_fixtureB.GetType());t=this.m_registers[t][n],t.poolCount++,e.m_next=t.pool,t.pool=e,t=t.destroyFcn,t(e,this.m_allocator)},l.b2ContactRegister=function(){},c.b2ContactResult=function(){this.position=new T,this.normal=new T,this.id=new C},h.b2ContactSolver=function(){this.m_step=new w,this.m_constraints=new Vector},h.prototype.b2ContactSolver=function(){},h.prototype.Initialize=function(e,t,n,r){n===undefined&&(n=0);var i;this.m_step.Set(e),this.m_allocator=r,e=0;for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new o;for(e=0;e<n;++e){i=t[e],r=i.m_fixtureA;var s=i.m_fixtureB,u=r.m_shape.m_radius,a=s.m_shape.m_radius,f=r.m_body,l=s.m_body,c=i.GetManifold(),p=E.b2MixFriction(r.GetFriction(),s.GetFriction()),d=E.b2MixRestitution(r.GetRestitution(),s.GetRestitution()),v=f.m_linearVelocity.x,m=f.m_linearVelocity.y,g=l.m_linearVelocity.x,y=l.m_linearVelocity.y,b=f.m_angularVelocity,w=l.m_angularVelocity;E.b2Assert(c.m_pointCount>0),h.s_worldManifold.Initialize(c,f.m_xf,u,l.m_xf,a),s=h.s_worldManifold.m_normal.x,i=h.s_worldManifold.m_normal.y,r=this.m_constraints[e],r.bodyA=f,r.bodyB=l,r.manifold=c,r.normal.x=s,r.normal.y=i,r.pointCount=c.m_pointCount,r.friction=p,r.restitution=d,r.localPlaneNormal.x=c.m_localPlaneNormal.x,r.localPlaneNormal.y=c.m_localPlaneNormal.y,r.localPoint.x=c.m_localPoint.x,r.localPoint.y=c.m_localPoint.y,r.radius=u+a,r.type=c.m_type;for(u=0;u<r.pointCount;++u){p=c.m_points[u],a=r.points[u],a.normalImpulse=p.m_normalImpulse,a.tangentImpulse=p.m_tangentImpulse,a.localPoint.SetV(p.m_localPoint),p=a.rA.x=h.s_worldManifold.m_points[u].x-f.m_sweep.c.x,d=a.rA.y=h.s_worldManifold.m_points[u].y-f.m_sweep.c.y;var S=a.rB.x=h.s_worldManifold.m_points[u].x-l.m_sweep.c.x,x=a.rB.y=h.s_worldManifold.m_points[u].y-l.m_sweep.c.y,T=p*i-d*s,N=S*i-x*s;T*=T,N*=N,a.normalMass=1/(f.m_invMass+l.m_invMass+f.m_invI*T+l.m_invI*N);var C=f.m_mass*f.m_invMass+l.m_mass*l.m_invMass;C+=f.m_mass*f.m_invI*T+l.m_mass*l.m_invI*N,a.equalizedMass=1/C,N=i,C=-s,T=p*C-d*N,N=S*C-x*N,T*=T,N*=N,a.tangentMass=1/(f.m_invMass+l.m_invMass+f.m_invI*T+l.m_invI*N),a.velocityBias=0,p=r.normal.x*(g+ -w*x-v- -b*d)+r.normal.y*(y+w*S-m-b*p),p<-E.b2_velocityThreshold&&(a.velocityBias+=-r.restitution*p)}r.pointCount==2&&(y=r.points[0],g=r.points[1],c=f.m_invMass,f=f.m_invI,v=l.m_invMass,l=l.m_invI,m=y.rA.x*i-y.rA.y*s,y=y.rB.x*i-y.rB.y*s,b=g.rA.x*i-g.rA.y*s,g=g.rB.x*i-g.rB.y*s,s=c+v+f*m*m+l*y*y,i=c+v+f*b*b+l*g*g,l=c+v+f*m*b+l*y*g,s*s<100*(s*i-l*l)?(r.K.col1.Set(s,l),r.K.col2.Set(l,i),r.K.GetInverse(r.normalMass)):r.pointCount=1)}},h.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},h.prototype.SolveVelocityConstraints=function(){for(var e=0,t,n=0,r=0,i=0,s=r=r=n=n=0,o=n=n=0,u=n=i=0,a=0,f,l=0;l<this.m_constraintCount;++l){i=this.m_constraints[l];var c=i.bodyA,h=i.bodyB,p=c.m_angularVelocity,d=h.m_angularVelocity,v=c.m_linearVelocity,m=h.m_linearVelocity,g=c.m_invMass,y=c.m_invI,b=h.m_invMass,w=h.m_invI;u=i.normal.x;var E=a=i.normal.y;f=-u,o=i.friction;for(e=0;e<i.pointCount;e++)t=i.points[e],n=m.x-d*t.rB.y-v.x+p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,n=n*E+r*f,n=t.tangentMass*-n,r=o*t.normalImpulse,r=x.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*E,n*=f,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;parseInt(i.pointCount);if(i.pointCount==1)t=i.points[0],n=m.x+ -d*t.rB.y-v.x- -p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,i=n*u+r*a,n=-t.normalMass*(i-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*u,n*=a,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=i.points[0],e=i.points[1],n=t.normalImpulse,o=e.normalImpulse;var S=(m.x-d*t.rB.y-v.x+p*t.rA.y)*u+(m.y+d*t.rB.x-v.y-p*t.rA.x)*a,T=(m.x-d*e.rB.y-v.x+p*e.rA.y)*u+(m.y+d*e.rB.x-v.y-p*e.rA.x)*a;r=S-t.velocityBias,s=T-e.velocityBias,f=i.K,r-=f.col1.x*n+f.col2.x*o;for(s-=f.col1.y*n+f.col2.y*o;;){f=i.normalMass,E=-(f.col1.x*r+f.col2.x*s),f=-(f.col1.y*r+f.col2.y*s);if(E>=0&&f>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=-t.normalMass*r,f=0,T=i.K.col1.y*E+s;if(E>=0&&T>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=0,f=-e.normalMass*s,S=i.K.col2.x*f+r;if(f>=0&&S>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}f=E=0,S=r,T=s;if(S>=0&&T>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}break}}c.m_angularVelocity=p,h.m_angularVelocity=d}},h.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},h.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;h.s_psm.Initialize(r);for(var l=h.s_psm.m_normal,c=0;c<r.pointCount;c++){var p=r.points[c],d=h.s_psm.m_points[c],v=h.s_psm.m_separations[c],m=d.x-i.m_sweep.c.x,g=d.y-i.m_sweep.c.y,y=d.x-s.m_sweep.c.x;d=d.y-s.m_sweep.c.y,t=t<v?t:v,v=x.Clamp(e*(v+E.b2_linearSlop),-E.b2_maxLinearCorrection,0),v=-p.equalizedMass*v,p=v*l.x,v*=l.y,i.m_sweep.c.x-=o*p,i.m_sweep.c.y-=o*v,i.m_sweep.a-=u*(m*v-g*p),i.SynchronizeTransform(),s.m_sweep.c.x+=a*p,s.m_sweep.c.y+=a*v,s.m_sweep.a+=f*(y*v-d*p),s.SynchronizeTransform()}}return t>-1.5*E.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new O,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new y}),Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(){return new p},p.Destroy=function(){},p.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},p.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},p.prototype.b2CollideEdgeAndCircle=function(){},Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact),d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,d.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},d.prototype.Evaluate=function(){},Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact),v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,v.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(){return new v},v.Destroy=function(){},v.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),E.b2Assert(e.GetType()==r.e_polygonShape),E.b2Assert(t.GetType()==r.e_circleShape)},v.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body;N.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(){return new m},m.Destroy=function(){},m.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),E.b2Assert(e.GetType()==r.e_polygonShape),E.b2Assert(t.GetType()==r.e_edgeShape)},m.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,r.m_xf)},m.prototype.b2CollidePolyAndEdge=function(){},Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(){return new g},g.Destroy=function(){},g.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},g.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();N.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,t.m_xf)},y.b2PositionSolverManifold=function(){},y.prototype.b2PositionSolverManifold=function(){this.m_normal=new T,this.m_separations=new Vector_a2j_Number(E.b2_maxManifoldPoints),this.m_points=new Vector(E.b2_maxManifoldPoints);for(var e=0;e<E.b2_maxManifoldPoints;e++)this.m_points[e]=new T},y.prototype.Initialize=function(e){E.b2Assert(e.pointCount>0);var t=0,n=0,r=0,i,s=0,o=0;switch(e.type){case k.e_circles:i=e.bodyA.m_xf.R,r=e.localPoint,t=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),n=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R,r=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),i=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),r=s-t,o=i-n;var u=r*r+o*o;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=Math.sqrt(u),this.m_normal.x=r/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(t+s),this.m_points[0].y=.5*(n+i),this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case k.e_faceA:i=e.bodyA.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyA.m_xf.R,r=e.localPoint,s=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case k.e_faceB:i=e.bodyB.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyB.m_xf.R,r=e.localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new T,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new T})}(),function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Vec2,r=Box2D.Common.b2Color,i=Box2D.Dynamics.Controllers.b2BuoyancyController,s=Box2D.Dynamics.Controllers.b2ConstantAccelController,o=Box2D.Dynamics.Controllers.b2ConstantForceController,u=Box2D.Dynamics.Controllers.b2Controller,a=Box2D.Dynamics.Controllers.b2ControllerEdge,f=Box2D.Dynamics.Controllers.b2GravityController,l=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(i,Box2D.Dynamics.Controllers.b2Controller),i.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,i.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new n(0,-1),this.density=this.offset=0,this.velocity=new n(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},i.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=0){for(var r=new n,i=new n,s=0,o=0,u=t.GetFixtureList();u;u=u.GetNext()){var a=new n,f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),a);s+=f,r.x+=f*a.x,r.y+=f*a.y;var l=0;l=1,o+=f*l,i.x+=f*a.x*l,i.y+=f*a.y*l}r.x/=s,r.y/=s,i.x/=o,i.y/=o,s<Number.MIN_VALUE||(o=this.gravity.GetNegative(),o.Multiply(this.density*s),t.ApplyForce(o,i),i=t.GetLinearVelocityFromWorldPoint(r),i.Subtract(this.velocity),i.Multiply(-this.linearDrag*s),t.ApplyForce(i,r),t.ApplyTorque(-t.GetInertia()/t.GetMass()*s*t.GetAngularVelocity()*this.angularDrag))}}}},i.prototype.Draw=function(e){var t=new n,i=new n;t.x=this.normal.x*this.offset+this.normal.y*1e3,t.y=this.normal.y*this.offset-this.normal.x*1e3,i.x=this.normal.x*this.offset-this.normal.y*1e3,i.y=this.normal.y*this.offset+this.normal.x*1e3;var s=new r(0,0,1);e.DrawSegment(t,i,s)},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new n(0,0)},s.prototype.Step=function(e){e=new n(this.A.x*e.dt,this.A.y*e.dt);for(var t=this.m_bodyList;t;t=t.nextBody){var r=t.body;r.IsAwake()&&r.SetLinearVelocity(new n(r.GetLinearVelocity().x+e.x,r.GetLinearVelocity().y+e.y))}},Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new n(0,0)},o.prototype.Step=function(){for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},u.b2Controller=function(){},u.prototype.Step=function(){},u.prototype.Draw=function(){},u.prototype.AddBody=function(e){var t=new a;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},u.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},u.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetWorld=function(){return this.m_world},u.prototype.GetBodyList=function(){return this.m_bodyList},a.b2ControllerEdge=function(){},Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller),f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,f.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},f.prototype.Step=function(){var e=null,t=null,r=null,i=0,s=null,o=null,u=null,a=0,f=0,l=0;a=null;if(this.invSqr)for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,r=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new n(a,f),a.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,r),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}else for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,r=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new n(a,f),a.Multiply(this.G/l*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,r),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}},Box2D.inherit(l,Box2D.Dynamics.Controllers.b2Controller),l.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,l.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new e,this.maxTimestep=0},l.prototype.SetAxisAligned=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0},l.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var r=this.m_bodyList;r;r=r.nextBody){var i=r.body;if(i.IsAwake()){var s=i.GetWorldVector(t.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity())));i.SetLinearVelocity(new n(i.GetLinearVelocity().x+s.x*e,i.GetLinearVelocity().y+s.y*e))}}}}}(),function(){var e=Box2D.Common.b2Settings,t=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,o=Box2D.Dynamics.Joints.b2DistanceJoint,u=Box2D.Dynamics.Joints.b2DistanceJointDef,a=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,l=Box2D.Dynamics.Joints.b2GearJoint,c=Box2D.Dynamics.Joints.b2GearJointDef,h=Box2D.Dynamics.Joints.b2Jacobian,p=Box2D.Dynamics.Joints.b2Joint,d=Box2D.Dynamics.Joints.b2JointDef,v=Box2D.Dynamics.Joints.b2JointEdge,m=Box2D.Dynamics.Joints.b2LineJoint,g=Box2D.Dynamics.Joints.b2LineJointDef,y=Box2D.Dynamics.Joints.b2MouseJoint,b=Box2D.Dynamics.Joints.b2MouseJointDef,w=Box2D.Dynamics.Joints.b2PrismaticJoint,E=Box2D.Dynamics.Joints.b2PrismaticJointDef,S=Box2D.Dynamics.Joints.b2PulleyJoint,x=Box2D.Dynamics.Joints.b2PulleyJointDef,T=Box2D.Dynamics.Joints.b2RevoluteJoint,N=Box2D.Dynamics.Joints.b2RevoluteJointDef,C=Box2D.Dynamics.Joints.b2WeldJoint,k=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.inherit(o,Box2D.Dynamics.Joints.b2Joint),o.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,o.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u=new i},o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},o.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},o.prototype.GetReactionTorque=function(){return 0},o.prototype.GetLength=function(){return this.m_length},o.prototype.SetLength=function(e){e===undefined&&(e=0),this.m_length=e},o.prototype.GetFrequency=function(){return this.m_frequencyHz},o.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},o.prototype.GetDampingRatio=function(){return this.m_dampingRatio},o.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},o.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},o.prototype.InitVelocityConstraints=function(t){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u,r=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),r>e.b2_linearSlop?this.m_u.Multiply(1/r):this.m_u.SetZero(),n=o*this.m_u.y-u*this.m_u.x;var l=a*this.m_u.y-f*this.m_u.x;n=i.m_invMass+i.m_invI*n*n+s.m_invMass+s.m_invI*l*l,this.m_mass=n!=0?1/n:0;if(this.m_frequencyHz>0){r-=this.m_length,l=2*Math.PI*this.m_frequencyHz;var c=this.m_mass*l*l;this.m_gamma=t.dt*(2*this.m_mass*this.m_dampingRatio*l+t.dt*c),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=r*t.dt*c*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}t.warmStarting?(this.m_impulse*=t.dtRatio,t=this.m_impulse*this.m_u.x,n=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*n,i.m_angularVelocity-=i.m_invI*(o*n-u*t),s.m_linearVelocity.x+=s.m_invMass*t,s.m_linearVelocity.y+=s.m_invMass*n,s.m_angularVelocity+=s.m_invI*(a*n-f*t)):this.m_impulse=0},o.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},o.prototype.SolvePositionConstraints=function(){var t;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,i=this.m_bodyB;t=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=t.col1.x*s+t.col2.x*o;o=t.col1.y*s+t.col2.y*o,s=u,t=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,f=this.m_localAnchor2.y-i.m_sweep.localCenter.y;u=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=u,u=i.m_sweep.c.x+a-n.m_sweep.c.x-s;var l=i.m_sweep.c.y+f-n.m_sweep.c.y-o;t=Math.sqrt(u*u+l*l),u/=t,l/=t,t-=this.m_length,t=r.Clamp(t,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);var c=-this.m_mass*t;return this.m_u.Set(u,l),u=c*this.m_u.x,l=c*this.m_u.y,n.m_sweep.c.x-=n.m_invMass*u,n.m_sweep.c.y-=n.m_invMass*l,n.m_sweep.a-=n.m_invI*(s*l-o*u),i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*l,i.m_sweep.a+=i.m_invI*(a*l-f*u),n.SynchronizeTransform(),i.SynchronizeTransform(),r.Abs(t)<e.b2_linearSlop},Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef),u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,u.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},u.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},u.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},Box2D.inherit(a,Box2D.Dynamics.Joints.b2Joint),a.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,a.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_linearMass=new t,this.m_linearImpulse=new i},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},a.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},a.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_angularImpulse},a.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},a.prototype.GetMaxForce=function(){return this.m_maxForce},a.prototype.SetMaxTorque=function(e){e===undefined&&(e=0),this.m_maxTorque=e},a.prototype.GetMaxTorque=function(){return this.m_maxTorque},a.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},a.prototype.InitVelocityConstraints=function(e){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchorA.x-i.m_sweep.localCenter.x,u=this.m_localAnchorA.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,n=i.m_invMass,r=s.m_invMass;var l=i.m_invI,c=s.m_invI,h=new t;h.col1.x=n+r,h.col2.x=0,h.col1.y=0,h.col2.y=n+r,h.col1.x+=l*u*u,h.col2.x+=-l*o*u,h.col1.y+=-l*o*u,h.col2.y+=l*o*o,h.col1.x+=c*f*f,h.col2.x+=-c*a*f,h.col1.y+=-c*a*f,h.col2.y+=c*a*a,h.GetInverse(this.m_linearMass),this.m_angularMass=l+c,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,i.m_linearVelocity.x-=n*e.x,i.m_linearVelocity.y-=n*e.y,i.m_angularVelocity-=l*(o*e.y-u*e.x+this.m_angularImpulse),s.m_linearVelocity.x+=r*e.x,s.m_linearVelocity.y+=r*e.y,s.m_angularVelocity+=c*(a*e.y-f*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},a.prototype.SolveVelocityConstraints=function(e){var t,n=0,s=this.m_bodyA,o=this.m_bodyB,u=s.m_linearVelocity,a=s.m_angularVelocity,f=o.m_linearVelocity,l=o.m_angularVelocity,c=s.m_invMass,h=o.m_invMass,p=s.m_invI,d=o.m_invI;t=s.m_xf.R;var v=this.m_localAnchorA.x-s.m_sweep.localCenter.x,m=this.m_localAnchorA.y-s.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,t=o.m_xf.R;var g=this.m_localAnchorB.x-o.m_sweep.localCenter.x,y=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y,y=t.col1.y*g+t.col2.y*y,g=n,t=0,n=-this.m_angularMass*(l-a);var b=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=r.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-b,a-=p*n,l+=d*n,t=r.MulMV(this.m_linearMass,new i(-(f.x-l*y-u.x+a*m),-(f.y+l*g-u.y-a*v))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=r.SubtractVV(this.m_linearImpulse,n),u.x-=c*t.x,u.y-=c*t.y,a-=p*(v*t.y-m*t.x),f.x+=h*t.x,f.y+=h*t.y,l+=d*(g*t.y-y*t.x),s.m_angularVelocity=a,o.m_angularVelocity=l},a.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef),f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_frictionJoint,this.maxTorque=this.maxForce=0},f.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_J=new h},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},l.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},l.prototype.GetReactionTorque=function(e){e===undefined&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;return r=t.col1.y*n+t.col2.y*r,n=i,e*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},l.prototype.GetRatio=function(){return this.m_ratio},l.prototype.SetRatio=function(e){e===undefined&&(e=0),this.m_ratio=e},l.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),n=parseInt(e.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==p.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof T?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof w?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==p.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof T?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof w?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},l.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f=u=0,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(t=t.m_xf.R,o=this.m_prismatic1.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-u,l+=r.m_invMass+r.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(t=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*u,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*u*u)),this.m_mass=l>0?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},l.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},l.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,r=0,i=0;return r=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),i=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),r=-this.m_mass*(this.m_constant-(r+this.m_ratio*i)),t.m_sweep.c.x+=t.m_invMass*r*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*r*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*r*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*r*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*r*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*r*this.m_J.angularB,t.SynchronizeTransform(),n.SynchronizeTransform(),0<e.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},c.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},h.b2Jacobian=function(){this.linearA=new i,this.linearB=new i},h.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},h.prototype.Set=function(e,t,n,r){t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},h.prototype.Compute=function(e,t,n,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},p.b2Joint=function(){this.m_edgeA=new v,this.m_edgeB=new v,this.m_localCenterA=new i,this.m_localCenterB=new i},p.prototype.GetType=function(){return this.m_type},p.prototype.GetAnchorA=function(){return null},p.prototype.GetAnchorB=function(){return null},p.prototype.GetReactionForce=function(){return null},p.prototype.GetReactionTorque=function(){return 0},p.prototype.GetBodyA=function(){return this.m_bodyA},p.prototype.GetBodyB=function(){return this.m_bodyB},p.prototype.GetNext=function(){return this.m_next},p.prototype.GetUserData=function(){return this.m_userData},p.prototype.SetUserData=function(e){this.m_userData=e},p.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},p.Create=function(e){var t=null;switch(e.type){case p.e_distanceJoint:t=new o(e instanceof u?e:null);break;case p.e_mouseJoint:t=new y(e instanceof b?e:null);break;case p.e_prismaticJoint:t=new w(e instanceof E?e:null);break;case p.e_revoluteJoint:t=new T(e instanceof N?e:null);break;case p.e_pulleyJoint:t=new S(e instanceof x?e:null);break;case p.e_gearJoint:t=new l(e instanceof c?e:null);break;case p.e_lineJoint:t=new m(e instanceof g?e:null);break;case p.e_weldJoint:t=new C(e instanceof k?e:null);break;case p.e_frictionJoint:t=new a(e instanceof f?e:null)}return t},p.Destroy=function(){},p.prototype.b2Joint=function(t){e.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_next=this.m_prev=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},p.prototype.InitVelocityConstraints=function(){},p.prototype.SolveVelocityConstraints=function(){},p.prototype.FinalizeVelocityConstraints=function(){},p.prototype.SolvePositionConstraints=function(){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),d.b2JointDef=function(){},d.prototype.b2JointDef=function(){this.type=p.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},v.b2JointEdge=function(){},Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint),m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,m.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new t,this.m_impulse=new i},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},m.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},m.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},m.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},m.prototype.IsLimitEnabled=function(){return this.m_enableLimit},m.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},m.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},m.prototype.GetUpperLimit=function(){return this.m_upperTranslation},m.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},m.prototype.IsMotorEnabled=function(){return this.m_enableMotor},m.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},m.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},m.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},m.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},m.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},m.prototype.GetMotorForce=function(){return this.m_motorImpulse},m.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},m.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var u=n.GetTransform();i.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=i.m_sweep.c.x+l-n.m_sweep.c.x-a,o=i.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(r.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(r.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=p.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.y=0):s>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=p.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*s,i.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},m.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,s=t.m_linearVelocity,o=t.m_angularVelocity,u=n.m_linearVelocity,a=n.m_angularVelocity,f=0,l=0,c=0,h=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(h=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(u.x-s.x)+this.m_axis.y*(u.y-s.y)+this.m_a2*a-this.m_a1*o)),f=this.m_motorImpulse,l=e.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+h,-l,l),h=this.m_motorImpulse-f,f=h*this.m_axis.x,l=h*this.m_axis.y,c=h*this.m_a1,h*=this.m_a2,s.x-=this.m_invMassA*f,s.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h),l=this.m_perp.x*(u.x-s.x)+this.m_perp.y*(u.y-s.y)+this.m_s2*a-this.m_s1*o,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(c=this.m_axis.x*(u.x-s.x)+this.m_axis.y*(u.y-s.y)+this.m_a2*a-this.m_a1*o,f=this.m_impulse.Copy(),e=this.m_K.Solve(new i,-l,-c),this.m_impulse.Add(e),this.m_limitState==p.e_atLowerLimit?this.m_impulse.y=r.Max(this.m_impulse.y,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.y=r.Min(this.m_impulse.y,0)),l=-l-(this.m_impulse.y-f.y)*this.m_K.col2.x,c=0,c=this.m_K.col1.x!=0?l/this.m_K.col1.x+f.x:f.x,this.m_impulse.x=c,e.x=this.m_impulse.x-f.x,e.y=this.m_impulse.y-f.y,f=e.x*this.m_perp.x+e.y*this.m_axis.x,l=e.x*this.m_perp.y+e.y*this.m_axis.y,c=e.x*this.m_s1+e.y*this.m_a1,h=e.x*this.m_s2+e.y*this.m_a2):(e=0,e=this.m_K.col1.x!=0?-l/this.m_K.col1.x:0,this.m_impulse.x+=e,f=e*this.m_perp.x,l=e*this.m_perp.y,c=e*this.m_s1,h=e*this.m_s2),s.x-=this.m_invMassA*f,s.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h,t.m_linearVelocity.SetV(s),t.m_angularVelocity=o,n.m_linearVelocity.SetV(u),n.m_angularVelocity=a},m.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,s=this.m_bodyB,o=n.m_sweep.c,u=n.m_sweep.a,a=s.m_sweep.c,f=s.m_sweep.a,l,c=0,h=0,p=0,d=0,v=l=0,m=0;h=!1;var g=0,y=t.FromAngle(u);p=t.FromAngle(f),l=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var b=this.m_localAnchor1.y-this.m_localCenterA.y;c=l.col1.x*m+l.col2.x*b,b=l.col1.y*m+l.col2.y*b,m=c,l=p,p=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,c=l.col1.x*p+l.col2.x*d,d=l.col1.y*p+l.col2.y*d,p=c,l=a.x+p-o.x-m,c=a.y+d-o.y-b;if(this.m_enableLimit){this.m_axis=r.MulMV(y,this.m_localXAxis1),this.m_a1=(l+m)*this.m_axis.y-(c+b)*this.m_axis.x,this.m_a2=p*this.m_axis.y-d*this.m_axis.x;var w=this.m_axis.x*l+this.m_axis.y*c;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=r.Clamp(w,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=r.Abs(w),h=!0):w<=this.m_lowerTranslation?(g=r.Clamp(w-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-w,h=!0):w>=this.m_upperTranslation&&(g=r.Clamp(w-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=w-this.m_upperTranslation,h=!0)}return this.m_perp=r.MulMV(y,this.m_localYAxis1),this.m_s1=(l+m)*this.m_perp.y-(c+b)*this.m_perp.x,this.m_s2=p*this.m_perp.y-d*this.m_perp.x,y=new i,b=this.m_perp.x*l+this.m_perp.y*c,v=r.Max(v,r.Abs(b)),m=0,h?(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+p+d*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve(y,-b,-g)):(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,g=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,h=0,h=g!=0?-b/g:0,y.x=h,y.y=0),g=y.x*this.m_perp.x+y.y*this.m_axis.x,h=y.x*this.m_perp.y+y.y*this.m_axis.y,b=y.x*this.m_s1+y.y*this.m_a1,y=y.x*this.m_s2+y.y*this.m_a2,o.x-=this.m_invMassA*g,o.y-=this.m_invMassA*h,u-=this.m_invIA*b,a.x+=this.m_invMassB*g,a.y+=this.m_invMassB*h,f+=this.m_invIB*y,n.m_sweep.a=u,s.m_sweep.a=f,n.SynchronizeTransform(),s.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef),g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,g.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},g.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},g.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.m_localAnchor=new i,this.m_target=new i,this.m_impulse=new i,this.m_mass=new t,this.m_C=new i},y.prototype.GetAnchorA=function(){return this.m_target},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},y.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},y.prototype.GetReactionTorque=function(){return 0},y.prototype.GetTarget=function(){return this.m_target},y.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},y.prototype.GetMaxForce=function(){return this.m_maxForce},y.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},y.prototype.GetFrequency=function(){return this.m_frequencyHz},y.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},y.prototype.GetDampingRatio=function(){return this.m_dampingRatio},y.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},y.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},y.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI,this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},y.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},y.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef),b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new i},b.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new n,this.m_impulse=new s},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},w.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},w.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},w.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},w.prototype.IsLimitEnabled=function(){return this.m_enableLimit},w.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},w.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},w.prototype.GetUpperLimit=function(){return this.m_upperTranslation},w.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},w.prototype.IsMotorEnabled=function(){return this.m_enableMotor},w.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},w.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},w.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},w.prototype.GetMotorForce=function(){return this.m_motorImpulse},w.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},w.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var u=n.GetTransform();i.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=i.m_sweep.c.x+l-n.m_sweep.c.x-a,o=i.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(r.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(r.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+l*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+l,this.m_K.col2.z=f*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=p.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.z=0):s>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=p.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*s,i.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},w.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,o=t.m_linearVelocity,u=t.m_angularVelocity,a=n.m_linearVelocity,f=n.m_angularVelocity,l=0,c=0,h=0,d=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(d=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*f-this.m_a1*u)),l=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+d,-e,e),d=this.m_motorImpulse-l,l=d*this.m_axis.x,c=d*this.m_axis.y,h=d*this.m_a1,d*=this.m_a2,o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*d),h=this.m_perp.x*(a.x-o.x)+this.m_perp.y*(a.y-o.y)+this.m_s2*f-this.m_s1*u,c=f-u,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(e=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*f-this.m_a1*u,l=this.m_impulse.Copy(),e=this.m_K.Solve33(new s,-h,-c,-e),this.m_impulse.Add(e),this.m_limitState==p.e_atLowerLimit?this.m_impulse.z=r.Max(this.m_impulse.z,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.z=r.Min(this.m_impulse.z,0)),h=-h-(this.m_impulse.z-l.z)*this.m_K.col3.x,c=-c-(this.m_impulse.z-l.z)*this.m_K.col3.y,c=this.m_K.Solve22(new i,h,c),c.x+=l.x,c.y+=l.y,this.m_impulse.x=c.x,this.m_impulse.y=c.y,e.x=this.m_impulse.x-l.x,e.y=this.m_impulse.y-l.y,e.z=this.m_impulse.z-l.z,l=e.x*this.m_perp.x+e.z*this.m_axis.x,c=e.x*this.m_perp.y+e.z*this.m_axis.y,h=e.x*this.m_s1+e.y+e.z*this.m_a1,d=e.x*this.m_s2+e.y+e.z*this.m_a2):(e=this.m_K.Solve22(new i,-h,-c),this.m_impulse.x+=e.x,this.m_impulse.y+=e.y,l=e.x*this.m_perp.x,c=e.x*this.m_perp.y,h=e.x*this.m_s1+e.y,d=e.x*this.m_s2+e.y),o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*d,t.m_linearVelocity.SetV(o),t.m_angularVelocity=u,n.m_linearVelocity.SetV(a),n.m_angularVelocity=f},w.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,o=this.m_bodyB,u=n.m_sweep.c,a=n.m_sweep.a,f=o.m_sweep.c,l=o.m_sweep.a,c,h=0,p=0,d=0,v=h=c=0,m=0;p=!1;var g=0,y=t.FromAngle(a),b=t.FromAngle(l);c=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var w=this.m_localAnchor1.y-this.m_localCenterA.y;h=c.col1.x*m+c.col2.x*w,w=c.col1.y*m+c.col2.y*w,m=h,c=b,b=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,h=c.col1.x*b+c.col2.x*d,d=c.col1.y*b+c.col2.y*d,b=h,c=f.x+b-u.x-m,h=f.y+d-u.y-w;if(this.m_enableLimit){this.m_axis=r.MulMV(y,this.m_localXAxis1),this.m_a1=(c+m)*this.m_axis.y-(h+w)*this.m_axis.x,this.m_a2=b*this.m_axis.y-d*this.m_axis.x;var E=this.m_axis.x*c+this.m_axis.y*h;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=r.Clamp(E,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=r.Abs(E),p=!0):E<=this.m_lowerTranslation?(g=r.Clamp(E-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-E,p=!0):E>=this.m_upperTranslation&&(g=r.Clamp(E-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=E-this.m_upperTranslation,p=!0)}return this.m_perp=r.MulMV(y,this.m_localYAxis1),this.m_s1=(c+m)*this.m_perp.y-(h+w)*this.m_perp.x,this.m_s2=b*this.m_perp.y-d*this.m_perp.x,y=new s,w=this.m_perp.x*c+this.m_perp.y*h,b=l-a-this.m_refAngle,v=r.Max(v,r.Abs(w)),m=r.Abs(b),p?(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+h*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+h,this.m_K.col2.z=c*this.m_a1+h*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+d+c*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve33(y,-w,-b,-g)):(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,g=c*this.m_s1+h*this.m_s2,E=c+h,this.m_K.col1.Set(p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,g,0),this.m_K.col2.Set(g,E,0),g=this.m_K.Solve22(new i,-w,-b),y.x=g.x,y.y=g.y,y.z=0),g=y.x*this.m_perp.x+y.z*this.m_axis.x,p=y.x*this.m_perp.y+y.z*this.m_axis.y,w=y.x*this.m_s1+y.y+y.z*this.m_a1,y=y.x*this.m_s2+y.y+y.z*this.m_a2,u.x-=this.m_invMassA*g,u.y-=this.m_invMassA*p,a-=this.m_invIA*w,f.x+=this.m_invMassB*g,f.y+=this.m_invMassB*p,l+=this.m_invIB*y,n.m_sweep.a=a,o.m_sweep.a=l,n.SynchronizeTransform(),o.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef),E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,E.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},E.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},E.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u1=new i,this.m_u2=new i},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},S.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},S.prototype.GetReactionTorque=function(){return 0},S.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},S.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},S.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},S.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},S.prototype.GetRatio=function(){return this.m_ratio},S.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=r.Min(e.maxLengthA,this.m_constant-this.m_ratio*S.b2_minPulleyLength),this.m_maxLength2=r.Min(e.maxLengthB,(this.m_constant-S.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},S.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,i;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u,i=r.m_sweep.c.x+a,u=r.m_sweep.c.y+f;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(n.m_sweep.c.x+s-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),n.m_sweep.c.y+o-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(i-l,u-c),i=this.m_u1.Length(),u=this.m_u2.Length(),i>e.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),u>e.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),this.m_constant-i-this.m_ratio*u>0?(this.m_state=p.e_inactiveLimit,this.m_impulse=0):this.m_state=p.e_atUpperLimit,i<this.m_maxLength1?(this.m_limitState1=p.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=p.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=p.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=p.e_atUpperLimit,i=s*this.m_u1.y-o*this.m_u1.x,u=a*this.m_u2.y-f*this.m_u2.x,this.m_limitMass1=n.m_invMass+n.m_invI*i*i,this.m_limitMass2=r.m_invMass+r.m_invI*u*u,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,t=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,i=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*i,n.m_angularVelocity+=n.m_invI*(s*i-o*t),r.m_linearVelocity.x+=r.m_invMass*u,r.m_linearVelocity.y+=r.m_invMass*l,r.m_angularVelocity+=r.m_invI*(a*l-f*u)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},S.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=n.col1.x*i+n.col2.x*s;s=n.col1.y*i+n.col2.y*s,i=o,n=t.m_xf.R;var u=this.m_localAnchor2.x-t.m_sweep.localCenter.x,a=this.m_localAnchor2.y-t.m_sweep.localCenter.y;o=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=o;var f=o=n=0,l=0;n=l=n=l=f=o=n=0,this.m_state==p.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*i,f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u1.x*n+this.m_u1.y*o)-this.m_ratio*(this.m_u2.x*f+this.m_u2.y*l),l=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=r.Max(0,this.m_impulse+l),l=this.m_impulse-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,f=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(i*o-s*n),t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f)),this.m_limitState1==p.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*i,n=-(this.m_u1.x*n+this.m_u1.y*o),l=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(i*o-s*n)),this.m_limitState2==p.e_atUpperLimit&&(f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u2.x*f+this.m_u2.y*l),l=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-n,f=-l*this.m_u2.x,l=-l*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f))},S.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,i,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,f=0,l=0,c=0,h=0,d=i=0,v=0,m=0,g=d=m=i=d=i=0;return this.m_state==p.e_atUpperLimit&&(i=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,d=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=d,i=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,d=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=d,i=t.m_sweep.c.x+f,d=t.m_sweep.c.y+l,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u1.Set(i-s,d-o),this.m_u2.Set(v-u,m-a),i=this.m_u1.Length(),d=this.m_u2.Length(),i>e.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),d>e.b2_linearSlop?this.m_u2.Multiply(1/d):this.m_u2.SetZero(),i=this.m_constant-i-this.m_ratio*d,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_pulleyMass*i,i=-m*this.m_u1.x,d=-m*this.m_u1.y,v=-this.m_ratio*m*this.m_u2.x,m=-this.m_ratio*m*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*i,t.m_sweep.c.y+=t.m_invMass*d,t.m_sweep.a+=t.m_invI*(f*d-l*i),n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),t.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==p.e_atUpperLimit&&(i=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,d=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=d,i=t.m_sweep.c.x+f,d=t.m_sweep.c.y+l,this.m_u1.Set(i-s,d-o),i=this.m_u1.Length(),i>e.b2_linearSlop?(this.m_u1.x*=1/i,this.m_u1.y*=1/i):this.m_u1.SetZero(),i=this.m_maxLength1-i,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass1*i,i=-m*this.m_u1.x,d=-m*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*i,t.m_sweep.c.y+=t.m_invMass*d,t.m_sweep.a+=t.m_invI*(f*d-l*i),t.SynchronizeTransform()),this.m_limitState2==p.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,d=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=d,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u2.Set(v-u,m-a),d=this.m_u2.Length(),d>e.b2_linearSlop?(this.m_u2.x*=1/d,this.m_u2.y*=1/d):this.m_u2.SetZero(),i=this.m_maxLength2-d,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass2*i,v=-m*this.m_u2.x,m=-m*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),n.SynchronizeTransform()),g<e.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new i,this.groundAnchorB=new i,this.localAnchorA=new i,this.localAnchorB=new i},x.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},x.prototype.Initialize=function(e,t,n,r,i,s,o){o===undefined&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*S.b2_minPulleyLength,this.maxLengthB=(o-S.b2_minPulleyLength)/this.ratio},Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint),T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,T.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.K3=new t,this.impulse3=new s,this.impulse2=new i,this.reduced=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_impulse=new s,this.m_mass=new n},T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},T.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},T.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},T.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},T.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},T.prototype.IsLimitEnabled=function(){return this.m_enableLimit},T.prototype.EnableLimit=function(e){this.m_enableLimit=e},T.prototype.GetLowerLimit=function(){return this.m_lowerAngle},T.prototype.GetUpperLimit=function(){return this.m_upperAngle},T.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},T.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},T.prototype.EnableMotor=function(e){this.m_enableMotor=e},T.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},T.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},T.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},T.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit},T.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;s=n.m_xf.R;var u=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=s.col1.x*u+s.col2.x*a,a=s.col1.y*u+s.col2.y*a,u=o,s=i.m_xf.R;var f=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;o=s.col1.x*f+s.col2.x*l,l=s.col1.y*f+s.col2.y*l,f=o,s=n.m_invMass,o=i.m_invMass;var c=n.m_invI,h=i.m_invI;this.m_mass.col1.x=s+o+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=s+o+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,this.m_motorMass=1/(c+h),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var d=i.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop?this.m_limitState=p.e_equalLimits:d<=this.m_lowerAngle?(this.m_limitState!=p.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atLowerLimit):d>=this.m_upperAngle?(this.m_limitState!=p.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atUpperLimit):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=p.e_inactiveLimit;t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x,d=this.m_impulse.y,n.m_linearVelocity.x-=s*t,n.m_linearVelocity.y-=s*d,n.m_angularVelocity-=c*(u*d-a*t+this.m_motorImpulse+this.m_impulse.z),i.m_linearVelocity.x+=o*t,i.m_linearVelocity.y+=o*d,i.m_angularVelocity+=h*(f*d-l*t+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},T.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i=0,s=i=0,o=0,u=0,a=0,f=t.m_linearVelocity,l=t.m_angularVelocity,c=n.m_linearVelocity,h=n.m_angularVelocity,d=t.m_invMass,v=n.m_invMass,m=t.m_invI,g=n.m_invI;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(s=this.m_motorMass*-(h-l-this.m_motorSpeed),o=this.m_motorImpulse,u=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+s,-u,u),s=this.m_motorImpulse-o,l-=m*s,h+=g*s);if(this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=i,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=i,e=c.x+ -h*a-f.x- -l*o;var y=c.y+h*u-f.y-l*s;this.m_mass.Solve33(this.impulse3,-e,-y,-(h-l)),this.m_limitState==p.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==p.e_atLowerLimit?(i=this.m_impulse.z+this.impulse3.z,i<0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==p.e_atUpperLimit&&(i=this.m_impulse.z+this.impulse3.z,i>0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),f.x-=d*this.impulse3.x,f.y-=d*this.impulse3.y,l-=m*(s*this.impulse3.y-o*this.impulse3.x+this.impulse3.z),c.x+=v*this.impulse3.x,c.y+=v*this.impulse3.y,h+=g*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=i,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=i,this.m_mass.Solve22(this.impulse2,-(c.x+ -h*a-f.x- -l*o),-(c.y+h*u-f.y-l*s)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,f.x-=d*this.impulse2.x,f.y-=d*this.impulse2.y,l-=m*(s*this.impulse2.y-o*this.impulse2.x),c.x+=v*this.impulse2.x,c.y+=v*this.impulse2.y,h+=g*(u*this.impulse2.y-a*this.impulse2.x);t.m_linearVelocity.SetV(f),t.m_angularVelocity=l,n.m_linearVelocity.SetV(c),n.m_angularVelocity=h},T.prototype.SolvePositionConstraints=function(){var t=0,n,i=this.m_bodyA,s=this.m_bodyB,o=0,u=n=0,a=0,f=0;if(this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){t=s.m_sweep.a-i.m_sweep.a-this.m_referenceAngle;var l=0;this.m_limitState==p.e_equalLimits?(t=r.Clamp(t-this.m_lowerAngle,-e.b2_maxAngularCorrection,e.b2_maxAngularCorrection),l=-this.m_motorMass*t,o=r.Abs(t)):this.m_limitState==p.e_atLowerLimit?(t-=this.m_lowerAngle,o=-t,t=r.Clamp(t+e.b2_angularSlop,-e.b2_maxAngularCorrection,0),l=-this.m_motorMass*t):this.m_limitState==p.e_atUpperLimit&&(o=t-=this.m_upperAngle,t=r.Clamp(t-e.b2_angularSlop,0,e.b2_maxAngularCorrection),l=-this.m_motorMass*t),i.m_sweep.a-=i.m_invI*l,s.m_sweep.a+=s.m_invI*l,i.SynchronizeTransform(),s.SynchronizeTransform()}n=i.m_xf.R,l=this.m_localAnchor1.x-i.m_sweep.localCenter.x,t=this.m_localAnchor1.y-i.m_sweep.localCenter.y,u=n.col1.x*l+n.col2.x*t,t=n.col1.y*l+n.col2.y*t,l=u,n=s.m_xf.R;var c=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=u,a=s.m_sweep.c.x+c-i.m_sweep.c.x-l,f=s.m_sweep.c.y+h-i.m_sweep.c.y-t;var d=a*a+f*f;n=Math.sqrt(d),u=i.m_invMass;var v=s.m_invMass,m=i.m_invI,g=s.m_invI,y=10*e.b2_linearSlop;return d>y*y&&(d=1/(u+v),a=d*-a,f=d*-f,i.m_sweep.c.x-=.5*u*a,i.m_sweep.c.y-=.5*u*f,s.m_sweep.c.x+=.5*v*a,s.m_sweep.c.y+=.5*v*f,a=s.m_sweep.c.x+c-i.m_sweep.c.x-l,f=s.m_sweep.c.y+h-i.m_sweep.c.y-t),this.K1.col1.x=u+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=u+v,this.K2.col1.x=m*t*t,this.K2.col2.x=-m*l*t,this.K2.col1.y=-m*l*t,this.K2.col2.y=m*l*l,this.K3.col1.x=g*h*h,this.K3.col2.x=-g*c*h,this.K3.col1.y=-g*c*h,this.K3.col2.y=g*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(T.tImpulse,-a,-f),a=T.tImpulse.x,f=T.tImpulse.y,i.m_sweep.c.x-=i.m_invMass*a,i.m_sweep.c.y-=i.m_invMass*f,i.m_sweep.a-=i.m_invI*(l*f-t*a),s.m_sweep.c.x+=s.m_invMass*a,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(c*f-h*a),i.SynchronizeTransform(),s.SynchronizeTransform(),n<=e.b2_linearSlop&&o<=e.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new i}),Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef),N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,N.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},N.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},N.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_impulse=new s,this.m_mass=new n},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},C.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},C.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},C.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new n},C.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},C.prototype.SolveVelocityConstraints=function(){var e,t=0,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,o=n.m_angularVelocity,u=r.m_linearVelocity,a=r.m_angularVelocity,f=n.m_invMass,l=r.m_invMass,c=n.m_invI,h=r.m_invI;e=n.m_xf.R;var p=this.m_localAnchorA.x-n.m_sweep.localCenter.x,d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*p+e.col2.x*d,d=e.col1.y*p+e.col2.y*d,p=t,e=r.m_xf.R;var v=this.m_localAnchorB.x-r.m_sweep.localCenter.x,m=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*v+e.col2.x*m,m=e.col1.y*v+e.col2.y*m,v=t,e=u.x-a*m-i.x+o*d,t=u.y+a*v-i.y-o*p;var g=a-o,y=new s;this.m_mass.Solve33(y,-e,-t,-g),this.m_impulse.Add(y),i.x-=f*y.x,i.y-=f*y.y,o-=c*(p*y.y-d*y.x+y.z),u.x+=l*y.x,u.y+=l*y.y,a+=h*(v*y.y-m*y.x+y.z),n.m_angularVelocity=o,r.m_angularVelocity=a},C.prototype.SolvePositionConstraints=function(){var t,n=0,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=o.m_xf.R;var f=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=n,t=i.m_invMass,n=o.m_invMass;var c=i.m_invI,h=o.m_invI,p=o.m_sweep.c.x+f-i.m_sweep.c.x-u,d=o.m_sweep.c.y+l-i.m_sweep.c.y-a,v=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,m=10*e.b2_linearSlop,g=Math.sqrt(p*p+d*d),y=r.Abs(v);return g>m&&(c*=1,h*=1),this.m_mass.col1.x=t+n+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,m=new s,this.m_mass.Solve33(m,-p,-d,-v),i.m_sweep.c.x-=t*m.x,i.m_sweep.c.y-=t*m.y,i.m_sweep.a-=c*(u*m.y-a*m.x+m.z),o.m_sweep.c.x+=n*m.x,o.m_sweep.c.y+=n*m.y,o.m_sweep.a+=h*(f*m.y-l*m.x+m.z),i.SynchronizeTransform(),o.SynchronizeTransform(),g<=e.b2_linearSlop&&y<=e.b2_angularSlop},Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef),k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,k.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},k.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_weldJoint,this.referenceAngle=0},k.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var e=Box2D.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},e.prototype.b2DebugDraw=function(){this.m_drawFlags=0},e.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},e.prototype.GetFlags=function(){return this.m_drawFlags},e.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},e.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},e.prototype.SetSprite=function(e){this.m_ctx=e},e.prototype.GetSprite=function(){return this.m_ctx},e.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},e.prototype.GetDrawScale=function(){return this.m_drawScale},e.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},e.prototype.GetLineThickness=function(){return this.m_lineThickness},e.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},e.prototype.GetAlpha=function(){return this.m_alpha},e.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},e.prototype.GetFillAlpha=function(){return this.m_fillAlpha},e.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},e.prototype.GetXFormScale=function(){return this.m_xformScale},e.prototype.DrawPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()}},e.prototype.DrawSolidPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()}},e.prototype.DrawCircle=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()}},e.prototype.DrawSolidCircle=function(e,t,n,r){if(t){var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()}},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),t.closePath(),t.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,define("Box2d",function(){}),define("box2dCore",["underscore","Box2d"],function(e){var t={b2Vec2:Box2D.Common.Math.b2Vec2,b2BodyDef:Box2D.Dynamics.b2BodyDef,b2Body:Box2D.Dynamics.b2Body,b2FixtureDef:Box2D.Dynamics.b2FixtureDef,b2Fixture:Box2D.Dynamics.b2Fixture,b2World:Box2D.Dynamics.b2World,b2MassData:Box2D.Collision.Shapes.b2MassData,b2PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape:Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw:Box2D.Dynamics.b2DebugDraw},n=window.Physics=function(n,r){var i=this,s=new t.b2Vec2(0,1);this.world=new t.b2World(s,!0),this.element=n,this.context=n.getContext("2d"),this.scale=r||30,this.dtRemaining=0,this.stepAmount=1/60,this.dragNDropCalled=!1,this.running=!0,this.screenboundaryThickness=0;var o=[];this.storeBodyForDestruction=function(e){o.push(e.body)},this.destroyBodies=function(){e.each(o,function(e){i.world.DestroyBody(e)}),o=[]}};n.prototype.destroyBody=function(e){this.storeBodyForDestruction(e)},n.prototype.screenBoundaries=function(e){var e=e||{},t=e.color||"transparent",n=this.screenboundaryThickness=e.wallThickness||7.5,i=this.element.width,s=this.element.height;new r(this,{type:"static",x:2*n/this.scale*.5,y:s/this.scale*.5,height:s/this.scale,width:2*n/this.scale,color:t,id:"boundary"}),new r(this,{type:"static",x:(i-n)/this.scale,y:s/this.scale*.5,height:s/this.scale,width:2*n/this.scale,color:t,id:"boundary"}),new r(this,{type:"static",x:i/this.scale*.5,y:2*n/this.scale*.5,height:2*n/this.scale,width:i/this.scale,color:t,id:"boundary"}),new r(this,{type:"static",x:i/this.scale*.5,y:(s-n)/this.scale,height:2*n/this.scale,width:i/this.scale,color:t,id:"boundary"})},n.prototype.animate=function(){var e=this,t=(new Date).getTime(),n=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||function(e){window.setTimeout(e,1e3/60)}},r=function(){var i=(new Date).getTime();n(r);var s=(i-t)/1e3;s>1/15&&(s=1/15),e.step(s),t=i};n(r)},n.prototype.step=function(e){if(!this.running)return;this.dtRemaining+=e;while(this.dtRemaining>this.stepAmount)this.dtRemaining-=this.stepAmount,this.world.Step(this.stepAmount,8,3);this.context.clearRect(0,0,this.element.width,this.element.height),$(window).trigger("step"),this.destroyBodies();var t=this.world.GetBodyList();this.context.save(),this.context.scale(this.scale,this.scale);while(t){var n=t.GetUserData();n&&n.draw(this.context),t=t.GetNext()}this.context.restore(),this.debugDraw&&this.world.DrawDebugData()},n.prototype.debug=function(){this.debugCanvas=document.createElement("canvas"),this.debugCanvas.width=this.element.width,this.debugCanvas.height=this.element.height;var e=this.element.parentNode;e.insertBefore(this.debugCanvas,e.childNodes[0]),this.debugCanvas.style.position="absolute",this.debugContext=this.debugCanvas.getContext("2d"),this.debugDraw=new t.b2DebugDraw,this.debugDraw.SetSprite(this.debugContext),this.debugDraw.SetDrawScale(this.scale),this.debugDraw.SetFillAlpha(.5),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(t.b2DebugDraw.e_shapeBit|t.b2DebugDraw.e_jointBit),this.world.SetDebugDraw(this.debugDraw),this.clickCallBack!==undefined&&this.click(this.clickCallBack),this.dragNDropCalled===!0&&this.dragNDrop()},n.prototype.click=function(e){function n(n){n.preventDefault();var r={x:(n.offsetX||n.layerX)/t.scale,y:(n.offsetY||n.layerY)/t.scale};t.world.QueryPoint(function(t){e(t.GetBody(),t,r)},r)}var t=this;this.clickCallBack=e,this.debugDraw?(this.debugCanvas.addEventListener("mousedown",n),this.debugCanvas.addEventListener("touchstart",n)):(this.element.addEventListener("mousedown",n),this.element.addEventListener("touchstart",n))},n.prototype.collision=function(){this.listener=new Box2D.Dynamics.b2ContactListener,this.listener.PostSolve=function(e,t){var n=e.GetFixtureA().GetBody().GetUserData(),r=e.GetFixtureB().GetBody().GetUserData();n.contact&&n.contact(e,t,r),r.contact&&r.contact(e,t,n)},this.world.SetContactListener(this.listener)},n.prototype.dragNDrop=function(){function i(t){return point={x:(t.offsetX||t.layerX)/e.scale,y:(t.offsetY||t.layerY)/e.scale}}var e=this,n=null,r=null;this.dragNDropCalled=!0;var s=this.element;this.debugDraw&&(s=this.debugCanvas),s.addEventListener("mousedown",function(t){t.preventDefault();var r=i(t);e.world.QueryPoint(function(e){n=e.GetBody().GetUserData()},r)}),s.addEventListener("mousemove",function(s){if(!n)return;if(n.details.draggable!==undefined&&!n.details.draggable)return;var o=i(s);if(!r){var u=new Box2D.Dynamics.Joints.b2MouseJointDef;u.bodyA=e.world.GetGroundBody(),u.bodyB=n.body,u.target.Set(o.x,o.y),u.maxForce=1e5,u.timeStep=e.stepAmount,r=e.world.CreateJoint(u)}r.SetTarget(new t.b2Vec2(o.x,o.y))}),s.addEventListener("mouseup",function(t){n=null,r&&(e.world.DestroyJoint(r),r=null)})},n.prototype.distanceJoint=function(e,t){var n=e.body,r=t.body,i=new Box2D.Dynamics.Joints.b2DistanceJointDef;return i.Initialize(n,r,n.GetWorldCenter(),r.GetWorldCenter()),this.world.CreateJoint(i)},n.prototype.revoluteJoint=function(e,n,r,i){var s=e.body,o=n.body,u=new Box2D.Dynamics.Joints.b2RevoluteJointDef,i=i||{};return i!==undefined&&(u.enableLimit=i.enableLimit,i.lowerAngle!==undefined&&(u.lowerAngle=i.lowerAngle*Math.PI/180),i.upperAngle!==undefined&&(u.upperAngle=i.upperAngle*Math.PI/180),i.motorSpeed!==undefined&&(u.motorSpeed=i.motorSpeed),i.enableMotor!==undefined&&(u.enableMotor=i.enableMotor),i.maxMotorTorque!==undefined&&(u.maxMotorTorque=i.maxMotorTorque)),u.Initialize(s,o,new t.b2Vec2(r.x,r.y)),this.world.CreateJoint(u)},n.prototype.prismaticJoint=function(e,n,r,i,s,o){var u=e.body,a=n.body,f=new Box2D.Dynamics.Joints.Box2d.b2PrismaticJointDef;return f.Initialize(u,a,new t.b2Vec2(r.x,r.y),new t.b2Vec2(r.x,r.y)),s!==undefined&&o!==undefined&&(f.enableLimit=!0,f.lowerTranslation=s,f.upperTranslation=o,console.log(f)),this.world.CreateJoint(f)};var r=window.Body=function(e,n){this.physics=e,this.details=n=n||{},this.definition=new t.b2BodyDef;for(var r in this.definitionDefaults)this.definition[r]=n[r]||this.definitionDefaults[r];this.id=n.id||"",this.x=n.x||0,this.y=n.y||0,this.details.animation&&(n.x||(this.x=this.details.animation.x/e.scale+n.width/2),n.y||(this.y=this.details.animation.y/e.scale+n.height/2),n.shape||(n.shape="block")),this.definition.position=new t.b2Vec2(this.x,this.y),this.definition.linearVelocity=new t.b2Vec2(n.vx||0,n.vy||0),this.definition.userData=this,n.type=="static"?this.definition.type=t.b2Body.b2_staticBody:n.type=="kinematic"?this.definition.type=t.b2Body.b2_kinematicBody:this.definition.type=t.b2Body.b2_dynamicBody,this.body=e.world.CreateBody(this.definition),this.fixtureDef=new t.b2FixtureDef;for(var i in this.fixtureDefaults)this.fixtureDef[i]=n[i]||this.fixtureDefaults[i];n.shape=n.shape||this.defaults.shape;switch(n.shape){case"circle":n.radius=n.radius||this.defaults.radius,this.fixtureDef.shape=new t.b2CircleShape(n.radius);break;case"polygon":this.fixtureDef.shape=new t.b2PolygonShape,this.fixtureDef.shape.SetAsArray(n.points,n.points.length);break;case"block":default:n.width=n.width||this.defaults.width,n.height=n.height||this.defaults.height,this.fixtureDef.shape=new t.b2PolygonShape,this.fixtureDef.shape.SetAsBox(n.width/2,n.height/2)}this.body.CreateFixture(this.fixtureDef)};return r.prototype.defaults={shape:"block",width:2.5,height:2.5,radius:1.25},r.prototype.fixtureDefaults={density:2,friction:1,restitution:.2},r.prototype.definitionDefaults={active:!0,allowSleep:!0,angle:0,angularVelocity:0,awake:!0,bullet:!1,fixedRotation:!1},r.prototype.draw=function(e){var t=this.body.GetPosition(),n=this.body.GetAngle();e.save(),e.translate(t.x,t.y),e.rotate(n);if(this.details.color){e.fillStyle=this.details.color;switch(this.details.shape){case"circle":e.beginPath(),e.arc(0,0,this.details.radius,0,Math.PI*2),e.fill();break;case"polygon":var r=this.details.points;e.beginPath(),e.moveTo(r[0].x,r[0].y);for(var i=1;i<r.length;i++)e.lineTo(r[i].x,r[i].y);e.fill();break;case"block":e.fillRect(-this.details.width/2,-this.details.height/2,this.details.width,this.details.height);default:}}if(this.details.image){if(typeof this.details.image=="string"){var s=document.createElement("img");s.src=this.details.image,this.details.image=s}e.drawImage(this.details.image,-this.details.width/2,-this.details.height/2,this.details.width,this.details.height)}this.details.animation&&(this.details.animation.x=(t.x-this.details.width/2)*this.physics.scale,this.details.animation.y=(t.y-this.details.height/2)*this.physics.scale),e.restore()},t}),function(){var e={},t=null,n=!0,r=!1;try{typeof AudioContext!="undefined"?t=new AudioContext:typeof webkitAudioContext!="undefined"?t=new webkitAudioContext:n=!1}catch(i){n=!1}if(!n)if(typeof Audio!="undefined")try{new Audio}catch(i){r=!0}else r=!0;if(n){var s=typeof t.createGain=="undefined"?t.createGainNode():t.createGain();s.gain.value=1,s.connect(t.destination)}var o=function(e){this._volume=1,this._muted=!1,this.usingWebAudio=n,this.ctx=t,this.noAudio=r,this._howls=[],this._codecs=e,this.iOSAutoEnable=!0};o.prototype={volume:function(e){var t=this;e=parseFloat(e);if(e>=0&&e<=1){t._volume=e,n&&(s.gain.value=e);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].volume=t._howls[r]._volume*t._volume;return t}return n?s.gain.value:t._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var t=this;t._muted=e,n&&(s.gain.value=e?0:t._volume);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].muted=e},codecs:function(e){return this._codecs[e]},_enableiOSAudio:function(){var e=this;if(t&&(e._iOSEnabled||!/iPhone|iPad|iPod/i.test(navigator.userAgent)))return;e._iOSEnabled=!1;var n=function(){var r=t.createBuffer(1,1,22050),i=t.createBufferSource();i.buffer=r,i.connect(t.destination),typeof i.start=="undefined"?i.noteOn(0):i.start(0),setTimeout(function(){if(i.playbackState===i.PLAYING_STATE||i.playbackState===i.FINISHED_STATE)e._iOSEnabled=!0,e.iOSAutoEnable=!1,window.removeEventListener("touchend",n,!1)},0)};return window.addEventListener("touchend",n,!1),e}};var u=null,a={};r||(u=new Audio,a={mp3:!!u.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!u.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var f=new o(a),l=function(e){var r=this;r._autoplay=e.autoplay||!1,r._buffer=e.buffer||!1,r._duration=e.duration||0,r._format=e.format||null,r._loop=e.loop||!1,r._loaded=!1,r._sprite=e.sprite||{},r._src=e.src||"",r._pos3d=e.pos3d||[0,0,-0.5],r._volume=e.volume!==undefined?e.volume:1,r._urls=e.urls||[],r._rate=e.rate||1,r._model=e.model||null,r._onload=[e.onload||function(){}],r._onloaderror=[e.onloaderror||function(){}],r._onend=[e.onend||function(){}],r._onpause=[e.onpause||function(){}],r._onplay=[e.onplay||function(){}],r._onendTimer=[],r._webAudio=n&&!r._buffer,r._audioNode=[],r._webAudio&&r._setupAudioNode(),typeof t!="undefined"&&t&&f.iOSAutoEnable&&f._enableiOSAudio(),f._howls.push(r),r.load()};l.prototype={load:function(){var e=this,t=null;if(r){e.on("loaderror",new Error("No audio support."));return}for(var n=0;n<e._urls.length;n++){var i,s;if(e._format)i=e._format;else{s=e._urls[n],i=/^data:audio\/([^;,]+);/i.exec(s),i||(i=/\.([^.]+)$/.exec(s.split("?",1)[0]));if(!i){e.on("loaderror",new Error("Could not extract format from passed URLs, please add format parameter."));return}i=i[1].toLowerCase()}if(a[i]){t=e._urls[n];break}}if(!t){e.on("loaderror",new Error("No codec support for selected audio sources."));return}e._src=t;if(e._webAudio)c(e,t);else{var u=new Audio;u.addEventListener("error",function(){u.error&&u.error.code===4&&(o.noAudio=!0),e.on("loaderror",{type:u.error?u.error.code:0})},!1),e._audioNode.push(u),u.src=t,u._pos=0,u.preload="auto",u.volume=f._muted?0:e._volume*f.volume();var l=function(){e._duration=Math.ceil(u.duration*10)/10,Object.getOwnPropertyNames(e._sprite).length===0&&(e._sprite={_default:[0,e._duration*1e3]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play(),u.removeEventListener("canplaythrough",l,!1)};u.addEventListener("canplaythrough",l,!1),u.load()}return e},urls:function(e){var t=this;return e?(t.stop(),t._urls=typeof e=="string"?[e]:e,t._loaded=!1,t.load(),t):t._urls},play:function(e,n){var r=this;typeof e=="function"&&(n=e);if(!e||typeof e=="function")e="_default";return r._loaded?r._sprite[e]?(r._inactiveNode(function(i){i._sprite=e;var s=i._pos>0?i._pos:r._sprite[e][0]/1e3,o=0;r._webAudio?(o=r._sprite[e][1]/1e3-i._pos,i._pos>0&&(s=r._sprite[e][0]/1e3+s)):o=r._sprite[e][1]/1e3-(s-r._sprite[e][0]/1e3);var u=!!r._loop||!!r._sprite[e][2],a=typeof n=="string"?n:Math.round(Date.now()*Math.random())+"",l;(function(){var t={id:a,sprite:e,loop:u};l=setTimeout(function(){!r._webAudio&&u&&r.stop(t.id).play(e,t.id),r._webAudio&&!u&&(r._nodeById(t.id).paused=!0,r._nodeById(t.id)._pos=0,r._clearEndTimer(t.id)),!r._webAudio&&!u&&r.stop(t.id),r.on("end",a)},o/r._rate*1e3),r._onendTimer.push({timer:l,id:t.id})})();if(r._webAudio){var c=r._sprite[e][0]/1e3,h=r._sprite[e][1]/1e3;i.id=a,i.paused=!1,d(r,[u,c,h],a),r._playStart=t.currentTime,i.gain.value=r._volume,typeof i.bufferSource.start=="undefined"?u?i.bufferSource.noteGrainOn(0,s,86400):i.bufferSource.noteGrainOn(0,s,o):u?i.bufferSource.start(0,s,86400):i.bufferSource.start(0,s,o)}else{if(!(i.readyState===4||!i.readyState&&navigator.isCocoonJS))return r._clearEndTimer(a),function(){var t=r,s=e,o=n,u=i,a=function(){t.play(s,o),u.removeEventListener("canplaythrough",a,!1)};u.addEventListener("canplaythrough",a,!1)}(),r;i.readyState=4,i.id=a,i.currentTime=s,i.muted=f._muted||i.muted,i.volume=r._volume*f.volume(),setTimeout(function(){i.play()},0)}return r.on("play"),typeof n=="function"&&n(a),r}),r):(typeof n=="function"&&n(),r):(r.on("load",function(){r.play(e,n)}),r)},pause:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.pause(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n){n._pos=t.pos(null,e);if(t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,typeof n.bufferSource.stop=="undefined"?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause()}return t.on("pause"),t},stop:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.stop(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n){n._pos=0;if(t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,typeof n.bufferSource.stop=="undefined"?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else isNaN(n.duration)||(n.pause(),n.currentTime=0)}return t},mute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.mute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=0:n.muted=!0),t},unmute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.unmute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=t._volume:n.muted=!1),t},volume:function(e,t){var n=this;e=parseFloat(e);if(e>=0&&e<=1){n._volume=e;if(!n._loaded)return n.on("play",function(){n.volume(e,t)}),n;var r=t?n._nodeById(t):n._activeNode();return r&&(n._webAudio?r.gain.value=e:r.volume=e*f.volume()),n}return n._volume},loop:function(e){var t=this;return typeof e=="boolean"?(t._loop=e,t):t._loop},sprite:function(e){var t=this;return typeof e=="object"?(t._sprite=e,t):t._sprite},pos:function(e,n){var r=this;if(!r._loaded)return r.on("load",function(){r.pos(e)}),typeof e=="number"?r:r._pos||0;e=parseFloat(e);var i=n?r._nodeById(n):r._activeNode();if(i)return e>=0?(r.pause(n),i._pos=e,r.play(i._sprite,n),r):r._webAudio?i._pos+(t.currentTime-r._playStart):i.currentTime;if(e>=0)return r;for(var s=0;s<r._audioNode.length;s++)if(r._audioNode[s].paused&&r._audioNode[s].readyState===4)return r._webAudio?r._audioNode[s]._pos:r._audioNode[s].currentTime},pos3d:function(e,t,n,r){var i=this;t=typeof t=="undefined"||!t?0:t,n=typeof n=="undefined"||!n?-0.5:n;if(!i._loaded)return i.on("play",function(){i.pos3d(e,t,n,r)}),i;if(e>=0||e<0){if(i._webAudio){var s=r?i._nodeById(r):i._activeNode();s&&(i._pos3d=[e,t,n],s.panner.setPosition(e,t,n),s.panner.panningModel=i._model||"HRTF")}return i}return i._pos3d},fade:function(e,t,n,r,i){var s=this,o=Math.abs(e-t),u=e>t?"down":"up",a=o/.01,f=n/a;if(!s._loaded)return s.on("load",function(){s.fade(e,t,n,r,i)}),s;s.volume(e,i);for(var l=1;l<=a;l++)(function(){var e=s._volume+(u==="up"?.01:-0.01)*l,n=Math.round(1e3*e)/1e3,o=t;setTimeout(function(){s.volume(n,i),n===o&&r&&r()},f*l)})()},fadeIn:function(e,t,n){return this.volume(0).play().fade(0,e,t,n)},fadeOut:function(e,t,n,r){var i=this;return i.fade(i._volume,e,t,function(){n&&n(),i.pause(r),i.on("end")},r)},_nodeById:function(e){var t=this,n=t._audioNode[0];for(var r=0;r<t._audioNode.length;r++)if(t._audioNode[r].id===e){n=t._audioNode[r];break}return n},_activeNode:function(){var e=this,t=null;for(var n=0;n<e._audioNode.length;n++)if(!e._audioNode[n].paused){t=e._audioNode[n];break}return e._drainPool(),t},_inactiveNode:function(e){var t=this,n=null;for(var r=0;r<t._audioNode.length;r++)if(t._audioNode[r].paused&&t._audioNode[r].readyState===4){e(t._audioNode[r]),n=!0;break}t._drainPool();if(n)return;var i;if(t._webAudio)i=t._setupAudioNode(),e(i);else{t.load(),i=t._audioNode[t._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",o=function(){i.removeEventListener(s,o,!1),e(i)};i.addEventListener(s,o,!1)}},_drainPool:function(){var e=this,t=0,n;for(n=0;n<e._audioNode.length;n++)e._audioNode[n].paused&&t++;for(n=e._audioNode.length-1;n>=0;n--){if(t<=5)break;e._audioNode[n].paused&&(e._webAudio&&e._audioNode[n].disconnect(0),t--,e._audioNode.splice(n,1))}},_clearEndTimer:function(e){var t=this,n=-1;for(var r=0;r<t._onendTimer.length;r++)if(t._onendTimer[r].id===e){n=r;break}var i=t._onendTimer[n];i&&(clearTimeout(i.timer),t._onendTimer.splice(n,1))},_setupAudioNode:function(){var e=this,n=e._audioNode,r=e._audioNode.length;return n[r]=typeof t.createGain=="undefined"?t.createGainNode():t.createGain(),n[r].gain.value=e._volume,n[r].paused=!0,n[r]._pos=0,n[r].readyState=4,n[r].connect(s),n[r].panner=t.createPanner(),n[r].panner.panningModel=e._model||"equalpower",n[r].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),n[r].panner.connect(n[r]),n[r]},on:function(e,t){var n=this,r=n["_on"+e];if(typeof t=="function")r.push(t);else for(var i=0;i<r.length;i++)t?r[i].call(n,t):r[i].call(n);return n},off:function(e,t){var n=this,r=n["_on"+e];if(t){for(var i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);break}}else n["_on"+e]=[];return n},unload:function(){var t=this,n=t._audioNode;for(var r=0;r<t._audioNode.length;r++)n[r].paused||(t.stop(n[r].id),t.on("end",n[r].id)),t._webAudio?n[r].disconnect(0):n[r].src="";for(r=0;r<t._onendTimer.length;r++)clearTimeout(t._onendTimer[r].timer);var i=f._howls.indexOf(t);i!==null&&i>=0&&f._howls.splice(i,1),delete e[t._src],t=null}};if(n)var c=function(t,n){if(n in e){t._duration=e[n].duration,p(t);return}if(/^data:[^;]+;base64,/.test(n)){var r=atob(n.split(",")[1]),i=new Uint8Array(r.length);for(var s=0;s<r.length;++s)i[s]=r.charCodeAt(s);h(i.buffer,t,n)}else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){h(o.response,t,n)},o.onerror=function(){t._webAudio&&(t._buffer=!0,t._webAudio=!1,t._audioNode=[],delete t._gainNode,delete e[n],t.load())};try{o.send()}catch(u){o.onerror()}}},h=function(n,r,i){t.decodeAudioData(n,function(t){t&&(e[i]=t,p(r,t))},function(e){r.on("loaderror",e)})},p=function(e,t){e._duration=t?t.duration:e._duration,Object.getOwnPropertyNames(e._sprite).length===0&&(e._sprite={_default:[0,e._duration*1e3]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},d=function(n,r,i){var s=n._nodeById(i);s.bufferSource=t.createBufferSource(),s.bufferSource.buffer=e[n._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=r[0],r[0]&&(s.bufferSource.loopStart=r[1],s.bufferSource.loopEnd=r[1]+r[2]),s.bufferSource.playbackRate.value=n._rate};typeof define=="function"&&define.amd&&define("howler",[],function(){return{Howler:f,Howl:l}}),typeof exports!="undefined"&&(exports.Howler=f,exports.Howl=l),typeof window!="undefined"&&(window.Howler=f,window.Howl=l)}(),!function(){"use strict";var Faye={VERSION:"1.1.1",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,n){if(!t)return e;for(var r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)&&n===!1||e[r]!==t[r]&&(e[r]=t[r]));return e},random:function(e){e=e||this.ID_LENGTH;for(var t=Math.ceil(e*Math.log(2)/Math.log(36)),n=csprng(e,36);n.length<t;)n="0"+n;return n},validateOptions:function(e,t){for(var n in e)if(this.indexOf(t,n)<0)throw Error("Unrecognized option: "+n)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,n,r;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(r in e)t[r]=Faye.copyObject(e[r]);return t}return e},commonElement:function(e,t){for(var n=0,r=e.length;r>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var r=[];if(e instanceof Array)for(var i=0,s=e.length;s>i;i++)r.push(t.call(n||null,e[i],i));else for(var o in e)e.hasOwnProperty(o)&&r.push(t.call(n||null,o,e[o]));return r},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var r=[],i=0,s=e.length;s>i;i++)t.call(n||null,e[i],i)&&r.push(e[i]);return r},asyncEach:function(e,t,n,r){var i=e.length,s=-1,o=0,u=!1,a=function(){return o-=1,s+=1,s===i?n&&n.call(r):void t(e[s],l)},f=function(){if(!u){for(u=!0;o>0;)a();u=!1}},l=function(){o+=1,f()};l()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},r=function(){};return r.prototype=e.prototype,n.prototype=new r,Faye.extend(n.prototype,t),n},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}var t=Faye.EventEmitter=function(){},n="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||n(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var r=Array.prototype.slice.call(arguments,1);t.apply(this,r)}return!0}if(n(t)){for(var r=Array.prototype.slice.call(arguments,1),i=t.slice(),s=0,o=i.length;o>s;s++)i[s].apply(this,r);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;return n.on(e,function r(){n.removeListener(e,r),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,r){if("function"!=typeof r)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(n(i)){var s=e(i,r);if(0>s)return this;i.splice(s,1),0==i.length&&delete this._events[t]}else this._events[t]===r&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var n=0,r=1,i=2,s=function(e){return e},o=function(e){throw e},u=function(e){if(this._state=n,this._onFulfilled=[],this._onRejected=[],"function"==typeof e){var t=this;e(function(e){h(t,e)},function(e){d(t,e)})}};u.prototype.then=function(e,t){var n=new u;return a(this,e,n),f(this,t,n),n};var a=function(e,t,i){"function"!=typeof t&&(t=s);var o=function(e){l(t,e,i)};e._state===n?e._onFulfilled.push(o):e._state===r&&o(e._value)},f=function(e,t,r){"function"!=typeof t&&(t=o);var s=function(e){l(t,e,r)};e._state===n?e._onRejected.push(s):e._state===i&&s(e._reason)},l=function(t,n,r){e(function(){c(t,n,r)})},c=function(e,t,n){var r;try{r=e(t)}catch(i){return d(n,i)}r===n?d(n,new TypeError("Recursive promise chain detected")):h(n,r)},h=u.fulfill=u.resolve=function(e,t){var n,r,i=!1;try{if(n=typeof t,r=null!==t&&("function"===n||"object"===n)&&t.then,"function"!=typeof r)return p(e,t);r.call(t,function(t){i^(i=!0)&&h(e,t)},function(t){i^(i=!0)&&d(e,t)})}catch(s){if(!(i^(i=!0)))return;d(e,s)}},p=function(e,t){if(e._state===n){e._state=r,e._value=t,e._onRejected=[];for(var i,s=e._onFulfilled;i=s.shift();)i(t)}},d=u.reject=function(e,t){if(e._state===n){e._state=i,e._reason=t,e._onFulfilled=[];for(var r,s=e._onRejected;r=s.shift();)r(t)}};u.all=function(e){return new u(function(t,n){var r,i=[],s=e.length;if(0===s)return t(i);for(r=0;s>r;r++)(function(e,r){u.fulfilled(e).then(function(e){i[r]=e,0===--s&&t(i)},n)})(e[r],r)})},u.defer=e,u.deferred=u.pending=function(){var e={};return e.promise=new u(function(t,n){e.fulfill=e.resolve=t,e.reject=n}),e},u.fulfilled=u.resolved=function(e){return new u(function(t){t(e)})},u.rejected=function(e){return new u(function(t,n){n(e)})},void 0===Faye?module.exports=u:Faye.Promise=u}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return this._index.hasOwnProperty(t)?!1:(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,n,r,i,s,o,u={},a=function(t,n){e=e.replace(n,function(e){return u[t]=e,""}),u[t]=u[t]||""};for(a("protocol",/^[a-z]+\:/i),a("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||u.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),a("pathname",/^[^\?#]*/),a("search",/^\?[^#]*/),a("hash",/^#.*/),u.protocol=u.protocol||Faye.ENV.location.protocol,u.host?(u.host=u.host.substr(2),t=u.host.split(":"),u.hostname=t[0],u.port=t[1]||""):(u.host=Faye.ENV.location.host,u.hostname=Faye.ENV.location.hostname,u.port=Faye.ENV.location.port),u.pathname=u.pathname||"/",u.path=u.pathname+u.search,n=u.search.replace(/^\?/,""),r=n?n.split("&"):[],o={},i=0,s=r.length;s>i;i++)t=r[i].split("="),o[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return u.query=o,u.href=this.stringify(u),u},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),r=t[1].split(","),e=t[2];return new this(n,r,e)},Faye.Error.versionMismatch=function(){return""+new this(300,arguments,"Version mismatch")},Faye.Error.conntypeMismatch=function(){return""+new this(301,arguments,"Connection types not supported")},Faye.Error.extMismatch=function(){return""+new this(302,arguments,"Extension mismatch")},Faye.Error.badRequest=function(){return""+new this(400,arguments,"Bad request")},Faye.Error.clientUnknown=function(){return""+new this(401,arguments,"Unknown client")},Faye.Error.parameterMissing=function(){return""+new this(402,arguments,"Missing required parameter")},Faye.Error.channelForbidden=function(){return""+new this(403,arguments,"Forbidden channel")},Faye.Error.channelUnknown=function(){return""+new this(404,arguments,"Unknown channel")},Faye.Error.channelInvalid=function(){return""+new this(405,arguments,"Invalid channel")},Faye.Error.extUnknown=function(){return""+new this(406,arguments,"Unknown extension")},Faye.Error.publishFailed=function(){return""+new this(407,arguments,"Failed to publish")},Faye.Error.serverError=function(){return""+new this(500,arguments,"Internal server error")},Faye.Deferrable={then:function(e,t){var n=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){n._fulfill=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var n=this;this._timer=Faye.ENV.setTimeout(function(){n._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer),this.then(),"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var r=Array.prototype.slice,i=function(){t.apply(n,r.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,i]),this.on(e,i)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var r,i=this._listeners.length;i--;)r=this._listeners[i],r[0]===e&&(!t||r[1]===t&&r[2]===n)&&(this._listeners.splice(i,1),this.removeListener(e,r[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,n,r){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var i=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete i._timeouts[e],n.call(r)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(Faye.ENV.clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var n=Array.prototype.slice.apply(e),r="[Faye",i=this.className,s=n.shift().replace(/\?/g,function(){try{return Faye.toJSON(n.shift())}catch(e){return"[Object]"}});for(var o in Faye)i||"function"==typeof Faye[o]&&this instanceof Faye[o]&&(i=o);i&&(r+="."+i),r+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](r+s):"function"==typeof Faye.logger&&Faye.logger(r+s)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}})(e)}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,r,i){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return r.call(i,t);var s=this._extensions.slice(),o=function(t){if(!t)return r.call(i,t);var u=s.shift();if(!u)return r.call(i,t);var a=u[e];return a?void (a.length>=3?u[e](t,n,o):u[e](t,o)):o(t)};o(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],r=t.slice();r[r.length-1]="*",n.push(this.unparse(r));for(var i=1,s=t.length;s>i;i++)r=t.slice(0,i),r.push("**"),n.push(this.unparse(r));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){for(var r,i=0,s=e.length;s>i;i++){r=e[i];var o=this._channels[r]=this._channels[r]||new Faye.Channel(r);t&&o.bind("message",t,n)}},unsubscribe:function(e,t,n){var r=this._channels[e];return r?(r.unbind("message",t,n),r.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,r=t.length;r>n;n++){var i=this._channels[t[n]];i&&i.trigger("message",e.data)}}})}),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,r){this._client=e,this._channels=t,this._callback=n,this._context=r,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),t=t||{},Faye.validateOptions(t,["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._endpoint=e||this.DEFAULT_ENDPOINT,this._channels=new Faye.Channel.Set,this._dispatcher=new Faye.Dispatcher(this,this._endpoint,t),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(t.interval||this.INTERVAL),timeout:1e3*(t.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(e){return this._dispatcher.addWebsocketExtension(e)},disable:function(e){return this._dispatcher.disable(e)},setHeader:function(e,t){return this._dispatcher.setHeader(e,t)},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this._endpoint)),this._dispatcher.selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(r){r.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=r.clientId,this._dispatcher.selectTransport(r.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:Faye.Channel.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new Faye.Publication;return this._sendMessage({channel:Faye.Channel.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",Faye.Error.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new Faye.Channel.Set,e}},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var r=new Faye.Subscription(this,e,t,n),i=t===!0,s=this._channels.hasSubscription(e);return s&&!i?(this._channels.subscribe([e],t,n),r.setDeferredStatus("succeeded"),r):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,e),i||this._channels.subscribe([e],t,n),this._sendMessage({channel:Faye.Channel.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(i){if(!i.successful)return r.setDeferredStatus("failed",Faye.Error.parse(i.error)),this._channels.unsubscribe(e,t,n);var s=[].concat(i.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,s),r.setDeferredStatus("succeeded")},this)},this),r)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);var r=this._channels.unsubscribe(e,t,n);r&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,e),this._sendMessage({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,t)}},this)},this)},publish:function(e,t,n){Faye.validateOptions(n||{},["attempts","deadline"]);var r=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,e,t),this._sendMessage({channel:e,data:t,clientId:this._dispatcher.clientId},n,function(e){e.successful?r.setDeferredStatus("succeeded"):r.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),r},_sendMessage:function(e,t,n,r){e.id=this._generateMessageId();var i=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(n&&(this._responseCallbacks[e.id]=[n,r]),this._dispatcher.sendMessage(e,i,t||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Dispatcher=Faye.Class({MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(e,t,n){this._client=e,this.endpoint=Faye.URI.parse(t),this._alternates=n.endpoints||{},this.cookies=Faye.Cookies&&new Faye.Cookies.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||Faye.Scheduler,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var r=n.websocketExtensions;if(r){r=[].concat(r);for(var i=0,s=r.length;s>i;i++)this.addWebsocketExtension(r[i])}this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca;for(var o in this._alternates)this._alternates[o]=Faye.URI.parse(this._alternates[o]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(e){return this._alternates[e]||this.endpoint},addWebsocketExtension:function(e){this.wsExtensions.push(e)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},close:function(){var e=this._transport;delete this._transport,e&&e.close()},getConnectionTypes:function(){return Faye.Transport.getConnectionTypes()},selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this.connectionType=e.connectionType)},this)},sendMessage:function(e,t,n){n=n||{};var r,i=e.id,s=n.attempts,o=n.deadline&&(new Date).getTime()+1e3*n.deadline,u=this._envelopes[i];u||(r=new this._scheduler(e,{timeout:t,interval:this.retry,attempts:s,deadline:o}),u=this._envelopes[i]={message:e,scheduler:r}),this._sendEnvelope(u)},_sendEnvelope:function(e){if(this._transport&&!e.request&&!e.timer){var t=e.message,n=e.scheduler,r=this;if(!n.isDeliverable())return n.abort(),void delete this._envelopes[t.id];e.timer=Faye.ENV.setTimeout(function(){r.handleError(t)},1e3*n.getTimeout()),n.send(),e.request=this._transport.sendMessage(t)}},handleResponse:function(e){var t=this._envelopes[e.id];void 0!==e.successful&&t&&(t.scheduler.succeed(),delete this._envelopes[e.id],Faye.ENV.clearTimeout(t.timer)),this.trigger("message",e),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(e,t){var n=this._envelopes[e.id],r=n&&n.request,i=this;if(r){r.then(function(e){e&&e.abort&&e.abort()});var s=n.scheduler;s.fail(),Faye.ENV.clearTimeout(n.timer),n.request=n.timer=null,t?this._sendEnvelope(n):n.timer=Faye.ENV.setTimeout(function(){n.timer=null,i._sendEnvelope(n)},1e3*s.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}}),Faye.extend(Faye.Dispatcher.prototype,Faye.Publisher),Faye.extend(Faye.Dispatcher.prototype,Faye.Logging),Faye.Scheduler=function(e,t){this.message=e,this.options=t,this.attempts=0},Faye.extend(Faye.Scheduler.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var e=this.options.attempts,t=this.attempts,n=this.options.deadline,r=(new Date).getTime();return void 0!==e&&t>=e?!1:void 0!==n&&r>n?!1:!0},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),Faye.Transport=Faye.extend(Faye.Class({DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},SECURE_PROTOCOLS:["https:","wss:"],MAX_DELAY:0,batching:!0,initialize:function(e,t){this._dispatcher=e,this.endpoint=t,this._outbox=[],this._proxy=Faye.extend({},this._dispatcher.proxy),!this._proxy.origin&&Faye.NodeAdapter&&(this._proxy.origin=Faye.indexOf(this.SECURE_PROTOCOLS,this.endpoint.protocol)>=0?process.env.HTTPS_PROXY||process.env.https_proxy:process.env.HTTP_PROXY||process.env.http_proxy)},close:function(){},encode:function(){return""},sendMessage:function(e){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._flushLargeBatch(),this._promise=this._promise||new Faye.Promise,e.channel===Faye.Channel.HANDSHAKE?(this.addTimeout("publish",.01,this._flush,this),this._promise):(e.channel===Faye.Channel.CONNECT&&(this._connectMessage=e),this.addTimeout("publish",this.MAX_DELAY,this._flush,this),this._promise)):Faye.Promise.fulfilled(this.request([e]))},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),Faye.Promise.fulfill(this._promise,this.request(this._outbox)),delete this._promise,this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._dispatcher.maxRequestSize)){var t=this._outbox.pop();this._flush(),t&&this._outbox.push(t)}},_receive:function(e){if(e){e=[].concat(e),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleResponse(e[t])}},_handleError:function(e){e=[].concat(e),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleError(e[t])},_getCookies:function(){var e=this._dispatcher.cookies,t=Faye.URI.stringify(this.endpoint);return e?Faye.map(e.getCookiesSync(t),function(e){return e.cookieString()}).join("; "):""},_storeCookies:function(e){var t,n=this._dispatcher.cookies,r=Faye.URI.stringify(this.endpoint);if(e&&n){e=[].concat(e);for(var i=0,s=e.length;s>i;i++)t=Faye.Cookies.Cookie.parse(e[i]),n.setCookieSync(t,r)}}}),{get:function(e,t,n,r,i){var s=e.endpoint;Faye.asyncEach(this._transports,function(s,o){var u=s[0],a=s[1],f=e.endpointFor(u);return Faye.indexOf(n,u)>=0?o():Faye.indexOf(t,u)<0?(a.isUsable(e,f,function(){}),o()):void a.isUsable(e,f,function(t){if(!t)return o();var n=a.hasOwnProperty("create")?a.create(e,f):new a(e,f);r.call(i,n)})},function(){throw Error("Could not find a usable connection type for "+Faye.URI.stringify(s))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},getConnectionTypes:function(){return Faye.map(this._transports,function(e){return e[0]})},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,r){var i=function(){n.call(r)};e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i),this._registry.push({_element:e,_type:t,_callback:n,_context:r,_handler:i})},detach:function(e,t,n,r){for(var i,s=this._registry.length;s--;)i=this._registry[s],e&&e!==i._element||t&&t!==i._type||n&&n!==i._callback||r&&r!==i._context||(i._element.removeEventListener?i._element.removeEventListener(i._type,i._handler,!1):i._element.detachEvent("on"+i._type,i._handler),this._registry.splice(s,1),i=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o,u=gap,a=t[e];switch(a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?a+"":"null";case"boolean":case"null":return a+"";case"object":if(!a)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(a)){for(s=a.length,n=0;s>n;n+=1)o[n]=str(n,a)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+u+"]":"["+o.join(",")+"]",gap=u,i}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+u+"}":"{"+o.join(",")+"}",gap=u,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw Error("JSON.stringify")},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,n=e.length;n>t;t++)this._pending.add(e[t]);var r=new Faye.Promise;return this.callback(function(t){t&&(t.send(Faye.toJSON(e)),Faye.Promise.fulfill(r,t))},this),this.connect(),{abort:function(){r.then(function(e){e.close()})}}},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var r=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var i=t._pending?t._pending.toArray():[];delete t._pending,r?t._handleError(i,!0):t._everConnected?t._handleError(i):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n=JSON.parse(e.data);if(n){n=[].concat(n);for(var r=0,i=n.length;i>r;r++)void 0!==n[r].successful&&t._pending.remove(n[r]);t._receive(n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t=this._dispatcher.headers,n=this._dispatcher.wsExtensions,r=this._getCookies(),i=this._dispatcher.tls,s={extensions:n,headers:t,proxy:this._proxy,tls:i};return""!==r&&(s.headers.Cookie=r),Faye.WebSocket?new Faye.WebSocket.Client(e,[],s):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,n,r){this.create(e,t).isUsable(n,r)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e.clientId;var n=new EventSource(Faye.URI.stringify(t)),r=this;n.onopen=function(){r._everConnected=!0,r.setDeferredStatus("succeeded")},n.onerror=function(){r._everConnected?r._handleError([]):(r.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){r._receive(JSON.parse(e.data))},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){return this._xhr.request(e)}}),{isUsable:function(e,t,n,r){var i=e.clientId;return i?void Faye.Transport.XHR.isUsable(e,t,function(i){return i?void this.create(e,t).isUsable(n,r):n.call(r,!1)},this):n.call(r,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},r=e.clientId,i=Faye.copyObject(t);return i.pathname+="/"+(r||""),i=Faye.URI.stringify(i),n[i]=n[i]||new this(e,t),n[i]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return Faye.toJSON(e)},request:function(e){var t=this.endpoint.href,n=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,r=this;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Pragma","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");var i=this._dispatcher.headers;for(var s in i)i.hasOwnProperty(s)&&n.setRequestHeader(s,i[s]);var o=function(){n.abort()};return void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){if(n&&4===n.readyState){var t=null,i=n.status,s=n.responseText,u=i>=200&&300>i||304===i||1223===i;if(void 0!==Faye.ENV.onbeforeunload&&Faye.Event.detach(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){},n=null,!u)return r._handleError(e);try{t=JSON.parse(s)}catch(a){}t?r._receive(t):r._handleError(e)}},n.send(this.encode(e)),n}}),{isUsable:function(e,t,n,r){n.call(r,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return"message="+encodeURIComponent(Faye.toJSON(e))},request:function(e){var t,n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,r=new n,i=this._dispatcher.headers,s=this;if(r.open("POST",Faye.URI.stringify(this.endpoint),!0),r.setRequestHeader){r.setRequestHeader("Pragma","no-cache");for(t in i)i.hasOwnProperty(t)&&r.setRequestHeader(t,i[t])}var o=function(){return r?(r.onload=r.onerror=r.ontimeout=r.onprogress=null,void (r=null)):!1};return r.onload=function(){var t=null;try{t=JSON.parse(r.responseText)}catch(n){}o(),t?s._receive(t):s._handleError(e)},r.onerror=r.ontimeout=function(){o(),s._handleError(e)},r.onprogress=function(){},r.send(this.encode(e)),r}}),{isUsable:function(e,t,n,r){if(Faye.URI.isSameOrigin(t))return n.call(r,!1);if(Faye.ENV.XDomainRequest)return n.call(r,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var i=new Faye.ENV.XMLHttpRequest;return n.call(r,void 0!==i.withCredentials)}return n.call(r,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.copyObject(this.endpoint);return t.query.message=Faye.toJSON(e),t.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(t)},request:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),r=Faye.Transport.JSONP.getCallbackName(),i=Faye.copyObject(this.endpoint),s=this;i.query.message=Faye.toJSON(e),i.query.jsonp=r;var o=function(){if(!Faye.ENV[r])return!1;Faye.ENV[r]=void 0;try{delete Faye.ENV[r]}catch(e){}n.parentNode.removeChild(n)};return Faye.ENV[r]=function(e){o(),s._receive(e)},n.type="text/javascript",n.src=Faye.URI.stringify(i),t.appendChild(n),n.onerror=function(){o(),s._handleError(e)},{abort:o}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,r){n.call(r,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}(),define("faye",function(){}),define("game",["jquery","services","gameRegister","gameLogin","gameProfile","box2dCore","howler","faye"],function(e,t){var n=function(n){var r=this;this.details=n=n||{};var i=n.FPS=n.FPS||60,s=n.collision=n.collision||!0,o=n.bounded=n.bounded||!0,u=n.physicsEnabled=n.physicsEnabled||!0,a=null;this.soundEnabled=!0,this.smallScreen=screen.width<900||!1;var f=0,l=e("#gameCanvas");this.gameboardHeightMeters=n.boardHeightMeters=n.boardHeightMeters||25,this.gameboardWidthMeters=0,l[0].width=e("#gameDiv").width(),l[0].height=e("#gameDiv").width(),e(window).resize(function(){l[0].width=e("#gameDiv").width(),l[0].height=e("#gameDiv").width()}),e("#fireButtonDiv").css("top",.2*l[0].height),e("#arrowsDiv").css("top",.5*l[0].height),this.stageRect=function(){return{x:0,y:0,width:l[0].width,height:l[0].height}},this.smallScreen||e("#controls").hide();if(u){var c=l[0].height/this.gameboardHeightMeters;this.gameboardWidthMeters=l[0].width/c,a=new Physics(l[0],c),a.running=!1,s&&a.collision(),o&&a.screenBoundaries(n.boundary)}this.debug=function(){a.debug()},this.pause=function(t,n){if(!a)return;a.running=!t,_.isUndefined(n)||n(t),e(window).trigger("gamePause")},this.end=function(t){if(!a)return;a.running=!1,_.isUndefined(t)||t(),e(window).trigger("gameEnd")},this.start=function(t){if(!a)return;a.running=!0,_.isUndefined(t)||t(),e(window).trigger("gameStart")},this.trigger=function(t,n){e(window).trigger(t,n)},this.catch=function(t,n){e(window).on(t,n)},this.destroyBody=function(e){a.destroyBody(e)},this.gamePhysics=function(){return a},a.animate();var h={},p=function(e){if(e.id===undefined||e.src===undefined)throw"ImageLoader: invalid arguments to preload function";var t=new Image;t.src=e.src;if(h[e.id]!==undefined)throw"ImageLoader: duplicte id";h[e.id]=t};this.preload=function(e){_.isArray(e)?_.each(e,p):p(e)},this.image=function(e){if(_.isUndefined(e))throw"Game: expected an argument fo image().";return h[e]},this.hideCanvas=function(e){_.isUndefined(e)||e?l.hide():l.show()},e("#soundlink").on("click",function(){var t=e("#soundlinkicon");r.soundEnabled?(t.removeClass("glyphicon-volume-up"),t.addClass("glyphicon-volume-off"),r.soundEnabled=!1):(t.removeClass("glyphicon-volume-off"),t.addClass("glyphicon-volume-up"),r.soundEnabled=!0)}),e("#gameEndDiv").hide(),e("#authenticatedSpan").hide(),e(window).on("loggedIn",function(t,n){e("#authenticatedSpan").show(),e("#notAuthenticatedSpan").hide(),e("#username").text(n),e("#username").text()!==e("#name").text()&&(e("#name_href").show(),e("#name").hide())}),this.initLeader=function(n){function s(t){e("#score").text(t.score),e("#level").text(t.level),e("#name").text(t.name),e("#name_href").text(t.name),e("#username").text()===""||e("#username").text()===t.name?(e("#name_href").hide(),e("#name").show()):(e("#name_href").show(),e("#name").hide())}function o(){i||t.level(f,function(e,t){s(e),i=!0,a()})}function a(){setTimeout(function(){console.log(44),i=!1,o()},5e3)}var i=!1;i=!1,o(),e(window).on("gameLevelChanged",function(e,t){f=t,i=!1,o()});var u=!1;e(window).on("gameStart",function(){u=!1,e("#gameEndDiv").hide()}),e(window).on("gameEnd",function(){r.gameEndMessage&&e("#gameEndDiv").text(r.gameEndMessage),e("#gameEndDiv").show(),e("#score").text()<n()&&!u&&(u=!0,i=!1,t.score(f,n(),function(e,t){console.log("score status: ",t),console.log("score data: ",e)}))})}};return n}),define("hud",[],function(){var e=function(e){var t=this;this.details=e=e||{},this.restart=this.details.restart||null,this.levelChanged=this.details.restart||null;var n=$("#scoreboardDiv"),r=n;r[0].style.opacity="0.5",r.append($("<span>Score: </span>")),this.scoreSpan=$("<span>"),r.append(this.scoreSpan),this.restartButton=$("#restartButton"),this.pauseButton=$("#pauseButton"),this.levelButton=$("#levelButton"),this.isPaused=function(){return this.pauseButton.text()=="Pause"},this.gameStarted=function(){this.levelButton.show(),this.pauseButton.show(),this.restartButton.show()},this.restartButton.on("click",function(){return e.restart?e.restart():location.reload(),!1}),this.pauseButton.on("click",function(){return e.pause&&e.pause(),t.isPaused()?(t.pauseButton.text("Continue "),t.restartButton.hide(),t.levelButton.hide()):(t.pauseButton.text("Pause"),t.levelButton.show(),t.restartButton.show()),!1}),this.levelButton.on("click",function(){return t.pauseButton.hide(),t.restartButton.hide(),t.levelButton.hide(),e.levelChanged?e.levelChanged():location.reload(),!1}),t.pauseButton.hide(),t.restartButton.hide(),t.levelButton.hide()};return e}),define("background",[],function(){var e={getImage:function(e){var t=null;if(typeof e=="string")t=new Image,t.src=e;else{t=e;if(t===undefined)throw"Background: unable to resolve image"}return t},Static:function(t,n){var n=n||{},r=n.imageSource,i=t.element.width,s=t.element.height,o=null;typeof r=="string"?o=e.getImage(r):o=r;var u=this;$(window).on("step",function(){t.context.save(),t.context.drawImage(o,0,0,i,s),t.context.restore()})},Moving:function(t,n){var n=n||{},r=n.imageSource;this.image=e.getImage(r),this.x=n.x||0,this.y=n.y||0,this.speed=n.speed||-0.15,this.move=n.move||"horizontal";var i=this;!e;var s=t.element.width,o=t.element.height,u=1,a=0,f=-1;this.fade=function(e){a=e,_.isUndefined(a)||(a=.005),f=u==1?-1:1},this.show=function(e){_.isUndefined(e)&&(e=!0),e?(this.fade(0),u=1):(this.fade(1),u=0)},$(window).on("step",function(){if(i.move==="horizontal"){Math.abs(i.x)>=s&&(i.x=0),i.x+=i.speed,t.context.save(),t.context.globalAlpha=u,t.context.drawImage(i.image,i.x,i.y,s,o);var e=i.speed<0?s+i.x:i.x-s;t.context.drawImage(i.image,e,i.y,s,o),t.context.restore(),u+=a*f,u<0?u=0:u>1&&(u=1)}else if(i.move==="vertical"){Math.abs(i.y)>=o&&(i.y=0),i.y+=i.speed,t.context.save(),t.context.globalAlpha=u,t.context.drawImage(i.image,i.x,i.y,s,o);var n=i.speed<0?o+i.y:i.y-o;t.context.drawImage(i.image,i.x,n,s,o),t.context.restore(),u+=a*f,u<0?u=0:u>1&&(u=1)}})}};return e}),define("startup",[],function(){var e=function(e){var t=this;this.details=e=e||{},this.imageSrc=this.details.imageSrc,this.stageRect=this.details.stageRect||{x:0,y:0,width:$(window).width(),height:$(window).height()},this.levelExplaination=this.details.levelExplaination||null,this.levels=this.details.levels||null,this.currentLevelIndex=0;var n=this.stageRect.width,r=this.stageRect.height,i=$("<div>");i[0].style.opacity="0.5",$("#gameDiv").append(i);var s=null;if(typeof this.imageSrc=="string")s=new Image,s.src=this.imageSrc;else{s=this.imageSrc;if(s===undefined)throw"Startup: unable to resolve image"}s.width=n*.8,s.height=r*.5,i.append($(s)),i.append($("<br>"));var o=$("<div>");i.append(o),o.css({fontSize:15,fontFamily:"Arial"}),o.css("color","black"),o.css("backgroundColor","yellow"),o.addClass("newline"),o.text(this.levelExplaination[0]),i.append($("<br>"));var u=$("<button>");i.append(u),u.css({fontFamily:"Segoe Script"}),u.css("color","yellow"),u.css("backgroundColor","blue"),u.text("Start"),i.css({top:r*.1+this.stageRect.y,left:n*.14+this.stageRect.x,position:"absolute"});var a;this.levels.length&&(a=$("<select>"));for(var f=0;f<this.levels.length;++f){var l=$("<option>");l.css({fontFamily:"Segoe Script"}),l.text(this.levels[f]),a.append(l)}a.css("height",u.height()),a.css({bottom:0,right:0,position:"absolute"}),a.css({fontSize:20,fontFamily:"Segoe Script"}),i.append(a),a.on("change",function(){var e=t.levels.indexOf(this.value);o.text(t.levelExplaination[e]),t.currentLevelIndex=e,$(window).trigger("gameLevelChanged",e)}),u.on("click",function(){i.hide(),e.startGame&&e.startGame()}),this.show=function(){i.show()},this.hide=function(){i.hide()}};return e}),define("asteroids",["underscore","box2dCore"],function(e,t){var n=function(t,n){function l(e){var t=new Image;t.src=e,o.push(t)}var r=this;this.ready=!0,this.details=n=n||{};var i=n.sprites,s=n.contactCallback=n.contactCallback||null;this.physics=t,this.MAX_SPEED=this.details.maxSpeed||6,this.MIN_SPEED=this.details.minSpeed||2,this.minRadius=this.details.minRadius||.5,this.maxRadius=this.details.maxRadius||1,this.fragmentMaxFactor=this.details.fragmentMaxFactor||.3,this.fragmentMinFactor=this.details.fragmentMinFactor||.1,this.numberOfFragments=this.details.numberOfFragments||20;var o=[],u=[],a=[],f=1.25*(this.maxRadius+t.screenboundaryThickness/t.scale);e.isUndefined(i)&&(i=["imgs/asteroid_1.png","imgs/asteroid_2.png","imgs/asteroid_3.png","imgs/asteroid_4.png"]),e.each(i,l);var c=function(n,i){if(!o||o.length===0){console.log("Asteroid constructor: No asteroid sprites available");return}var u=e.random(o.length-1),a=Math.random()*r.maxRadius;a<r.minRadius&&(a=r.minRadius),this.body=new Body(t,{id:"asteroid",shape:"circle",x:n.x,y:n.y,image:o[u],radius:a,width:2*a,height:2*a}),this.body.body.ApplyImpulse({x:i.x,y:i.y},this.body.body.GetWorldCenter()),e.isUndefined(s)||(this.body.contact=s)};this.doCcreateAsteroid=function(e,t){var n=new c(e,t);return a.push(n),n},this.destroyAllAsteroids=function(){e.each(a,function(e){t.destroyBody(e.body)}),a=[]},this.doMakeAsteroid=function(){$(window).trigger("asteroidAboutToBeMade"),r.ready&&(r.createAsteroid(r.getRandomPosition(f),r.generateRandomVelocity()),$(window).trigger("asteroidMade"))},this.explodeBody=function(t){e.contains(u,t)||u.push(t)};var h=function(n){var i=n.details.radius*r.fragmentMaxFactor,s=n.details.radius*r.fragmentMinFactor,o=r.numberOfFragments,u=[],a=[],f=[];for(var l=0;l<o;++l){var c=Math.random()*i;c<s&&(c=s);var h=n.body.GetPosition(),p=(i-s)/3;c>s+2*p?u.push(new Body(t,{id:"asteroidFragment",shape:"circle",x:h.x,y:h.y,image:n.details.image,radius:c,width:2*c,height:2*c})):c>s+p?a.push(new Body(t,{id:"asteroidFragment",shape:"circle",x:h.x,y:h.y,image:n.details.image,radius:c,width:2*c,height:2*c})):f.push(new Body(t,{id:"asteroidFragment",shape:"circle",x:h.x,y:h.y,image:n.details.image,radius:c,width:2*c,height:2*c}))}setTimeout(function(){e.each(u,function(e){t.destroyBody(e)})},3e3),setTimeout(function(){e.each(a,function(e){t.destroyBody(e)})},2e3),setTimeout(function(){e.each(f,function(e){t.destroyBody(e)})},1e3)};this.doExplodeBody=function(e){new h(e),t.destroyBody(e),$(window).trigger("asteroidExploded")},$(window).on("step",function(){e.each(u,r.doExplodeBody),u=[]})};return n.prototype.makeAsteroids=function(e){setInterval(this.doMakeAsteroid,e||3e3)},n.prototype.getRandomPosition=function(e){var t=Math.random()*this.physics.element.width/this.physics.scale;return t<e&&(t=e),t>this.physics.element.width/this.physics.scale-e&&(t=this.physics.element.width/this.physics.scale-e),{x:t,y:e}},n.prototype.generateRandomVelocity=function(){var e=Math.random()*Math.PI*2,n=Math.random()*(this.MAX_SPEED-this.MIN_SPEED)+this.MIN_SPEED;return new t.b2Vec2(Math.cos(e)*n,Math.abs(Math.sin(e)*n))},n.prototype.createAsteroid=function(e,t){this.doCcreateAsteroid(e,t)},n}),define("misc",[],function(){var e={AudioSource:function(e,t){this.instances=[],this.numberOfAudioInstance=t=t||1;for(i=0;i<this.numberOfAudioInstance;++i)this.instances.push(new Audio(e));this.currentIndex=0,this.play=function(){this.currentIndex%=this.numberOfAudioInstance,this.instances[this.currentIndex].play(),this.currentIndex++}},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}};return e}),define("cannon",["jquery","misc","howler"],function(e,t){var n=function(t,n){function w(){e("#upArrowButton")[0].addEventListener("touchstart",function(e){e.preventDefault(),d=!0},!1),e("#upArrowButton")[0].addEventListener("touchend",function(e){e.preventDefault(),d=!1},!1),e("#downArrowButton")[0].addEventListener("touchstart",function(e){e.preventDefault(),v=!0},!1),e("#downArrowButton")[0].addEventListener("touchend",function(e){e.preventDefault(),v=!1},!1),e("#fireButton")[0].addEventListener("touchstart",function(e){e.preventDefault(),p=!0,r.shoot()},!1),e("#fireButton")[0].addEventListener("touchend",function(e){e.preventDefault(),p=!1},!1)}var r=this,i=t.gamePhysics();this.cannon_baseWidth=n.width=n.width||4.3,this.cannon_baseHeight=n.height=n.height||2.2,this.x=n.x||150/i.scale,this.y=n.y||240/i.scale,this.direction=n.direction||"right",this.enableKeyboard=n.enableKeyboard||!0,this.SPM=n.SPM||300,this.rotationSpeed=n.rotationSpeed||1;var s=n.cannonBase,o=n.cannon;this.direction==="left"&&(s=n.cannonBaseLeft,o=n.cannonLeft);var u=null;if(typeof s=="string")u=new Image,u.src=s;else{u=s;if(u===undefined)throw"Cannon: unable to resolve image"}var a=null;if(typeof o=="string")a=new Image,a.src=o;else{a=o;if(a===undefined)throw"Cannon: unable to resolve image"}this.body_cannon_base=new Body(i,{type:"static",x:this.x,y:this.y,image:u,width:this.cannon_baseWidth,height:this.cannon_baseHeight,draggable:!1});var f=new Howl({urls:["./sounds/cannon.wav"]}),l=new Howl({urls:["./sounds/gear.wav"],volume:.5,loop:!0,onplay:function(){this.isPlaying=!0},onpause:function(){this.isPlaying=!1}});l.isPlaying=!1;var c=35,h=!0,p=!1,d=!1,v=!1,m=this.x+.1*this.cannon_baseWidth;this.direction==="left"&&(m=this.x-.1*this.cannon_baseWidth);var g=this.y-.3*this.cannon_baseHeight;this.body_cannon=new Body(i,{x:m,y:g,image:a,width:.754*this.cannon_baseWidth,height:.55*this.cannon_baseHeight});var y=0,b=130;this.direction==="left"&&(y=-130,b=0),this.joint=i.revoluteJoint(this.body_cannon,this.body_cannon_base,{x:m,y:g},{enableLimit:!0,lowerAngle:y,upperAngle:b,motorSpeed:0,enableMotor:!1,maxMotorTorque:100}),this.joint.EnableMotor(!0),this.raiseCannon=function(){this.direction==="left"?this.joint.SetMotorSpeed(-this.rotationSpeed):this.joint.SetMotorSpeed(this.rotationSpeed),!l.isPlaying&&t.soundEnabled&&l.play()},this.dropCannon=function(){this.direction==="left"?this.joint.SetMotorSpeed(this.rotationSpeed):this.joint.SetMotorSpeed(-this.rotationSpeed),!l.isPlaying&&t.soundEnabled&&l.play()},this.stopCannon=function(){this.joint.SetMotorSpeed(0),l.pause()},w();var E=function(e){e.preventDefault(),e.keyCode==38||e.keyCode==119?d=!0:e.keyCode==40||e.keyCode==115?v=!0:e.keyCode==17?c>5&&(c-=2):e.keyCode==16?c<60&&(c+=2):e.keyCode==32&&(p=!0)},S=function(e){e.preventDefault(),e.keyCode==119?d=!0:e.keyCode==115?v=!0:e.keyCode==17?c>5&&(c-=2):e.keyCode==16&&c<60&&(c+=2)},x=function(e){e.preventDefault(),e.keyCode==32&&(p=!1);if(e.keyCode==38||e.keyCode==119)d=!1;else if(e.keyCode==40||e.keyCode==115)v=!1};this.enableKeyboardControl=function(e){e?(window.addEventListener("keypress",S,!1),window.addEventListener("keydown",E,!1),window.addEventListener("keyup",x,!1)):(window.removeEventListener("keypress",S,!1),window.removeEventListener("keydown",E,!1),window.removeEventListener("keyup",x,!1))},this.isShoot=function(){return p},this.shoot=function(){if(!h||!i.running)return;h=!1;var n=Math.abs(this.joint.GetJointAngle()),r=.55*this.cannon_baseHeight*.18,s=.754*this.cannon_baseWidth,o=(2*r+s*.5)*Math.cos(n);this.direction==="left"&&(o*=-1);var u=(2*r+s*.5)*Math.sin(n),a=new Body(i,{shape:"circle",radius:r,x:m+o,y:g-u,color:"white",id:"ball"});a.contact=function(e,t,n){n.id=="boundary"&&i.destroyBody(this)};var l=c,p=l*Math.cos(n),d=l*Math.sin(n);this.direction==="left"?a.body.ApplyImpulse({x:-p,y:-d},a.body.GetWorldCenter()):a.body.ApplyImpulse({x:p,y:-d},a.body.GetWorldCenter()),t.soundEnabled&&f.play(),setTimeout(function(){h=!0},60/this.SPM*1e3),e(window).trigger("shotFired")},this.destroyCannon=function(){r.enableKeyboardControl(!1),i.destroyBody(this.body_cannon),i.destroyBody(this.body_cannon_base)},e(window).on("step",function(){p&&r.shoot(),d?r.raiseCannon():v?r.dropCannon():(r.joint.SetMotorSpeed(0),r.stopCannon())}),e(window).on("gameEnd",function(){l.pause()}),this.enableKeyboard&&this.enableKeyboardControl(!0)};return n}),define("app/main",["game","hud","background","startup","asteroids","cannon"],function(e,t,n,r,i,s){var o={game:null,physics:null,gamePaused:!1,asteroidCount:0,asteroids:null,HUDcontext:null,startup:null,hud:null,score:0,currentLevelData:null,pauseGame:function(e){o.gamePaused=e,o.asteroids.ready=!e},pause:function(){o.game.pause(o.hud.isPaused(),o.pauseGame)},init:function(u,a){function S(){o.score+=20,o.hud.scoreSpan.text(o.score)}function x(){o.startup.currentLevelIndex===0&&(o.score-=5),o.startup.currentLevelIndex==1&&(o.score-=10),o.startup.currentLevelIndex==2&&(o.score-=15),o.hud.scoreSpan.text(o.score)}function T(){return o.score}var f=o.game=new e({canvasWidth:u,canvasHeight:a}),l=o.physics=f.gamePhysics();f.preload([{id:"cannonBase",src:"imgs/cannon_base.png"},{id:"cannon",src:"imgs/cannon.png"},{id:"gameStart",src:"imgs/gameStart.png"},{id:"gameScore",src:"imgs/gameScore.png"},{id:"nightSkyBackground",src:"imgs/nightSkyBackground.png"},{id:"earthBackground",src:"imgs/earthBackground.png"}]);var c=!1,h="right",p=!0,d=0,v=0,m=[10,8,5],g=[500,400,300],y=[5,10,15],b=0,w=f.stageRect(),E=new s(f,{x:3,y:21,cannonBase:f.image("cannonBase"),cannon:f.image("cannon")});$(window).on("gameView",function(e,t){E.enableKeyboardControl(t)}),o.asteroids=new i(f.gamePhysics(),{contactCallback:function(e,t,n){this.id=="asteroid"&&n.id=="ball"&&(o.asteroids.explodeBody(this),f.destroyBody(n))}}),o.asteroids.makeAsteroids(),new n.Moving(f.gamePhysics(),{imageSource:f.image("nightSkyBackground"),move:"vertical",speed:.2}),new n.Static(f.gamePhysics(),{imageSource:f.image("earthBackground")}),$(window).on("asteroidExploded",function(){--o.asteroidCount,S(),b++}),$(window).on("shotFired",function(){++d,x(),d>g[o.startup.currentLevelIndex]&&(f.end(),o.asteroids.ready=!1)}),$(window).on("asteroidAboutToBeMade",function(){o.asteroidCount>m[o.startup.currentLevelIndex]&&(o.score=0,o.hud.scoreSpan.text(o.score),f.gameEndMessage="Ooops... Game End",f.end(),o.asteroids.ready=!1)}),$(window).on("asteroidMade",function(){++o.asteroidCount,++v,v>9&&(f.gameEndMessage="Game End",f.end(),o.asteroids.ready=!1)}),o.startup=new r({game:f,startGame:function(){o.hud.gameStarted(),f.pause(!1,o.pauseGame),f.start()},imageSrc:f.image("gameStart"),stageRect:w,levels:["Level 1","Level 2","Level 3"],levelExplaination:["Number of shots: 500\nCost of 1 shot: 5 points\nNumber of asteroids: 40\nAsteroids visible: < 11","Number of shots: 400\nCost of 1 shot: 10 points\nNumber of asteroids: 40\nAsteroids visible: < 8","Number of shots: 300\nCost of 1 shot: 15 points\nNumber of asteroids: 40\nAsteroids visible: < 5"]}),o.hud=new t({restart:function(){o.asteroids.destroyAllAsteroids(),o.asteroidCount=0,o.game.pause(!1,o.pauseGame),o.score=2500,o.hud.scoreSpan.text(o.score),d=0,v=0,b=0,$(window).trigger("gameStart")},levelChanged:function(){o.asteroids.destroyAllAsteroids(),o.asteroidCount=0,o.game.pause(!0,o.pauseGame),o.score=2500,o.hud.scoreSpan.text(o.score),d=0,v=0,b=0,o.startup.show()},pause:o.pause}),o.hud.scoreSpan.text(0),o.pauseGame(!0),f.initLeader(T),o.score=2500,o.hud.scoreSpan.text(o.score),f.smallScreen&&(E.enableKeyboardControl(!1),$("#arrowsDiv").css("top",-60),$("#fireButtonDiv").css("top",-40),$("*").addClass("nocursor"))}};return o});if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1||t[0]>2)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 3")}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var n=e(this),i=n.data("bs.alert");i||n.data("bs.alert",i=new r(this)),"string"==typeof t&&i[t].call(n)})}var n='[data-dismiss="alert"]',r=function(t){e(t).on("click",n,this.close)};r.VERSION="3.3.6",r.TRANSITION_DURATION=150,r.prototype.close=function(t){function n(){o.detach().trigger("closed.bs.alert").remove()}var i=e(this),s=i.attr("data-target");s||(s=i.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,""));var o=e(s);t&&t.preventDefault(),o.length||(o=i.closest(".alert")),o.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(r.TRANSITION_DURATION):n())};var i=e.fn.alert;e.fn.alert=t,e.fn.alert.Constructor=r,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",n,r.prototype.close)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.button"),s="object"==typeof t&&t;i||r.data("bs.button",i=new n(this,s)),"toggle"==t?i.toggle():t&&i.setState(t)})}var n=function(t,r){this.$element=e(t),this.options=e.extend({},n.DEFAULTS,r),this.isLoading=!1};n.VERSION="3.3.6",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var n="disabled",r=this.$element,i=r.is("input")?"val":"html",s=r.data();t+="Text",null==s.resetText&&r.data("resetText",r[i]()),setTimeout(e.proxy(function(){r[i](null==s[t]?this.options[t]:s[t]),"loadingText"==t?(this.isLoading=!0,r.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,r.removeClass(n).removeAttr(n))},this),0)},n.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")?(n.prop("checked")&&(e=!1),t.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==n.prop("type")&&(n.prop("checked")!==this.$element.hasClass("active")&&(e=!1),this.$element.toggleClass("active")),n.prop("checked",this.$element.hasClass("active")),e&&n.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var r=e.fn.button;e.fn.button=t,e.fn.button.Constructor=n,e.fn.button.noConflict=function(){return e.fn.button=r,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(n){var r=e(n.target);r.hasClass("btn")||(r=r.closest(".btn")),t.call(r,"toggle"),e(n.target).is('input[type="radio"]')||e(n.target).is('input[type="checkbox"]')||n.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){e(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},n.DEFAULTS,r.data(),"object"==typeof t&&t),o="string"==typeof t?t:s.slide;i||r.data("bs.carousel",i=new n(this,s)),"number"==typeof t?i.to(t):o?i[o]():s.interval&&i.pause().cycle()})}var n=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",e.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.3.6",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.getItemForDirection=function(e,t){var n=this.getItemIndex(t),r="prev"==e&&0===n||"next"==e&&n==this.$items.length-1;if(r&&!this.options.wrap)return t;var i="prev"==e?-1:1,s=(n+i)%this.$items.length;return this.$items.eq(s)},n.prototype.to=function(e){var t=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",this.$items.eq(e))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){return this.sliding?void 0:this.slide("next")},n.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},n.prototype.slide=function(t,r){var i=this.$element.find(".item.active"),s=r||this.getItemForDirection(t,i),o=this.interval,u="next"==t?"left":"right",f=this;if(s.hasClass("active"))return this.sliding=!1;var l=s[0],h=e.Event("slide.bs.carousel",{relatedTarget:l,direction:u});if(this.$element.trigger(h),!h.isDefaultPrevented()){if(this.sliding=!0,o&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var p=e(this.$indicators.children()[this.getItemIndex(s)]);p&&p.addClass("active")}var d=e.Event("slid.bs.carousel",{relatedTarget:l,direction:u});return e.support.transition&&this.$element.hasClass("slide")?(s.addClass(t),s[0].offsetWidth,i.addClass(u),s.addClass(u),i.one("bsTransitionEnd",function(){s.removeClass([t,u].join(" ")).addClass("active"),i.removeClass(["active",u].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger(d)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(i.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(d)),o&&this.cycle(),this}};var r=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=r,this};var i=function(n){var r,i=e(this),s=e(i.attr("data-target")||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var o=e.extend({},s.data(),i.data()),u=i.attr("data-slide-to");u&&(o.interval=!1),t.call(s,o),u&&s.data("bs.carousel").to(u),n.preventDefault()}};e(document).on("click.bs.carousel.data-api","[data-slide]",i).on("click.bs.carousel.data-api","[data-slide-to]",i),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),+function(e){"use strict";function t(t){var n,r=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(r)}function n(t){return this.each(function(){var n=e(this),i=n.data("bs.collapse"),s=e.extend({},r.DEFAULTS,n.data(),"object"==typeof t&&t);!i&&s.toggle&&/show|hide/.test(t)&&(s.toggle=!1),i||n.data("bs.collapse",i=new r(this,s)),"string"==typeof t&&i[t]()})}var r=function(t,n){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};r.VERSION="3.3.6",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(t=i.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){i&&i.length&&(n.call(i,"hide"),t||i.data("bs.collapse",null));var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var u=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return u.call(this);var f=e.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",e.proxy(u,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[o](this.$element[0][f])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION):i.call(this)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,r){var i=e(r);this.addAriaAndCollapsedClass(t(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var i=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=r,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(r){var i=e(this);i.attr("data-target")||r.preventDefault();var s=t(i),o=s.data("bs.collapse"),u=o?"toggle":i.data();n.call(s,u)})}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function n(n){n&&3===n.which||(e(i).remove(),e(s).each(function(){var r=e(this),i=t(r),s={relatedTarget:this};i.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(i[0],n.target)||(i.trigger(n=e.Event("hide.bs.dropdown",s)),n.isDefaultPrevented()||(r.attr("aria-expanded","false"),i.removeClass("open").trigger(e.Event("hidden.bs.dropdown",s)))))}))}function r(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new o(this)),"string"==typeof t&&r[t].call(n)})}var i=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.6",o.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=t(i),o=s.hasClass("open");if(n(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var u={relatedTarget:this};if(s.trigger(r=e.Event("show.bs.dropdown",u)),r.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger(e.Event("shown.bs.dropdown",u))}return!1}},o.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var r=e(this);if(n.preventDefault(),n.stopPropagation(),!r.is(".disabled, :disabled")){var i=t(r),o=i.hasClass("open");if(!o&&27!=n.which||o&&27==n.which)return 27==n.which&&i.find(s).trigger("focus"),r.trigger("click");var u=" li:not(.disabled):visible a",l=i.find(".dropdown-menu"+u);if(l.length){var c=l.index(n.target);38==n.which&&c>0&&c--,40==n.which&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var u=e.fn.dropdown;e.fn.dropdown=r,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);s||i.data("bs.modal",s=new n(this,o)),"string"==typeof t?s[t](r):o.show&&s.show(r)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.6",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var r=this,i=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){r.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(r.$element)&&(r.ignoreBackdropClick=!0)})}),this.backdrop(function(){var i=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.adjustDialog(),i&&r.$element[0].offsetWidth,r.$element.addClass("in"),r.enforceFocus();var s=e.Event("shown.bs.modal",{relatedTarget:t});i?r.$dialog.one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(n.TRANSITION_DURATION):r.$element.trigger("focus").trigger(s)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var r=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=e.support.transition&&i;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+i).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){return this.ignoreBackdropClick?void (this.ignoreBackdropClick=!1):void (e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;s?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var o=function(){r.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",o).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):o()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s="object"==typeof t&&t;(i||!/destroy|hide/.test(t))&&(i||r.data("bs.tooltip",i=new n(this,s)),"string"==typeof t&&i[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,r){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focusin",f="hover"==o?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void (n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void (n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),n.isInStateTrue()?void 0:(clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void (n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide())},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!r)return;var i=this,s=this.tip(),o=this.getUID(this.type);this.setContent(),s.attr("id",o),this.$element.attr("aria-describedby",o),this.options.animation&&s.addClass("fade");var u="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,l=f.test(u);l&&(u=u.replace(f,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(u).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var h=this.getPosition(),p=s[0].offsetWidth,d=s[0].offsetHeight;if(l){var v=u,m=this.getPosition(this.$viewport);u="bottom"==u&&h.bottom+d>m.bottom?"top":"top"==u&&h.top-d<m.top?"bottom":"right"==u&&h.right+p>m.width?"left":"left"==u&&h.left-p<m.left?"right":u,s.removeClass(v).addClass(u)}var g=this.getCalculatedOffset(u,h,p,d);this.applyPlacement(g,u);var y=function(){var e=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==e&&i.leave(i)};e.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",y).emulateTransitionEnd(n.TRANSITION_DURATION):y()}},n.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top+=o,t.left+=u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var f=r[0].offsetWidth,l=r[0].offsetHeight;"top"==n&&l!=s&&(t.top=t.top+s-l);var c=this.getViewportAdjustedDelta(n,t,f,l);c.left?t.left+=c.left:t.top+=c.top;var h=/top|bottom/.test(n),p=h?2*c.left-i+f:2*c.top-s+l,d=h?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(p,r[0][d],h)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function r(){"in"!=i.hoverState&&s.detach(),i.$element.removeAttr("aria-describedby").trigger("hidden.bs."+i.type),t&&t()}var i=this,s=e(this.$tip),o=e.Event("hide.bs."+this.type);return this.$element.trigger(o),o.isDefaultPrevented()?void 0:(s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",r).emulateTransitionEnd(n.TRANSITION_DURATION):r(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r="BODY"==n.tagName,i=n.getBoundingClientRect();null==i.width&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},n.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.right&&(i.left=o.left+o.width-l)}return i},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var r=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s="object"==typeof t&&t;(i||!/destroy|hide/.test(t))&&(i||r.data("bs.popover",i=new n(this,s)),"string"==typeof t&&i[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.6",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var r=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){"use strict";function t(n,r){this.$body=e(document.body),this.$scrollElement=e(e(n).is(document.body)?window:n),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e.proxy(this.process,this)),this.refresh(),this.process()}function n(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s="object"==typeof n&&n;i||r.data("bs.scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})}t.VERSION="3.3.6",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t=this,n="offset",r=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),e.isWindow(this.$scrollElement[0])||(n="position",r=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var t=e(this),i=t.data("target")||t.attr("href"),s=/^#./.test(i)&&e(i);return s&&s.length&&s.is(":visible")&&[[s[n]().top+r,i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),r=this.options.offset+n-this.$scrollElement.height(),i=this.offsets,s=this.targets,o=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),t>=r)return o!=(e=s[s.length-1])&&this.activate(e);if(o&&t<i[0])return this.activeTarget=null,this.clear();for(e=i.length;e--;)o!=s[e]&&t>=i[e]&&(void 0===i[e+1]||t<i[e+1])&&this.activate(s[e])},t.prototype.activate=function(t){this.activeTarget=t,this.clear();var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")},t.prototype.clear=function(){e(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var r=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=r,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var u=e(r);this.activate(t.closest("li"),n),this.activate(u,u.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},n.prototype.activate=function(t,r,i){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),u?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var o=r.find("> .active"),u=i&&e.support.transition&&(o.length&&o.hasClass("fade")||!!r.find("> .fade").length);o.length&&u?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=r,this};var i=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s="object"==typeof t&&t;i||r.data("bs.affix",i=new n(this,s)),"string"==typeof t&&i[t]()})}var n=function(t,r){this.options=e.extend({},n.DEFAULTS,r),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(t),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};n.VERSION="3.3.6",n.RESET="affix affix-top affix-bottom",n.DEFAULTS={offset:0,target:window},n.prototype.getState=function(e,t,n,r){var i=this.$target.scrollTop(),s=this.$element.offset(),o=this.$target.height();if(null!=n&&"top"==this.affixed)return n>i?"top":!1;if("bottom"==this.affixed)return null!=n?i+this.unpin<=s.top?!1:"bottom":e-r>=i+o?!1:"bottom";var u=null==this.affixed,a=u?i:s.top,f=u?o:t;return null!=n&&n>=i?"top":null!=r&&a+f>=e-r?"bottom":!1},n.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(n.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},n.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},n.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),r=this.options.offset,i=r.top,s=r.bottom,o=Math.max(e(document).height(),e(document.body).height());"object"!=typeof r&&(s=i=r),"function"==typeof i&&(i=r.top(this.$element)),"function"==typeof s&&(s=r.bottom(this.$element));var u=this.getState(o,t,i,s);if(this.affixed!=u){null!=this.unpin&&this.$element.css("top","");var f="affix"+(u?"-"+u:""),l=e.Event(f+".bs.affix");if(this.$element.trigger(l),l.isDefaultPrevented())return;this.affixed=u,this.unpin="bottom"==u?this.getPinnedOffset():null,this.$element.removeClass(n.RESET).addClass(f).trigger(f.replace("affix","affixed")+".bs.affix")}"bottom"==u&&this.$element.offset({top:o-t-s})}};var r=e.fn.affix;e.fn.affix=t,e.fn.affix.Constructor=n,e.fn.affix.noConflict=function(){return e.fn.affix=r,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var n=e(this),r=n.data();r.offset=r.offset||{},null!=r.offsetBottom&&(r.offset.bottom=r.offsetBottom),null!=r.offsetTop&&(r.offset.top=r.offsetTop),t.call(n,r)})})}(jQuery),define("bootstrap",["jquery"],function(){}),requirejs.config({baseUrl:"lib",paths:{app:"../app",game:"essentials/game",gameProfile:"essentials/gameProfile",gameLogin:"essentials/gameLogin",gameRegister:"essentials/gameRegister",services:"essentials/services",gameRouter:"essentials/gameRouter",Box2d:"essentials/Box2d.min",howler:"essentials/howler",wixMaps:"essentials/wixMaps",misc:"essentials/misc",inherit:"essentials/inherit",qtcloud:"essentials/qtcloud",box2dCore:"essentials/box2dCore",leader:"gameComponents/leader",asteroids:"gameComponents/astroids",cannon:"gameComponents/cannon",startup:"gameComponents/startup",runNjumpController:"gameComponents/runNjumpController",controller:"gameComponents/controller",carController:"gameComponents/carController",camera:"gameComponents/camera",camera2:"gameComponents/camera2",background:"gameComponents/background",parallax:"gameComponents/parallax",hud:"gameComponents/hud",animateSprite:"gameComponents/animateSprite",pathMovement:"gameComponents/pathMovement",jquery:"essentials/jquery",underscore:"essentials/underscore-1.8.3/underscore-min",faye:"essentials/Faye 1.1.1/browser/faye-browser-min",bootstrap:"essentials/bootstrap-3.3.6-dist/js/bootstrap.min"},shim:{bootstrap:{deps:["jquery"]}}}),require(["app/main","Box2d","bootstrap"],function(e){e.init()}),define("app",function(){});